.\"
.\" exportfs(8)
.\" 
.\" Copyright (C) 1995 Olaf Kirch <okir@monad.swb.de>
.\" Modifications 1999-2003 Neil Brown <neilb@cse.unsw.edu.au>
.\"
.\" Japanese Version Copyright (c) 2002-2005 Yuichi SATO
.\"         all rights reserved.
.\" Translated Fri Feb  8 05:49:48 JST 2002
.\"         by Yuichi SATO <ysato444@yahoo.co.jp>
.\" Updated & Modified Tue Oct  1 04:07:23 JST 2002 by Yuichi SATO
.\" Updated & Modified Thu Dec 29 11:12:42 JST 2005 by Yuichi SATO
.\"
.TH exportfs 8 "18 July 2003"
.SH 名前
exportfs \- NFS エクスポートするファイルシステムのリストを管理する
.SH 書式
.BI "/usr/sbin/exportfs [-avi] [-o " "options,.." "] [" "client:/path" " ..]
.br
.BI "/usr/sbin/exportfs -r [-v]"
.br
.BI "/usr/sbin/exportfs [-av] -u [" "client:/path" " ..]
.br
.BI "/usr/sbin/exportfs [-v]
.br
.BI "/usr/sbin/exportfs -f"
.br
.SH 説明
.B exportfs
コマンドは、現在 NFS でエクスポートしているファイルシステムの
テーブルを管理するために使うコマンドである。
このリストは
.B /var/lib/nfs/xtab
という名前のファイルに保存される。
このファイルは
リモートホストからファイルツリーをマウントするアクセス要求があった時に
.B mountd
から参照される。
また、このリストのうちアクティブになっているものが
カーネルのエクスポートテーブルに保存される。
.P
通常この
.B xtab
ファイルは、
.B "exportfs -a"
を実行することにより、
.B /etc/exports 
に書かれた全てのファイルシステムのリストで初期化される。
.P
しかし管理者は、
.B /etc/exports
を修正することなく、
.B exportfs
を使って選択的に個々のファイルシステムを追加・削除できる。
.P
.B exportfs
とそのパートナとなるプログラム
.B mountd
は 2 つのモードの何れかで動作する。
レガシーモードは Linux カーネル 2.4 以前で利用される。
新しいモードは 2.6 以降で利用され、
.B /proc/fs/nfsd
または
.B /proc/fs/nfs
にマウントされる
.B nfsd
仮想ファイルシステムを提供する。
このファイルシステムが 2.6 でマウントされない場合、
レガシーモードが使用される。
.P
新しいモードでは、
.B exportfs
はカーネルには全く情報を提供ぜず、
.B /var/lib/nfs/xtab
ファイルを通して
.B mountd
に情報を提供するだけである。
.B mountd
はカーネルからの要求を待ち受け、必要に応じて情報を提供する。
.P
レガシーモードでは、
(サブネットやネットグループなどではなく)
特定のホストを指定したエクスポート要求は、
カーネルのエクスポートテーブルに直接書き込まれるとともに、
.B /var/lib/nfs/xtab
にも書き込まれる。
さらに、ホストを特定しないエクスポート要求が
.B /var/lib/nfs/rmtab
にリストされているマウントポイントにマッチすると、
このファイルに書かれているホストに向けたエクスポートエントリが、
カーネルのエクスポートテーブルに入れられる。
.SH オプション
.TP 
.B -a
全てのディレクトリをエクスポート・アンエクスポートする。
.TP
.BI "-o " options,...
.BR exports (5)
と同じ形式でエクスポートオプションのリストを指定する。
.TP
.B -i
.B /etc/exports
ファイルを無視する。
デフォルトのオプションとコマンドラインで指定されたオプションのみが使われる。
.TP
.B -r
全てのディレクトリを再エクスポートする。
/var/lib/nfs/xtab を /etc/exports と同期させる。
/etc/exports から削除されたエントリを
/var/lib/nfs/xtab からも削除し、
既に無効になったエントリをカーネルのエクスポートテーブルから削除する。
.TP
.B -u
1 つ以上のディレクトリをアンエクスポートする。
.TP
.B -f
「新しい」モードにおいて、カーネルのエクスポートテーブルから全てを書き出す。
アクティブなクライアントは、
.B mountd
によって追加された新しいエントリを、次に要求を行ったときに取得する。
.TP
.B -v
詳細に表示する。
エクスポートまたはアンエクスポートするときに状況を表示する。
現在のエクスポートリストを表示するとともに、
エクスポートオプションも表示する。
.SH 議論
.\" -------------------- ディレクトリのエクスポート --------------------
.SS ディレクトリのエクスポート
1 番目の書式は、新しいエントリをエクスポートテーブルに追加するための
コマンドの呼び出し方である。
.B "exportfs -a"
を使うと、
.BR exports (5)
にある全てのディレクトリが
.B xtab
に追加され、結果として得られるリストがカーネルに入れられる。
.P
.I host:/path
引き数は、エクスポートするディレクトリとホストを指定する。
.BR exports (5)
に記述されている全てのフォーマットがサポートされている。
全てのホストに対してディレクトリをエクスポートするには、単純に
.I :/path
と指定すればよい。
.P
特定のホスト/ディレクトリのペアに対するエクスポートオプションは、
いろいろな方法で指定できる。
デフォルトのオプションがいくつか存在するが、
これらは
.RB ( -i
オプションが指定されない限り)
.B /etc/exports
のエントリで変更できる。
さらに、管理者はこれらの方法で指定されたオプションを
.B -o
引き数を使って変更できる。
.B -o
オプションの後には、
.BR exports (5)
で指定するのと同じ形式で、コンマで区切ったオプションのリストを置く。
このようにして、
.B exportfs
は既にエクスポートされているディレクトリのオプションを変更することもできる。
.P
.BR nfsd (8)
が使うカーネルのエクスポートテーブルを修正すると、
コマンドラインが解析された後すぐに反映され、
.B xtab
ファイルが更新される。
.P
デフォルトのエクスポートオプションは
.B sync,ro,root_squash,no_delay
である。
.\" -------------------- ディレクトリのアンエクスポート ------------------
.SS ディレクトリのアンエクスポート
3 番目の書式は、現在エクスポートされているディレクトリを
アンエクスポートする方法である。
.B "exportfs -ua"
を使うと、
.B xtab
にリストされているエントリがカーネルのエクスポートテーブルから削除され、
このファイルはクリアされる。
これにより全ての NFS の動作を効率的にシャットダウンすることができる。
.P
個々のエクスポートエントリを削除するためには、
.I host:/path
ペアを指定すればよい。
(このペアがもし存在すれば) 指定されたエントリが
.B xtab
から削除され、対応するカーネルエントリも削除される。
.P
.\" -------------------- エクスポートテーブルのダンプ -----------------
.SS エクスポートテーブルのダンプ
.B exportfs
を引き数なしで起動すると、現在エクスポートされている
ファイルシステムのリストを表示する。
.B -v
オプションを指定すると、各エクスポートエントリに付属している
フラグのリストも表示する。
.\" -------------------- 例 ---------------------------------
.SH 例
次のコマンドは、
.B /etc/exports
にリストされた全てのディレクトリを
.B /var/lib/nfs/xtab
に追加し、
結果として得られるエクスポートエントリをカーネルにプッシュする:
.P
.nf
.B "# exportfs -a
.fi
.P
.B /usr/tmp
ディレクトリをホスト
.B djando
にエクスポートし、非同期書き込みを許可する場合は、次のようにすればよい。
.P
.nf
.B "# exportfs -o async django:/usr/tmp
.fi
.\" -------------------- 依存性 -----------------------------
.SH 依存性
IP ネットワークや DNS ドメイン、NIS ドメインへエクスポートしたときは、
これらのグループに属するクライアントは即座には NFS にアクセスできない。
どちらかというと、このようなエクスポートは
.BR mountd (8)
がこれらのクライアントからのマウント要求を許可するかどうかに対する
ヒントなのである。
既存のマウントポイントはリブートしても
.B rmtab
に保存されるので、これは通常は大した問題にはならない。
.P
ネットワークエントリやドメインエントリをアンエクスポートする場合、
このグループのメンバに現在エクスポートされているエントリについて、
エクスポートが有効になっているかがチェックされ、
既に有効でない場合は削除される。
.P
.\" -------------------- 関連項目 --------------------------------
.SH 関連項目
.BR exports(5) ", " mountd(8)
.\" -------------------- 著者 ----------------------------------
.SH 著者
Olaf Kirch, <okir@monad.swb.de>
.br
Neil Brown, <neilb@cse.unsw.edu.au>
