.\" Revision 1.0 93/06/3 23:00  chk
.\" Initial revision
.\"
.\" Japanese Version Copyright 1998 by MATSUMOTO Shoji. All Rights Reserved.
.\" Translated Wed Mar 11 1998 by MATSUMOTO Shoji.
.\" Updated Sat 23 Oct 1999 by NAKANO Takeo <nakano@apm.seikei.ac.jp>
.\" Updated Tue 16 Nov 1999 by NAKANO Takeo
.\" Updated & Modified Sun Sep  2 23:47:38 JST 2001
.\"         by Yuichi SATO <ysato@h4.dion.ne.jp>
.\" Updated & Modified Tue Nov 13 01:11:52 JST 2001 by Yuichi SATO 
.\" Updated Sun 6 Oct 2002 by NAKANO Takeo
.\" Updated & Modified Sat Apr 17 16:36:26 JST 2004
.\"         by Yuichi SATO <ysato444@yahoo.co.jp>
.\" Updated & Modified Tue May  3 07:35:07 JST 2005 by Yuichi SATO 
.\" Updated & Modified Wed Feb 28 01:32:55 JST 2007 by Yuichi SATO, v1.39
.\"
.\"WORD:	reserved blocks		予約ブロック
.\"WORD:	super block		スーパーブロック
.\"WORD:	filesystem feature	ファイルシステム属性
.\"WORD:	AVAILABILITY		入手方法
.\"
.TH TUNE2FS 8 "May 2006" "E2fsprogs version 1.39"
.SH 名前
tune2fs \- ext2/ext3 ファイルシステムのパラメータを調整する
.SH 書式
.B tune2fs
[
.B \-l
]
[
.B \-c
.I max-mount-counts
]
[
.B \-e
.I errors-behavior
]
[
.B \-f
]
[
.B \-i
.I interval-between-checks
]
[
.B \-j
]
[
.B \-J
.I journal-options
]
[
.B \-m
.I reserved-blocks-percentage
]
[
.B \-o
.RI [^]mount-options [,...]
]
[
.B \-r
.I reserved-blocks-count
]
[
.B \-s
.I sparse-super-flag
]
[
.B \-u
.I user
]
[
.B \-g
.I group
]
[
.B \-C
.I mount-count
]
[
.B \-L
.I volume-name
]
[
.B \-M
.I last-mounted-directory
]
[
.B \-O
.RI [^] feature [,...]
]
[
.B \-T
.I time-last-checked
]
[
.B -U
.I UUID
]
device
.SH 説明
システム管理者は
.BI tune2fs
により Linux ext2/ext3 ファイルシステムの様々なパラメータを調整できる。
.SH オプション
.TP
.BI \-c " max-mount-counts"
.BR e2fsck (8)
がファイルシステムのチェックを行うマウント回数を設定する。
.I max-mount-counts
が 0 または \-1 の場合、
.BR e2fsck (8)
とカーネルはファイルシステムのマウント回数を考慮しない。
.sp
ジャーナリングファイルシステムを使っている場合、
ファイルシステムを強制的にチェックするマウント回数を
ファイルシステムごとにちょっとずつ変えておけば、
すべてのファイルがいっぺんにまとめてチェックされるのを
避けることができる。
.sp
マウント回数に依存したチェックを完全に停止してしまうなら、
その影響を慎重に考えておくべきである。
ディスクドライブ・ケーブル・メモリの故障やカーネルのバグによって、
マークされたりエラーが出ることもなく、
ファイルシステムが破壊されることもあり得る。
ファイルシステムにジャーナリング機能を使っていると、
ファイルシステムに壊れたというマークが付けられることは
\fB絶対にない\fRので、
通常ジャーナリングファイルシステムはチェックされない。
この場合でも、カーネルがファイルシステムエラーを検知すれば、
次のブート時に fsck が実行されるが、
この時点ではデータ喪失を防ぐにはもう遅すぎるかもしれない。
.sp
時間に依存したチェックを行う
.B \-i
オプションも参照すること。
.TP
.BI \-C " mount-count"
ファイルシステムがマウントされた回数を設定する。
.B \-c
オプションで設定された最大マウント回数の
パラメータより大きな値が設定されると、
.BR e2fsck (8) 
は次のブート時に、そのファイルシステムをチェックする。
.TP
.BI \-e " error-behavior"
エラーが発生した時のカーネルの挙動を変更する。
いずれにしてもファイルシステムにエラーが起こると、
次のブート時には必ず
.BR e2fsck (8)
がそのファイルシステムをチェックする。
.I error-behavior
に指定できるのは次の通り。
.RS 1.2i
.TP 1.2i
.B continue
通常の実行を継続する。
.TP
.B remount-ro
ファイルシステムを read-only でマウントしなおす。
.TP
.B panic
カーネルパニックを起こす。
.RE
.TP
.B \-f
エラーが起きたときでも tune2fs に動作を完了させる。
このオプションは、外部ジャーナルを使っているファイルシステム
(あるいは壊れてそう見えるようになってしまったファイルシステム) から、
外部ジャーナルが見えない場合に
.B has_journal
ファイルシステム属性を削除するのに便利である。
.sp
.B 警告:
クリーンにアンマウントされなかったファイルシステムに対して
ジャーナルを一度もリプレイしないまま、
その外部ジャーナルをファイルシステムから切り離してしまうと、
重大なデータ喪失やファイルシステムの破壊をもたらすかもしれない。
.TP
.BI \-g " group"
予約 (reserved) ファイルシステムブロックを利用できるグループを設定する。
.I group
パラメータには GID を数値で指定することも、グループ名を指定することもできる。
グループ名が指定された場合は、スーパーブロックに格納される前に
GID の数値に変換される。
.TP
.B \-i " \fIinterval-between-checks\fR[\fBd\fR|\fBm\fR|\fBw\fR]"
ファイルシステムをチェックする最大の時間間隔を設定する。
数値のみ、もしくは末尾に \fBd\fP を付けると「日」と解釈され、
\fBm\fP, \fBw\fP はそれぞれ「月」「週」と解釈される。
0 を指定すると、時間依存のチェックはしなくなる。
.sp
.BR e2fsck (8)
によるファイルシステムの完全なチェックを定期的に行わせるため、
.B \-c
(マウント回数依存のチェック)、または
.B \-i
(時間依存のチェック) を指定しておくことを強く推奨する。
これらが指定されていない場合、
ディスク・ケーブル・メモリの故障やカーネルのバグによって
ファイルシステムが破壊されても、
データの損失や破壊が起こるまでは知ることができない。
.TP
.B \-j
ext3 ジャーナルをファイルシステムに追加する。
-J オプションが指定されていない場合は、
デフォルトのジャーナルパラメータが用いられ、
(ファイルシステムのサイズに対して)
適切な大きさのジャーナルを作成してファイルシステムに格納する。
ジャーナルを実際に使用するためには、
ext3 をサポートするカーネルが必要である。
.IP
このオプションを使用して、
マウントされたファイルシステム上にジャーナルを作成すると、
不変 (immutable) ファイル
.B .journal
がファイルシステムのトップディレクトリに作成される。
これはファイルシステムがマウントされている間に
ジャーナル inode を安全に作成する唯一の方法だからである。
ext3 ジャーナルは可視であるが、
ファイルシステムがマウントされている間に
削除したり修正したりするのは安全ではない。
そのためジャーナルファイルは不変にされている。
アンマウントされたファイルシステムをチェックする場合、
.BR e2fsck (8)
は自動的に
.B .journal
ファイルを可視でない予約済みジャーナル inode に移動する。
ルートファイルシステム以外の全てのファイルシステムに対して、
次のリブートサイクルで、これが自動的に当然行われるべきである。
ルートファイルシステムは read-only でマウントされるので、
この遷移を有効にするためには、
.BR e2fsck (8)
をレスキュー用フロッピーから実行しなければならない。
.IP
Debian のようないくつかのディストリビューションでは、
レスキュー用フロッピーを使って ext3 ジャーナルを
ルートファイルシステムに追加する必要がないように、
.BR /etc/fstab
ファイルで ext3 ファイルシステムをルートファイルシステムに指定しておくと、
初期 RAM ディスクが使用されたときに、
initrd スクリプトが自動的に ext2 ルートファイルシステムを ext3 に変換する。
.TP
.BR \-J " journal-options"
デフォルトの ext3 ジャーナルパラメータを変更する。
ジャーナルオプションはコンマで区切り、引き数がある場合には
「= (イコール)」記号を使って指定する。
以下のジャーナルオプションがサポートされている:
.RS 1.2i
.TP
.BI size= journal-size
サイズ
.I journal-size
メガバイトのジャーナルを作成してファイルシステムに格納する。
ジャーナルのサイズは最低 1024 ファイルシステムブロックである
(例えば、1kB のブロックを使っている場合は 1 MB、
4kB のブロックを使っている場合は 4 MB である)。
また、ファイルシステムブロックは 102,400 未満でなければならない。
ファイルシステムには、指定したサイズのジャーナルを作成するために
十分な空きスペースがなくてはならない。
.TP
.BI device= external-journal
.I external-journal
にあるジャーナルブロックデバイスにファイルシステムを付加する。
外部ジャーナルは、コマンド
.IP
.B mke2fs -O journal_dev 
.I external-journal
.IP
を使い、前もって作成されていなければならない。
.I external-journal
は、それを使うファイルシステムと同じブロックサイズで
フォーマットされていなければならない。
1 つの外部ジャーナルに複数のファイルシステムを付加することは、
(訳注: ファイルシステム自体では) サポートしているが、
Linux カーネルと
.BR e2fsck (8)
は現在のところ共有外部ジャーナルをサポートしていない。
.IP
デバイス名を直接指定する代わりに、
.BI LABEL= label
または
.BI UUID= UUID
という形式で
.I external-journal
を指定することもできる。
この形式では、外部ジャーナルの場所を、
ジャーナルの先頭の ext2 スーパーブロックに格納されている
UUID やボリュームラベルで指定する。
ジャーナルデバイスのボリュームラベルと UUID を表示するには、
.BR dumpe2fs (8)
を使うこと。
.BR tune2fs (8)
の
.B -L
オプションも参照のこと。
.RE
.IP
ひとつのファイルシステムに対しては、
.BR size " または " device
オプションのどちらか一方しか指定できない。
.TP
.B \-l
ファイルシステムのスーパーブロックの内容を表示する。
.TP
.BI \-L " volume-label"
ファイルシステムのボリュームラベルを設定する。
ext2 ファイルシステムラベルは最大 16 文字まで指定できる。
.I volume-label
が 16 文字より長いと
.B tune2fs
は超過分を切捨て、警告メッセージを出力する。
ボリュームラベルは
.BR mount (8),
.BR fsck (8),
.BR /etc/fstab (5)
(まだあるかも) において、
.B /dev/hda5
のようなブロックスペシャルデバイス名の代わりに、
.BI LABEL= volume_label
という形式で指定して使うことができる。
.TP
.BI \-m " reserved-blocks-percentage"
予約ファイルシステムブロックの割合を % で設定する。
.TP
.BI \-M " last-mounted-directory"
ファイルシステムを最後にマウントしたディレクトリを設定する。
.TP
.BR \-o " [^]\fImount-option\fR[,...]"
指定されたデフォルトのマウントオプションを
ファイルシステムにセット/クリアする。
デフォルトのマウントオプションは、
.BR /etc/fstab (5)
または
.BR mount (8)
のコマンドライン引き数で指定される
マウントオプションで上書きできる。
古いカーネルは、この属性をサポートしていない。
特に 2.4.20 より前のカーネルは、
スーパーブロックにあるデフォルトのマウントオプションを
ほぼ確実に無視する。
.IP
属性をコンマで区切ることにより、
1 つ以上のマウントオプションをクリア/セットできる。
キャレット文字 ('^') を前につけたマウントオプションは、
ファイルシステムのスーパーブロックからクリアされる。
前置文字のないマウントオプションと
プラス文字 ('+') を前につけたマウントオプションは、
ファイルシステムに追加される。
.IP
.B tune2fs
を使ってセット/クリアできるマウントオプションは以下の通り:
.RS 1.2i
.TP
.B debug
このファイルシステムのデバッグコードを有効にする。
.TP
.B bsdgroups
新しいファイルを作成するときに、BSD の動作をエミュレートする。
新規作成されるファイルは、
自身が作成されるディレクトリのグループ ID を使う。
標準的な System V の動作をデフォルトとする。
ディレクトリに setgid ビットセットがない場合、
新規作成されたファイルはカレントプロセスの fsgid を使う。
ディレクトリに setgid ビットセットがある場合、
新規作成されたファイルは親ディレクトリのグループ ID を使い、
新規作成されたのがディレクトリならば、setgid ビットセットも設定する。
.TP
.B user_xattr
ユーザ固有の拡張属性を有効にする。
.TP
.B acl
Posix アクセス制御リスト (Access Control List) を有効にする。
.TP
.B uid16
32 ビットのユーザ ID とグループ ID を無効にする。
これは 16 ビットの値のみを格納したり想定したりする
古いカーネルとの相互運用のためにある。
.TP
.B journal_data
ジャーナリングを有効にしてファイルシステムがマウントされている場合、
(メタデータだけでなく) 全てのデータは
メインのファイルシステムに書き込まれる前に
ジャーナルにコミットされる。
.TP
.B journal_data_ordered
ジャーナリングを有効にしてファイルシステムがマウントされている場合、
メタデータがジャーナルにコミットされる前に、
全てのデータをメインのファイルシステムに強制的に直接書き込む。
.TP
.B journal_data_writeback
ジャーナリングを有効にしてファイルシステムがマウントされている場合、
メタデータがジャーナルにコミットされた後に、
データをメインのファイルシステムに書き込む。
これはスループットを向上させるが、
クラッシュしてジャーナルによる回復をした後で、
ファイルに古いデータが現れるのを許してしまう。
.RE
.TP
.BR \-O " [^]\fIfeature\fR[,...]"
指定したファイルシステム属性 (オプション) をセット/クリアする。
コンマで区切ることにより、
2 つ以上のファイルシステム属性をクリアまたはセットできる。
キャレット文字 ('^') を前においたファイルシステム属性は、
ファイルシステムのスーパーブロックからクリアされる。
前置文字のないファイルシステム属性と
プラス文字 ('+') を前においたファイルシステム属性は、
ファイルシステムにセットされる。
.IP
.B tune2fs
を使ってセット/クリアできるファイルシステム属性は以下の通り:
.RS 1.2i
.TP
.B dir_index
ハッシュ B ツリーを使い、
ファイルが多いディレクトリ内での検索を高速化する。
.TP
.B filetype
ディレクトリエントリにファイルタイプ情報を格納する。
.TP
.B has_journal
ジャーナルを使うことにより、
異常なシャットダウンが起こってもファイルシステムの一貫性を保証する。
このファイルシステム属性をセットするのは、
.B \-j
オプションを使うのと等しい。
.TP
.B sparse_super
大きなファイルシステム上でディスク使用量を少なくするために、
バックアップスーパーブロックの数を制限する。
.RE
.IP
ファイルシステム属性
.B sparse_super
や
.B filetype 
をセットまたはクリアした後は、
ファイルシステムを整合性のある状態に戻すために、
そのファイルシステムに対して
.BR e2fsck (8)
を実行しなければならない。
.B tune2fs
は、必要であれば、システム管理者に対して
.BR e2fsck (8)
を実行するよう要求するメッセージを表示する。
.B dir_index
属性を設定した後に、
.B e2fsck -D
を実行して既存のディレクトリをハッシュ B ツリー形式に変換できる。
.IP
.B 警告:
Linux カーネルのうち 2.0.39 以前と 2.1 系の大部分では、
これらの属性を使用しているファイルシステムをサポートしていない。
これらの属性をサポートしていないカーネルは、
そのファイルシステムをマウントすることができない。
.TP
.BI \-r " reserved-blocks-count"
予約ファイルシステムブロックの量をブロック数で設定する。
.TP
.BR \-s " [" 0 | 1 ]
スーパーブロックを疎 (sparse) にする属性をクリア (0) またはセット (1) する。
この属性をセット (1) すると、
非常に大きなファイルシステムでの無駄を減らすことができる。
これは
.B "\-O sparse_super"
オプションを使った場合と同じである。
.IP
.B 警告:
この機能は 2.0.39 以前の Linux カーネルでは利用できない。
また、2.1 系カーネルでも利用できないものがある。
自分が何をしているのか理解していない限り使うべきではない。
この属性を変更した後、ファイルシステムを正しい状態にするには
.BR e2fsck (8)
を実行する必要がある。
.TP
.BI \-T " time-last-checked"
ファイルシステムが最後に
.B e2fsck
によってチェックされた時刻を設定する。
これは Logical Volume Manager を使い、
整合性の取れている状態のファイルシステムのスナップショットを取って、
休みの間にそのファイルシステムがハードウェア障害などによって
壊れていないかを調べるようなスクリプトで用いると便利である。
ファイルシステムがクリーンなら、このオプションを使って
オリジナルのファイルシステムの最終チェック時刻を設定すればよい。
.I time-last-checked
の書式は、国際時刻書式に、オプションの時刻指定子を加えたもので、
YYYYMMDD[[HHMM]SS] である。
.B now
というキーワードも利用でき、
この場合は最終チェック時刻は現在の時刻に設定される。
.TP
.BI \-u " user"
予約ファイルシステムブロックを利用できるユーザを設定する。
.I user
は UID を数値で指定することも、ユーザ名で指定することもできる。
グループ名が指定された場合は、スーパーブロックに格納される前に
UID の数値に変換される。
.TP
.BI \-U " UUID"
UUID (universally unique identifier:
汎システム的に他とは重ならない識別子) を
.I UUID
に設定する。
UUID はハイフンで区切られた 16 進数の列で、
"c1b9d5a2-f162-11cf-9ece-0020afc76f16"
のような形式である。
.I UUID
パラメータは以下のいずれか 1 つである:
.RS 1.2i
.TP
.I clear
ファイルシステムの UUID をクリアする。
.TP
.I random
新しい UUID をランダムに生成する。
.TP
.I time
新しい UUID を時刻をもとに生成する。
.RE
.IP
UUID は
.BR mount (8),
.BR fsck (8),
.BR /etc/fstab (5)
(まだあるかも) において、
.B /dev/hda1
のようなブロックスペシャルデバイス名の代わりに、
.BI UUID= uuid
という形式で指定して使うことができる。
.IP
より詳しい情報は
.BR uuidgen (8)
を参照すること。
.I /dev/random
や
.I /dev/urandom
のような優れた乱数発生器がシステムに存在しない場合、
.B tune2fs
はランダムに生成した UUID ではなく、
時刻に基づいた UUID を自動的に使用する。
.SH バグ
現時点では見付かっていない。しかし、バグがないという意味ではない。
.SH 著者
.B tune2fs
は、Remy Card <Remy.Card@linux.org> によって作成された。
現在は Theodore Ts'o <tytso@alum.mit.edu> によってメンテナンスされている。
.B tune2fs
は Thodre Ts'o <tytso@mit.edu> によって作成された
ext2fs ライブラリを使用している。
このマニュアルは <chk@data-hh.Hanse.de> によって作成された。
時間に依存するチェックは Uwe Ohse <uwe@tirka.gun.de> によって付加された。
.SH 入手方法
.B tune2fs
は e2fsprogs パッケージの一部であり、
http://e2fsprogs.sourceforge.net から入手できる。
.SH 関連項目
.BR dumpe2fs (8),
.BR e2fsck (8),
.BR mke2fs (8)
