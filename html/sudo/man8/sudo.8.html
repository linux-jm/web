
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of SUDO</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../jm.css">
</HEAD>
<BODY>

<H1>SUDO</H1>
Section: System Manager's Manual (8)<BR>Updated: January 19, 2016<BR><A HREF="#index">Index</A>
<A HREF="../../../index.html">JM Home Page</A>
<A HREF="../../../manual/sudo/release/man8/sudo.8">roff page</A><HR>




<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>

<B>sudo</B>, <B>sudoedit</B> - コマンドを他のユーザとして実行する
<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<DL COMPACT>
<DT>
<B>sudo</B> <B>-h</B>&nbsp;|&nbsp;<B>-K</B>&nbsp;|&nbsp;<B>-k</B>&nbsp;|&nbsp;<B>-V</B>

<DT>
<B>sudo</B> <B>-v</B> [<B>-AknS</B>] [<B>-g</B>&nbsp;<I>group</I>] [<B>-h</B>&nbsp;<I>host</I>] [<B>-p</B>&nbsp;<I>prompt</I>] [<B>-u</B>&nbsp;<I>user</I>]
<DD>
<DT>
<B>sudo</B> <B>-l</B> [<B>-AknS</B>] [<B>-g</B>&nbsp;<I>group</I>] [<B>-h</B>&nbsp;<I>host</I>] [<B>-p</B>&nbsp;<I>prompt</I>] [<B>-U</B>&nbsp;<I>user</I>] [<B>-u</B>&nbsp;<I>user</I>] [<I>command</I>]
<DD>
<DT>
<B>sudo</B> [<B>-AbEHnPS</B>] [<B>-C</B>&nbsp;<I>num</I>] [<B>-g</B>&nbsp;<I>group</I>] [<B>-h</B>&nbsp;<I>host</I>]
[<B>-p</B>&nbsp;<I>prompt</I>] [<B>-r</B>&nbsp;<I>role</I>] [<B>-t</B>&nbsp;<I>type</I>] [<B>-u</B>&nbsp;<I>user</I>]
[<I>VAR</I>=<I>value</I>] [<B>-i</B>&nbsp;|&nbsp;<B>-s</B>] [<I>command</I>]
<DD>
<DT>
<B>sudoedit</B> [<B>-AknS</B>] [<B>-C</B>&nbsp;<I>num</I>] [<B>-g</B>&nbsp;<I>group</I>] [<B>-h</B>&nbsp;<I>host</I>]
[<B>-p</B>&nbsp;<I>prompt</I>] [<B>-u</B>&nbsp;<I>user</I>] <I>file&nbsp;...</I>

</DL>
<A NAME="lbAD">&nbsp;</A>
<H2>説明</H2>

<B>sudo</B> を使用すると、許可されたユーザが、セキュリティポリシーの設定の範囲内で、
スーパーユーザや他のユーザに変身して、<I>command</I> を実行することが可能になる。
セキュリティポリシーへの問い合わせは、ユーザ名によって行われるが、
そのユーザ名を決めるのは、<B>sudo</B> を実行するユーザの実ユーザ ID であって、
実効ユーザ ID ではない。
<P>

<B>sudo</B> はセキュリティポリシーと入出力のロギングについて、プラグイン方式をサポートしている。
従って、サードパーティは、
<B>sudo</B> フロントエンドとシームレスに協働するポリシー・プラグインや入出力ロギング・プラグインを、
独自に開発して配布することができる。
デフォルトのセキュリティポリシーは <I>sudoers</I> であり、その設定は、
<I>/etc/sudoers</I> ファイル、もしくは LDAP を通して行われる。
詳細については、「プラグイン」セクションを参照していただきたい。
<P>

セキュリティポリシーは、あるユーザに <B>sudo</B> を使用する権限があるかどうか、
あるとすれば、どんな権限を持っているかを決定する。
セキュリティポリシーは、ユーザにパスワードや他の認証方法を使って、
本人であることを証明するように要求することができる。
認証が必要な場合、ユーザが自分のパスワードを、
設定によって変更可能な制限時間内に入力しないと、<B>sudo</B> は時間切れで終了する
(訳注: <B>sudo</B> はデフォルトでは、root や変身対象ユーザのパスワードではなく、
<B>sudo</B> を実行するユーザ本人のパスワードを要求する)。
この制限時間はポリシー次第であり、 <I>sudoers</I> セキュリティポリシーの場合、
パスワード・プロンプトがタイムアウトするまでのデフォルトの時間は、5 分間である。
<P>

セキュリティポリシーは、一定時間内ならユーザが認証なしで <B>sudo</B>
を何度も実行できるように、認証情報の一時保存 (credential caching)
をサポートしてもよい。<I>sudoers</I> ポリシーでは、<A HREF="../man5/sudoers.5.html">sudoers</A>(5)
で変更されないかぎり、認証情報を 5 分間保持する。
ユーザは <B>sudo</B> に <B>-v</B> を付けて実行することで、
<I>command</I> を実行しないでも、保存された認証情報を更新することができる。
<P>

<B>sudoedit</B> というコマンド名で起動するのは、<B>sudo</B> に <B>-e</B>
オプション (下記参照) を付けて実行するのと同じである。
<P>

セキュリティポリシーは、ユーザが <B>sudo</B>
を使おうとして成功した場合も失敗した場合も、それをログに記録することができる。
入出力プラグインが設定されている場合は、
<B>sudo</B> 経由で実行するコマンドの入出力もログに残すことができる。
<P>

オプションとして以下のものが使用できる。
<DL COMPACT>
<DT><B>-A</B>, <B>--askpass</B><DD>
通常 <B>sudo</B> がパスワードを要求するとき、
パスワードはユーザが使用している端末から読み込まれる。
<B>-A</B> (<I>askpass</I>) オプションを指定すると、
ヘルパー・プログラム (グラフィカルなものでもよい)
が実行され、ユーザのパスワードを読み込んで、それを標準出力に書き出す。
環境変数 SUDO_ASKPASS が設定されているときは、
それがヘルパー・プログラムのパスになる。
それ以外の場合は、<A HREF="../man5/sudo.conf.5.html">sudo.conf</A>(5) に askpass プログラムを指定している行が存在すれば、
その値が使用される。一例を挙げよう。
<PRE>

<DL COMPACT><DT><DD># askpass ヘルパー・プログラムのパス
<DD>Path askpass /usr/X11R6/bin/ssh-askpass
</DL>
</PRE>

<DL COMPACT><DT><DD>
<P>
利用できる askpass プログラムがないと、<B>sudo</B> はエラーメッセージを出して、
終了する。
</DL>

<DT><B>-a</B> <I>type</I>, <B>--auth-type</B>=<I>type</I><DD>
<I>/etc/login.conf</I> で使用可になっていれば、ユーザを認証する際に指定された
BSD の認証方法 <I>type</I> を使用する。システム管理者は、<I>/etc/login.conf</I>
に &quot;auth-sudo&quot; エントリを追加することで、
sudo 専用の認証方法のリストを指定することができる。このオプションは、
BSD 認証をサポートするシステムでのみ使用できる。
<DT><B>-b</B>, <B>--background</B><DD>
指定されたコマンドをバックグラウンドで実行する。
<B>sudo</B> 経由で起動したバックグラウンド・プロセスは、
シェルのジョブ制御を使って操作できないことに注意していただきたい。
バックグラウンドモードでは、ほとんどの対話的なコマンドがうまく動かないだろう。
<DT><B>-C</B> <I>num</I>, <B>--close-from</B>=<I>num</I><DD>
コマンドを実行するに先立って、<I>num</I> 以上の番号のファイル・ディスクリプタをすべてクローズする。
3 未満の値は指定できない。デフォルトでは、コマンドを実行する際に、
<B>sudo</B> は、標準入力、標準出力、標準エラー以外の、
オープンしているすべてのファイル・ディスクリプタを閉じることになっている。
セキュリティポリシーは、ユーザによるこのオプションの使用を制限することができる。
<I>sudoers</I> ポリシーが <B>-C</B> オプションの使用を許可するのは、
管理者が <I>closefrom_override</I> オプションを有効にしているときのみである。
<DT><B>-c</B> <I>class</I>, <B>--login-class</B>=<I>class</I><DD>
指定されたログインクラス <I>class</I> のリソース・リミットとスケジューリング優先度で、
コマンドを実行する。引き数 <I>class</I> に使用できるのは、<I>/etc/login.conf</I>
で定義されたクラス名か、単独の '-' 文字のどちらかである。
<I>class</I> が <B>-</B> ならば、変身対象ユーザのデフォルトのログインクラスが使用されることになる。
それ以外の場合は、コマンドをスーパーユーザ (ユーザ ID が 0) として実行するか、
あるいは、すでにスーパーユーザとして実行しているシェルから
<B>sudo</B> を実行するかのどちらかでなければならない。
実行されるコマンドがログイン・シェルである場合は、
umask や環境変数といった <I>/etc/login.conf</I> の他の設定も、
存在すれば適用されることになる。
このオプションは BSD ログインクラスを採用しているシステムでのみ有効である。
<DT><B>-E</B>, <B>--preserve-env</B><DD>
現在の環境変数をそのまま保持するのがユーザの意向だと、セキュリティポリシーに指示する。
ユーザが環境を保持する許可を持っていない場合は、
セキュリティポリシーがエラーを返すことになるだろう。
<DT><B>-e</B>, <B>--edit</B><DD>
何らかのコマンドを実行するのではなく、1 個以上のファイルを編集する。
セキュリティポリシーの参照では、コマンドのパス名の代わりに
&quot;sudoedit&quot; という文字列が使用される。
セキュリティポリシーによってユーザに権限があることが認められると、
次のことが順番に行われる。
<DL COMPACT><DT><DD>
<DL COMPACT>
<DT>1.<DD>
編集対象のファイルのコピーをテンポラリファイルとして作成する。
テンポラリファイルのオーナーは <B>sudo</B> を起動したユーザである。
<DT>2.<DD>
セキュリティポリシーによって指定されたエディタを起動して、
テンポラリファイルを編集する。<I>sudoers</I> ポリシーでは、環境変数
SUDO_EDITOR, VISUAL, EDITOR を (この順番で) 使用する。
SUDO_EDITOR, VISUAL, EDITOR のどれも設定されていない場合は、
<A HREF="../man5/sudoers.5.html">sudoers</A>(5) の <I>editor</I> オプションにリストされたプログラムのうち、
最初のものが使われる。
<DT>3.<DD>
編集作業がすむと、テンポラリファイルをオリジナルのファイルにコピーして、
テンポラリファイルを消去する。
</DL>
</DL>

<DL COMPACT><DT><DD>
<P>
編集する権限のないファイルを編集できないようにするため、
セキュリティポリシーによって明示的に許可されていないかぎり、
以下の制限が行われる。
<DL COMPACT><DT><DD>
<DL COMPACT>
<DT><B>&bull;</B><DD>
シンボリックリンクの編集は許可しない (バージョン 1.8.15 以上)。
<DT><B>&bull;</B><DD>
<B>sudo</B> を実行するのが root であるときを除いて、
編集するファイルのパス中にシンボリックリンクがある場合、
そのリンクの親ディレクトリが <B>sudo</B> を実行するユーザにとって書き込み可能ならば、
リンクをたどらない (バージョン 1.8.16 以上)。
<DT><B>&bull;</B><DD>
<B>sudo</B> を実行するのが root であるときを除いて、
ファイルが <B>sudo</B> を実行するユーザにとって書き込み可能なディレクトリにある場合、
そのファイルの編集を許可しない (バージョン 1.8.16 以上)。
</DL>
</DL>

<P>
ユーザがデバイス・スペシャルファイルの編集を許可されることは絶対にない。
<P>
指定されたファイルが存在しない場合は作成する。ここで注意すべきは、
<B>sudo</B> によって実行されるコマンドの大部分と違って、
<B>-e</B> でエディタが実行されるときは、<B>sudo</B> を起動したユーザの環境が、
変更を受けずに使われるということだ。
何らかの理由で <B>sudo</B> が編集した内容でファイルを更新できないときは、
ユーザに警告を発し、編集した内容をテンポラリファイルに保存することになる。
</DL>

<DT><B>-g</B> <I>group</I>, <B>--group</B>=<I>group</I><DD>
コマンドを実行するとき、
プライマリ・グループをパスワード・データベースの変身対象ユーザの項目で指定されているものではなく、
<I>group</I> に設定する。<I>group</I> は、グループ名でもよく、'#' 記号にグループ
ID 番号 (GID) を続けたものでもよい (たとえば、GID 0 なら　#0)。
GID としてコマンドを実行する場合、ほとんどのシェルでは、
'#' をバックスラッシュ ('\') でエスケープする必要がある。
なお、<B>-u</B> オプションが指定されていない場合、コマンドは
<B>sudo</B> を起動したユーザの資格で実行される。いづれにしろ、
プライマリ・グループが <I>group</I> に設定されることに変わりはない。
(訳注: <B>-g</B> オプションを使用するには、
<I>sudoers</I> ポリシーの場合なら、<I>sudoers</I> ファイルのユーザ設定で、
変身対象となるグループを設定しておく必要がある。詳細については、
<A HREF="../man5/sudoers.5.html">sudoers</A>(5) のマニュアルの該当個所を参照していただきたい。)
<DT><B>-H</B>, <B>--set-home</B><DD>
HOME 環境変数を、パスワード・データベースの変身対象ユーザの項目で、
ホームディレクトリとして指定されているものに設定するように、
セキュリティポリシーに要求する。
ポリシーによっては、それがデフォルトの動作になっていることもある。
<DT><B>-h</B>, <B>--help</B><DD>
簡単なヘルプメッセージを標準出力に表示して、終了する。
<DT><B>-h</B> <I>host</I>, <B>--host</B>=<I>host</I><DD>
セキュリティポリシー・プラグインがリモート・コマンドをサポートしているなら、
指定された <I>host</I> でコマンドを実行する。
<I>sudoers</I> プラグインは、現在のところ、
リモート・コマンドの実行をサポートしていないことに注意していただきたい。
このオプションを <B>-l</B> オプションと一緒に使えば、
リモート・ホストにおけるユーザの権限のリストを得ることができる。
(訳注: このオプションについは、sudo_plugin(5) のマニュアルの
&quot;Remote command execution&quot; セクションもご覧いただきたい。
そちらの説明が詳しい。)
<DT><B>-i</B>, <B>--login</B><DD>
パスワード・データベースの変身対象ユーザの項目でログイン・シェルとして指定されているシェルを実行する。すなわち、
<I>.profile</I> や <I>.login</I> といったログイン用のリソース・ファイルが、
シェルによって読み込まれることになる。コマンドを指定すると、
それがシェルに渡され、シェルの  <B>-c</B> オプションを使って実行される。
コマンドを指定しない場合は、対話的シェルが起動される。<B>sudo</B> は、
シェルを実行する前に、変身対象ユーザのホームディレクトリに移動しようとする。
コマンドの実行は、ユーザが普通にログインしたときの環境とほぼ同じ環境で行われる。
<I>sudoers</I> ポリシーを使用している場合に、
<B>-i</B> オプションがコマンドの実行環境にどんな影響を与えるかについては、
<A HREF="../man5/sudoers.5.html">sudoers</A>(5) のマニュアルの「コマンド環境」セクションに説明がある。
<DT><B>-K</B>, <B>--remove-timestamp</B><DD>
<B>-k</B> オプションに似ているが、ユーザの保存された認証情報を完全に消去してしまう点と、
コマンドや他のオプションと組み合わせて使えない点が異なっている。
このオプションはパスワードを要求しない。すべてのセキュリティポリシーが、
認証情報の一時保存をサポートしているわけではない。
<DT><B>-k</B>, <B>--reset-timestamp</B><DD>
コマンドを伴わずに使用した場合は、ユーザの保存された認証情報を無効にする。
言い換えると、次回 <B>sudo</B> を実行するときに、
パスワードが要求されるということだ。このオプション自体は、
パスワードを要求しない。このオプションが追加されたのは、
ユーザが <I>.logout</I> ファイルで、<B>sudo</B>
をパスワードなしで実行できる期間を終了させることができるようにするためである。
<P>
コマンドや、パスワードを必要とするような他のオプションと組み合わせて、
このオプションを使用すると、
<B>sudo</B> がユーザの保存された認証情報を無視することになる。
その結果、<B>sudo</B> は (セキュリティポリシーがパスワードを要求するならば)、
プロンプトを出して、パスワードを要求する。
このとき、ユーザの保存された認証情報の更新は行われない。
<P>
すべてのセキュリティポリシーが、認証情報の一時保存をサポートしているわけではない。
<DT><B>-l</B>, <B>--list</B><DD>
コマンドを指定しない場合は、<B>sudo</B> を実行しているユーザ (あるいは、
<B>-U</B> オプションで指定したユーザ) が、現在ログインしているホストで許可されている
(及び、禁じられている) コマンドのリストを表示する。
このオプションを複数回指定すると、
セキュリティポリシーが詳細な出力形式をサポートしていれば、
長い方のリスト形式が使用される。
<P>
コマンドを指定した場合は、その実行がセキュリティポリシーによって許可されていれば、
コマンドの絶対パスが表示される。
コマンドラインでコマンドに引き数まで指定すると
(訳注: その引き数が許可されていれば)、それも一緒に表示される。
指定したコマンドが許可されていない場合は、
<B>sudo</B> はステータス 1 で終了することになる。
<DT><B>-n</B>, <B>--non-interactive</B><DD>
プロンプトを出してユーザに入力を求めることを一切しない。
コマンドを実行するのにパスワードが必要な場合、
<B>sudo</B> はエラーメッセージを出して、終了することになる。
<DT><B>-P</B>, <B>--preserve-groups</B><DD>
<B>sudo</B> を実行するユーザの所属グループのリストを、変更せずにそのまま使用する。
デフォルトでは、<I>sudoers</I> ポリシーの場合、所属グループは初期化されて、
変身対象ユーザが所属しているグループのリストが使われることになっているのである。
とは言え、実グループ ID と実効グループ ID が、
変身対象ユーザと同一になるようにセットされる点には変わりがない。
<DT><B>-p</B> <I>prompt</I>, <B>--prompt</B>=<I>prompt</I><DD>
パスワードプロンプトに好みの文字列を使用する。文字列には、
エスケープシーケンスが使用できる。<I>sudoers</I> では、
以下のパーセント ('%') エスケープシーケンスをサポートしている。
</DL>
<P>

<DL COMPACT><DT><DD>

<DL COMPACT>
<DT>%H<DD>
ドメイン名を含むホスト名に展開される (マシンのホスト名が完全修飾名であるか、
<A HREF="../man5/sudoers.5.html">sudoers</A>(5) で <I>fqdn</I> オプションがセットされている場合に有効)

<DT>%h<DD>
ドメイン名なしのローカルホスト名に展開
<DT>%p<DD>
パスワードを要求されているユーザ名に展開 (<A HREF="../man5/sudoers.5.html">sudoers</A>(5) の <I>rootpw</I>,
<I>targetpw</I>, <I>runaspw</I> フラグを尊重する)
<DT>%U<DD>
変身対象になるユーザ (<B>-u</B> オプションが同時に指定されていないときは、root
がデフォルト) のログイン名に展開される
<DT>%u<DD>
<B>sudo</B> を起動するユーザのログイン名に展開される
<DT>%%<DD>
連続する二つの '%' 文字は、1 個の '%' 文字そのものを意味する。
</DL>
<P>

自家特製のプロンプトが、
PAM をサポートしているシステムでシステムのパスワードプロンプトに置き替わるのは、
<I>sudoers</I> で <I>passprompt_override</I> フラグが無効になっていない場合である
(訳注: <A HREF="../man5/sudoers.5.html">sudoers</A>(5) の passprompt_override の項も参照していただきたい)。
</DL>

<DL COMPACT>
<DT><B>-r</B> <I>role</I>, <B>--role</B>=<I>role</I><DD>
指定された <I>role</I> を含む
SELinux のセキュリティ・コンテキストでコマンドを実行する。
<DT><B>-S</B>, <B>--stdin</B><DD>
プロンプトを標準エラーに表示するが、パスワードの読み込みは、
ターミナルデバイスを使わずに、標準入力から行う。パスワードは、
末尾に改行を付けなければならない。
<DT><B>-s</B>, <B>--shell</B><DD>
環境変数 SHELL が設定されていれば、そのシェルを、
設定されていなければ、パスワード・データベースで
<B>sudo</B> を起動するユーザのシェルとして指定されているシェルを実行する。
コマンドが指定されている場合は、それをシェルに渡し、シェルの
<B>-c</B> オプションを使って実行する。コマンドが指定されていない場合は、
対話的シェルを開く。
<DT><B>-t</B> <I>type</I>, <B>--type</B>=<I>type</I><DD>
指定された <I>type</I> を含む
SELinux のセキュリティ・コンテキストでコマンドを実行する。
<I>type</I> が指定されていない場合は、ロールからデフォルトのタイプを推測する。
<DT><B>-U</B> <I>user</I>, <B>--other-user</B>=<I>user</I><DD>
<B>sudo</B> を実行しているユーザではなく、
<I>user</I> というユーザの権限の一覧を表示するために、
<B>-l</B> オプションと組み合わせて使用する。自分以外のユーザの権限の表示は、
セキュリティポリシーによって禁止されているかもしれない。
<I>sudoers</I> ポリシーでこのオプションの使用が認められているのは、
root ユーザを別にすれば、現在使用中のホストで許可するコマンドに
ALL が指定してあるユーザだけである。
<DT><B>-u</B> <I>user</I>, <B>--user</B>=<I>user</I><DD>
コマンドをデフォルトの変身対象ユーザ (通常は <I>root</I>)
以外のユーザとして実行する。<I>user</I> に指定するのは、ユーザ名でもよく、
'#' 記号を頭に付けたユーザ ID 番号 (UID) でもよい
(たとえば、UID が 0 なら、#0 と指定する)。多くのシェルでは、
UID の資格でコマンドを実行するには、
'#' をバックスラッシュ ('\') でエスケープしなければならない。
セキュリティポリシーによっては、使用できる UID
をパスワード・データベースに登録されているものに限定していることもある。
<I>sudoers</I> ポリシーでは、<I>targetpw</I> オプションが設定されていないかぎり、
パスワード・データベースに存在しない UID も認めている。
他のセキュリティポリシーでは、それは許されないかもしれない。
<DT><B>-V</B>, <B>--version</B><DD>
<B>sudo</B> のバージョン文字列を、セキュリティポリシー・プラグインや
入出力プラグインのバージョン文字列とともに表示する。
<B>sudo</B> を実行するユーザがあらかじめ root になっている場合は、
<B>sudo</B> がビルドされたときに configure スクリプトに渡された引き数が表示される。
プラグインについては、
デフォルト・オプションのようなより詳細な情報が表示されるかもしれない。
<DT><B>-v</B>, <B>--validate</B><DD>
ユーザの保存された認証情報を更新する。このとき、必要ならば、
ユーザの認証を行う。<I>sudoers</I> プラグインでは、このオプションによって
<B>sudo</B> のタイムアウト時間がもう 5 分間 (これがデフォルトのタイムアウト時間)
伸びるが、このオプションがコマンドを実行することはない。
すべてのセキュリティポリシーが認証情報の一時保存に対応しているわけではない。
<DT><B>--</B><DD>
<B>--</B> オプションがあると、
<B>sudo</B> はそこでコマンドライン引き数の処理をやめる。
</DL>
<P>

さらに、コマンドのために設定したい環境変数も、<I>VAR</I>=<I>value</I>、たとえば
LD_LIBRARY_PATH=<I>/usr/local/pkg/lib</I>
といった形でコマンドラインで渡すことができる。コマンドラインで渡す環境変数は、
セキュリティポリシー・プラグインによって課される制限の対象になる。
<I>sudoers</I> ポリシーの場合、コマンドラインで渡される環境変数は、
通常の環境変数と同じ制限の対象になるが、一つだけ重要な相違がある。
<I>sudoers</I> で <I>setenv</I> オプションが設定されているか、実行するコマンドに
SETENV タグが付いているか、あるいは、マッチするコマンドが ALL である場合は、
ユーザは他の状況なら禁じられているような環境変数を設定することができるのだ。
詳細については、<A HREF="../man5/sudoers.5.html">sudoers</A>(5) のマニュアルを参照していただきたい。
<A NAME="lbAE">&nbsp;</A>
<H2>コマンドの実行</H2>

<B>sudo</B> がコマンドを実行するとき、
セキュリティポリシーによってコマンドの実行環境が設定される。たいていの場合、
実ユーザ、実効ユーザ、実グループ、実効グループ、及びその ID 番号が、変身対象ユーザの、
パスワード・データベースに記載されているものと同一になるようにセットされる。
所属グループのリストも、(<B>-P</B> オプションが指定されていないかぎり)
グループ・データベースに基づいて、初期化される。
<P>

セキュリティポリシーは、以下のパラメータを設定することができる。
<DL COMPACT>
<DT><B>&bull;</B><DD>
実ユーザ ID と実効ユーザ ID
<DT><B>&bull;</B><DD>
実グループ ID と実効グループ ID
<DT><B>&bull;</B><DD>
補助グループ ID
<DT><B>&bull;</B><DD>
環境のリスト
<DT><B>&bull;</B><DD>
カレント・ワーキング・ディレクトリ
<DT><B>&bull;</B><DD>
ファイル作成時のモード・マスク (umask)
<DT><B>&bull;</B><DD>
SELinux の role と type
<DT><B>&bull;</B><DD>
Solaris の project
<DT><B>&bull;</B><DD>
Solaris の privilege
<DT><B>&bull;</B><DD>
BSD のログインクラス (login class)
<DT><B>&bull;</B><DD>
スケジューリング優先度 (nice value とも言う)
</DL>
<A NAME="lbAF">&nbsp;</A>
<H3>プロセス・モデル</H3>

<B>sudo</B> は、コマンドを実行するとき、まず <A HREF="../../LDP_man-pages/man2/fork.2.html">fork</A>(2) を呼び、
実行環境を上記のように設定してから、子プロセスで execve システムコールを呼び出す。
メインの <B>sudo</B> プロセスは、コマンドが完了するまで wait し、完了したら、
コマンドの終了ステータスをセキュリティポリシーの close 関数に渡してから、
終了する。入出力ロギング・プラグインが設定されている場合や、
セキュリティポリシーが明示的にそれを要求している場合は、
擬似端末 (&quot;pty&quot;) が新規に作成され、二つ目の <B>sudo</B> プロセスが、
既に存在しているユーザの pty と、コマンドがそこで実行されている新しい pty との間で、
ジョブ制御シグナルを中継するために使用される。
この二つ目の <B>sudo</B> プロセスによって、たとえば、
コマンドのサスペンドやレジュームといったことが可能になるのである。
この仕組みがなければ、コマンドは、POSIX で &quot;orphaned process group&quot;
と言われる状態に陥り、どんなジョブ制御シグナルも受け取れないことになってしまうだろう。
なお、特殊ケースとして次のことがある。ポリシー・プラグインが
close 関数を定義していず、しかも、pty が要求されていない場合は、
<B>sudo</B> は <A HREF="../../LDP_man-pages/man2/fork.2.html">fork</A>(2) を最初に呼ぶことをせず、直接コマンドを実行する。
<I>sudoers</I> ポリシー・プラグインで close 関数が定義されることになるのは、
入出力ロギングが有効か、pty が要求されているか、<I>pam_session</I> または
<I>pam_setcred</I> が有効な場合だけである。PAM を使用しているシステムでは、
デフォルトで <I>pam_session</I> と <I>pam_setcred</I>
が有効になることに注意していただきたい。
(訳注: 上記の「特殊ケースとして」以下についてだが、最近の <B>sudo</B> では、
<I>sudoers</I> ポリシーにおける <I>pam_session</I> や <I>pam_setcred</I>
の有効/無効に関係なく、pty が要求されていない場合は、
fork せずに直接コマンドを実行するようである。)
<A NAME="lbAG">&nbsp;</A>
<H3>シグナルの処理</H3>

コマンドが <B>sudo</B> プロセスの子プロセスとして実行されているとき、
<B>sudo</B> は自分が受け取ったシグナルをそのコマンドに中継する。
ただし、SIGINT や SIGQUIT シグナルが中継されるのは、
そのコマンドが新たに開いた pty で実行されているときか、
シグナルがカーネルではなく、ユーザ・プロセスによって送出されたときだけである。
そうなっていることで、ユーザが control-C を入力するたびに、
コマンドが SIGINT シグナルを二重に受け取らないようにしているのだ。
SIGSTOP や SIGKILL のようないくつかのシグナルは、
捕獲できないので、コマンドに中継されることもない。
だから、<B>sudo</B> によって実行されているコマンドをサスペンドしたかったら、
原則として、SIGSTOP ではなく、SIGTSTP コマンドを使用するべきである。
<P>

<B>sudo</B> は原則として、自分が受け取ったシグナルを子プロセスに中継するわけだが、
自分が実行しているコマンドから来たシグナルは、中継しないという例外がある。
コマンドが意図に反して自分自身を殺してしまわないようにしているのだ。
システムによっては、<A HREF="../../SysVinit/man8/reboot.8.html">reboot</A>(8) コマンドが、システムをリブートする前に、
自分自身を除くすべてのノン・システム・プロセスに SIGTERM を送るものがある。
そうした場合も、中継の抑制があるため、<B>sudo</B> は自分が受け取った
SIGTERM シグナルを <A HREF="../../SysVinit/man8/reboot.8.html">reboot</A>(8) に送り返さない。もし送り返すようになっていたら、
システムが実際にリブートする前に <A HREF="../../SysVinit/man8/reboot.8.html">reboot</A>(8) が終了して、
システムがシングルユーザ・モードによく似た半分死んだ状態 (half-dead state)
に陥ってしまうだろう。とは言え、注意していただきたいが、
この中継の抑制が行われるのは、<B>sudo</B> によって直接実行されるコマンドに対してのみであり、
そのコマンドが生成するかもしれない他のどんなプロセスに対しても当てはまらない。
それ故、<A HREF="../../SysVinit/man8/reboot.8.html">reboot</A>(8) や <A HREF="../../SysVinit/man8/shutdown.8.html">shutdown</A>(8) を呼び出すスクリプトを
<B>sudo</B> 経由で実行すると、システムがそうしたわけのわからない状態に陥ることがある。
<A HREF="../../SysVinit/man8/reboot.8.html">reboot</A>(8) や <A HREF="../../SysVinit/man8/shutdown.8.html">shutdown</A>(8) の実行に <B>exec</B>() ファミリーの関数ではなく、
<B>system</B>() 関数を使用していると、
(<B>system</B>() は、呼び出しプロセスとコマンドの間にシェルを挟むため)
そうしたことが起こりかねないのだ。
<P>

入出力ロギング・プラグインがロードされていない場合に、
ポリシー・プラグインが <B>close</B>() 関数を定義してもいず、
コマンドのタイムアウトを設定していることもなく、コマンドを新たに開いた pty
で実行することを要求してもいなかったならば、<B>sudo</B> は、
コマンドを子プロセスとしてではなく、直接実行するかもしれない。
<A NAME="lbAH">&nbsp;</A>
<H3>プラグイン</H3>

プラグインは、<A HREF="../man5/sudo.conf.5.html">sudo.conf</A>(5) ファイルの Plugin 命令 (directive)
で指定することができる。プラグインは、(システムがサポートしていれば)
動的な共有オブジェクト (dynamic shared object) としてロードすることもできるし、
また、<B>sudo</B> のバイナリに直接組み込むこともできる。<A HREF="../man5/sudo.conf.5.html">sudo.conf</A>(5)
ファイルが存在しない場合や、<A HREF="../man5/sudo.conf.5.html">sudo.conf</A>(5) ファイルに Plugin の行がない場合は、
<B>sudo</B> は従来どおり、<I>sudoers</I> のセキュリティポリシーと入出力ロギングを使用することになる。
<I>/etc/sudo.conf</I> ファイルの詳細については、
<A HREF="../man5/sudo.conf.5.html">sudo.conf</A>(5) のマニュアルを参照していただきたい。
<B>sudo</B> プラグインの設計についての詳しい情報は、
sudo_plugin(5) のマニュアルにある。
<A NAME="lbAI">&nbsp;</A>
<H2>終了ステータス</H2>

コマンドの実行に成功した場合、<B>sudo</B> が返す終了ステータスは、
実行したプログラムの終了ステータスである。
コマンドがシグナルを受け取ることによって終了した場合は、
<B>sudo</B> はコマンドを終了させたシグナルを自分自身に送るようになっている。
<P>

それ以外の場合、設定やパーミッションに問題があったり、
<B>sudo</B> が指定されたコマンドを実行できなかったりしたときは、
<B>sudo</B> は終了ステータス 1 で終了する。後者の場合は、
エラーメッセージが標準エラーに表示される。<B>sudo</B> がユーザの
PATH にある一つ以上のエントリを <A HREF="../../LDP_man-pages/man2/stat.2.html">stat</A>(2) できなかったときも、
エラーが標準エラーに表示される (ただし、PATH
中のディレクトリが存在しなかったときや、実際にはディレクトリでなかったときは、
そのエントリは無視され、エラーは表示されない)。そういったことは、
通常の状態では起きるはずがないことである。<A HREF="../../LDP_man-pages/man2/stat.2.html">stat</A>(2) が &quot;permission denied&quot;
を返す理由で一番よくあるのは、ユーザがオートマウンターを使用していて、
PATH 中のディレクトリの一つが目下到達不可能なマシンにある場合だ。
<A NAME="lbAJ">&nbsp;</A>
<H2>セキュリティに関するメモ</H2>

<B>sudo</B> は、外部のコマンドをできるだけ安全に実行しようとする。
<P>

偽コマンドの実行 (command spoofing) を防止するため、<B>sudo</B>
はコマンドを捜してユーザの PATH を検索する際に、&quot;.&quot; や &quot;&quot;
(どちらもカレント・ディレクトリを意味する) を最後に調べる (そのどちらか、
あるいは両方が、PATH 中に存在すればだが)。とは言え、環境変数 PATH そのものは変更されずに、
そのまま <B>sudo</B> が実行するプログラムに渡されることに注意していただきたい。
<P>

次のようなファイルを実行する <B>sudo</B> 権限を、絶対にユーザに許可してはいけない。
すなわち、そのユーザに書き込みできるファイルや、
そのユーザに書き込みできるディレクトリにあるファイルを実行する権限である。
もし、ユーザがコマンドを書き換えたり、別のコマンドと置き換えたりできるならば、
そのユーザは自分が実行できるコマンドに何でも追加できるわけで、
それを制限する方法はまったくないのだ。
<P>

<B>sudo</B> は通常、自分が明示的に実行するコマンドしかログに記録しないことに注意していただきたい。
ユーザが sudo su や sudo sh といったコマンドを実行した場合、
そのシェルからさらに実行されるコマンドは、
<B>sudo</B> のセキュリティポリシーの対象にはならないのだ。
同じことが、シェル・エスケープを提供するコマンド (たいていのエディターが、
それに含まれる) についても言える。確かに、入出力ロギングが有効になっている場合は、
シェルからさらに実行されるコマンドも、その入力や出力を記録されることになるが、
従来からあるログファイルに記録されるわけではないのである。従って、
ユーザに <B>sudo</B> 経由で、あるコマンドを実行する権限を与えるときは、
そのコマンドが事実上ルート・シェルをユーザにうっかり与えていないことを、
念には念を入れて確認しなければならない。もっと詳しいことをお知りになりたかったら、
<A HREF="../man5/sudoers.5.html">sudoers</A>(5) のマニュアルの「シェル・エスケープを防止する」というセクションをご覧になるとよい。
<P>

セキュリティ上問題になりかねない情報を漏洩しないように、
<B>sudo</B> はデフォルトでは、自己を実行中のコアダンプを抑止している
(指定されたコマンドを実行するときに、コアダンプを有効にし直すのだ)。
この動作は昔からのものであり、たいていのオペレーティングシステムが
setuid プロセスにデフォルトではコアダンプを許していた時代からそうなっていた。
<B>sudo</B> 自体のクラッシュをデバッグするためにコアダンプを有効に戻したいならば、
以下のように、<A HREF="../man5/sudo.conf.5.html">sudo.conf</A>(5) ファイルで &quot;disable_coredump&quot; を
false にすればよい。
<PRE>

<DL COMPACT><DT><DD>Set disable_coredump false
</DL>
</PRE>

<P>

詳細については、<A HREF="../man5/sudo.conf.5.html">sudo.conf</A>(5) のマニュアルを参照していただきたい。
<A NAME="lbAK">&nbsp;</A>
<H2>環境変数</H2>

<B>sudo</B> は以下の環境変数を利用する。
実行するコマンドの環境が実際にどうなるかは、セキュリティポリシー次第である。
<DL COMPACT>
<DT>EDITOR<DD>
環境変数 SUDO_EDITOR や VISUAL が設定されていないとき、
<B>-e</B> (sudoedit) モードで使用するデフォルトのエディタ。
<DT>MAIL<DD>
<B>-i</B> オプションが指定された場合や、<I>sudoers</I> で <I>env_reset</I>
が有効になっている場合には (<I>env_keep</I> のリストに
MAIL が存在しないかぎり)、変身対象ユーザのメールスプールにセットされる。
<DT>HOME<DD>
次の場合には、変身対象ユーザのホームディレクトリにセットされる。
<B>-i</B> や <B>-H</B> オプションが指定された場合、
<B>-s</B> オプションが指定され、かつ <I>sudoers</I> で <I>set_home</I> が設定されている場合、
<I>always_set_home</I> が <I>sudoers</I> で有効になっている場合、
あるいは、<I>env_reset</I> が <I>sudoers</I> で有効になっていて、
しかも <I>HOME</I> が <I>env_keep</I> のリストに存在しない場合。
<DT>LOGNAME<DD>
次の場合には、変身対象ユーザのログイン名にセットされる。
<B>-i</B> オプションが指定された場合、
<I>set_logname</I> オプションが <I>sudoers</I> で有効になっている場合、
あるいは、<I>env_reset</I> オプションが <I>sudoers</I> で有効になっていて、
LOGNAME が <I>env_keep</I> のリストに存在しない場合。
<DT>PATH<DD>
セキュリティポリシーによって上書きされるかもしれない。
<DT>SHELL<DD>
<B>-s</B> オプションで起動するシェルを決めるのに使用する。
<DT>SUDO_ASKPASS<DD>
ターミナルが利用できない場合や、<B>-A</B> オプションが指定された場合に、
パスワードを読み込むのに使用するヘルパー・プログラムのパスを指定する。
<DT>SUDO_COMMAND<DD>
sudo が実行するコマンドにセットされる。
<DT>SUDO_EDITOR<DD>
<B>-e</B> (sudoedit) モードで使用するデフォルトのエディタ。
<DT>SUDO_GID<DD>
sudo を起動したユーザのグループ ID にセットされる。
<DT>SUDO_PROMPT<DD>
デフォルトのパスワード・プロンプトとして使用する。
<DT>SUDO_PS1<DD>
設定すると、実行されるプログラムの PS1 がこの変数の値にセットされる。
<DT>SUDO_UID<DD>
sudo を起動したユーザのユーザ ID にセットされる。
<DT>SUDO_USER<DD>
sudo を起動したユーザのログイン名にセットされる。
<DT>USER<DD>
上で述べた LOGNAME と同じ値にセットされる。
<DT>USERNAME<DD>
USER と同じ。
<DT>VISUAL<DD>
SUDO_EDITOR が設定されていない場合に、<B>-e</B> (sudoedit)
モードで使用するデフォルトのエディタ。
</DL>
<A NAME="lbAL">&nbsp;</A>
<H2>ファイル</H2>

<DL COMPACT>
<DT><I>/etc/sudo.conf</I><DD>
<B>sudo</B> フロントエンドの設定ファイル
</DL>
<A NAME="lbAM">&nbsp;</A>
<H2>用例</H2>

注意: 以下の例は、セキュリティポリシーが適切に設定されていることを前提にしている。
<P>

読み取り不可のディレクトリのファイル一覧を取得する。
<PRE>

<DL COMPACT><DT><DD>$ sudo ls /usr/local/protected
</DL>
</PRE>

<P>

ユーザ yaz のホームディレクトリのファイル一覧を取得する。
ただし、~yaz を含むファイルシステムが、別のマシンにあって、
root でアクセスできるようにエクスポートされていない場合。
<PRE>

<DL COMPACT><DT><DD>$ sudo -u yaz ls ~yaz
</DL>
</PRE>

<P>

ユーザ www として <I>index.html</I> ファイルを編集する。
<PRE>

<DL COMPACT><DT><DD>$ sudo -u www vi ~www/htdocs/index.html
</DL>
</PRE>

<P>

root と adm グループのユーザだけがアクセスできるシステムログを閲覧する。
<PRE>

<DL COMPACT><DT><DD>$ sudo -g adm view /var/log/syslog
</DL>
</PRE>

<P>

jim に変身してエディタを実行する。プライマリグループには別のグループを指定する。
<PRE>

<DL COMPACT><DT><DD>$ sudo -u jim -g audio vi ~jim/sound.txt
</DL>
</PRE>

<P>

マシンをリブートする。
<PRE>

<DL COMPACT><DT><DD>$ sudo shutdown -r +15 &quot;quick reboot&quot;
</DL>
</PRE>

<P>

/home パーティションに存在するディレクトリのディスク使用量リストを作成する。
cd やファイル・リダイレクションがきちんと動作するように、
コマンドをサブシェルで実行している点に注目していただきたい。
<PRE>

<DL COMPACT><DT><DD>$ sudo sh -c &quot;cd /home ; du -s * | sort -rn &gt; USAGE&quot;
</DL>
</PRE>

<A NAME="lbAN">&nbsp;</A>
<H2>参照項目</H2>

<A HREF="../../0MultiFileIdx/man1/su.1.html">su</A>(1), <A HREF="../../LDP_man-pages/man2/stat.2.html">stat</A>(2), <A HREF="../../0MultiFileIdx/man5/passwd.5.html">passwd</A>(5), <A HREF="../man5/sudo.conf.5.html">sudo.conf</A>(5), <A HREF="../man5/sudoers.5.html">sudoers</A>(5), sudo_plugin(5),
<A HREF="../man8/sudoreplay.8.html">sudoreplay</A>(8), <A HREF="../man8/visudo.8.html">visudo</A>(8)
<A NAME="lbAO">&nbsp;</A>
<H2>履歴</H2>

sudo の簡単な履歴については、<B>sudo</B> の配布に含まれている
HISTORY ファイルをご覧いただきたい。
(<A HREF="https://www.sudo.ws/history.html)">https://www.sudo.ws/history.html)</A>
<A NAME="lbAP">&nbsp;</A>
<H2>作者</H2>

多数の人々が長年に渡って <B>sudo</B> の開発に携わってきた。
当バージョンは主として次の者が書いたコードからできている。
<P>
<DL COMPACT><DT><DD>
Todd C. Miller
</DL>

<P>

<B>sudo</B> の開発に貢献してくださった方々の詳細なリストについては、
配布物中の CONTRIBUTORS ファイルをご覧になっていただきたい。
(<A HREF="https://www.sudo.ws/contributors.html)">https://www.sudo.ws/contributors.html)</A>
<A NAME="lbAQ">&nbsp;</A>
<H2>警告</H2>

もし、ユーザが <B>sudo</B> 経由で任意のコマンドを実行することを許可されているなら、
そのユーザがルート・シェルを手に入れるのを防止する簡単な方法は存在しない。
また、(エディタをはじめとする) 多くのプログラムが、
シェル・エスケープを通してユーザがコマンドを実行できるようにしており、
この方法でユーザは <B>sudo</B> によるチェックをすり抜けることができる。
とは言え、たいていのシステムでは、<A HREF="../man5/sudoers.5.html">sudoers</A>(5) プラグインの <I>noexec</I>
機能を使用することでシェル・エスケープを抑止することが可能だ。
<P>

下記のように <B>sudo</B> 中で直に <B>cd</B> コマンドを実行しても意味がない。
<PRE>

<DL COMPACT><DT><DD>$ sudo cd /usr/local/protected
</DL>
</PRE>

<P>

なぜなら、このコマンドが終了したとき、その親プロセス (すなわち、<B>sudo</B>
を実行したシェル) は、<B>sudo</B> を実行する前と同じ状態に戻るからだ。
<B>cd</B> については、「用例」セクションもご覧になっていただきたい。
<P>

<B>sudo</B> を介してシェルスクリプトを実行すると、ある種のオペレーティング・システムで
setuid シェルスクリプトを危険なものにしているのと同一の、
カーネルのバグが表面化するおそれがある (使用している OS に /dev/fd/
ディレクトリがあれば、setuid シェルスクリプトはたいてい安全である)。
<A NAME="lbAR">&nbsp;</A>
<H2>バグ</H2>

<B>sudo</B> にバグを発見したと思ったら、<A HREF="https://bugzilla.sudo.ws/">https://bugzilla.sudo.ws/</A>
にアクセスして、バグレポートを提出していただきたい。
<A NAME="lbAS">&nbsp;</A>
<H2>サポート</H2>

ある程度の無料サポートが sudo-users メーリングリストを通して利用できる。
購読やアーカイブの検索には、次の URL を御覧になるとよい。
<A HREF="https://www.sudo.ws/mailman/listinfo/sudo-users">https://www.sudo.ws/mailman/listinfo/sudo-users</A>
<A NAME="lbAT">&nbsp;</A>
<H2>免責</H2>

<B>sudo</B> は「現状のまま」提供される。 明示的な、あるいは黙示的ないかなる保証も、
商品性や特定目的への適合性についての黙示的な保証を含め、
またそれのみに止まらず、これを否認する。詳細な全文については、
<B>sudo</B> と一緒に配布されている LICENSE ファイルや、
次の Web ページをご覧いただきたい。
<A HREF="https://www.sudo.ws/license.html">https://www.sudo.ws/license.html</A>
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">説明</A><DD>
<DT><A HREF="#lbAE">コマンドの実行</A><DD>
<DL>
<DT><A HREF="#lbAF">プロセス・モデル</A><DD>
<DT><A HREF="#lbAG">シグナルの処理</A><DD>
<DT><A HREF="#lbAH">プラグイン</A><DD>
</DL>
<DT><A HREF="#lbAI">終了ステータス</A><DD>
<DT><A HREF="#lbAJ">セキュリティに関するメモ</A><DD>
<DT><A HREF="#lbAK">環境変数</A><DD>
<DT><A HREF="#lbAL">ファイル</A><DD>
<DT><A HREF="#lbAM">用例</A><DD>
<DT><A HREF="#lbAN">参照項目</A><DD>
<DT><A HREF="#lbAO">履歴</A><DD>
<DT><A HREF="#lbAP">作者</A><DD>
<DT><A HREF="#lbAQ">警告</A><DD>
<DT><A HREF="#lbAR">バグ</A><DD>
<DT><A HREF="#lbAS">サポート</A><DD>
<DT><A HREF="#lbAT">免責</A><DD>
</DL>
<HR>
This document was created by
<A HREF="../../man/man1/man2html.1.html">man2html</A>,
using the manual pages.<BR>
Time: 03:33:46 GMT, December 05, 2022
</BODY>
</HTML>
