
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of EXPORTS</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../jm.css">
</HEAD>
<BODY>

<H1>EXPORTS</H1>
Section: File Formats (5)<BR>Updated: 28 October 1999<BR><A HREF="#index">Index</A>
<A HREF="../../../index.html">JM Home Page</A>
<A HREF="../../../manual/nfs-utils/release/man5/exports.5">roff page</A><HR>


<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>

exports - (カーネルベースの NFS で) エクスポート (export) される NFS ファイルシステム 
<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B>/etc/exports</B>

<A NAME="lbAD">&nbsp;</A>
<H2>説明</H2>

<I>/etc/exports</I>

ファイルは、
NFS のクライアントにどのファイルシステムをエクスポート (export) してよいか、
というアクセスコントロールリストを与える。
これは
<B><A HREF="../man8/exportfs.8.html">exportfs</A></B>(8)

によって使用され、NFS マウントデーモン
<B><A HREF="../man8/mountd.8.html">mountd</A></B>(8)

と、カーネルベースの NFS ファイルサーバデーモン
<B><A HREF="../man8/nfsd.8.html">nfsd</A></B>(8)

とに情報を与える。
<P>

このファイルの書式は SunOS の
<I>exports</I>

ファイルと似ている。
それぞれの行には、エクスポートポイントと、
そのポイントにあるファイルシステムをマウントできるクライアントを
スペースで区切って指定したリストが書かれている。
リストされたクライアントの直後には、
そのクライアント向けのエクスポートオプションをコンマで区切ってリスト指定し、
リスト全体を括弧で括って置くこともできる。
クライアント名とこのオプションリストとの間にはスペースを入れてはいけない。
<P>

空行は無視され、# 以降行末まではコメントとみなされる。
行末にバックスラッシュをおけば、エントリは次の行に継続できる。
エクスポート名に空白が含まれる場合は、ダブルクォートで括る。
エクスポートパス名には、
空白やその他通常は使われない文字を指定することもできる。
このような文字を使う場合は、バックスラッシュの後に
3 桁の 8 進数で文字コードを指定する。
<A NAME="lbAE">&nbsp;</A>
<H3>マシン名のフォーマット</H3>

NFS クライアントはいろいろな方法で指定できる。
<DL COMPACT>
<DT>single host<DD>
これはもっとも普通のフォーマットである。ホストの指定には、
レゾルバが認識できる省略形、FQDN、IP アドレスのどれを用いてもよい。
<DT>netgroups<DD>
NIS のネットグループを
<I>@group</I>

のように与えることができる。ネットグループの各メンバーは、
ホストの部分だけが取り出され、メンバーに入れられる。
ホストの部分が空だったり、単一のダッシュ (-) だったものは無視される。
<DT>ワイルドカード<DD>
マシン名の指定には、ワイルドカード文字として <I>*</I> と <I>?</I> を
用いることができる。これらを使うと <I>exports</I> ファイルをコンパクトにできる。
例えば <I>*.cs.foo.edu</I> はドメイン <I>cs.foo.edu</I> にあるすべての
ホストにマッチする。
これらのワイルドカード文字はドメイン名のドット (.) にもマッチするので、
ここで指定されたパターンは <I>cs.foo.edu</I> の任意のサブドメイン内の
全てのホストにマッチする。
<DT>IP networks<DD>
ディレクトリを IP の (サブ) ネットワークに存在するすべてのホストに
同時にエクスポートすることもできる。
これには IP アドレスとネットマスクのペアを
<I>address/netmask</I>

のように指定すればよい。
ここで netmask は 10 進数をドットで区切って指定することもできるし、
連続するマスクの長さで指定することもできる
(例えば、ネットワークベースアドレスに `/255.255.252.0' を追加した場合でも、
`/22' を追加した場合でも、ホスト部が 10 ビットの同じサブネットワークになる)。
ワイルドカード文字は、通常 IP アドレスに対しては動作しない。
ただし DNS の逆引きが失敗すると、たまたま動作してしまうこともあり得る。




















</DL>
<A NAME="lbAF">&nbsp;</A>
<H3>RPCSEC_GSS セキュリティ</H3>

エクスポートへのアクセスを rpcsec_gss セキュリティを使って制限するには、
クライアントとして特別な文字列 &quot;gss/krb5&quot; を使うこと。
rpcsec_gss とクライアントの IP アドレスによる資格を
同時に要求することはできない。
<P>

<A NAME="lbAG">&nbsp;</A>
<H3>一般的なオプション</H3>

<I>exportfs</I>

は以下のエクスポートオプションを受け付ける。
<DL COMPACT>
<DT><I>secure</I>

<DD>
このオプションを指定すると、IPPORT_RESERVED (1024) より小さな
internet ポートから発したリクエストしか受けつけない。
このオプションはデフォルトで有効になっている。
無効にするには
<I>insecure</I>

と指定する。
<DT><I>rw</I>

<DD>
この NFS ボリュームに対して、書き込みと読み出しリクエストの両方を許可する。
デフォルトではファイルシステムを変更する全ての書き込みを拒否する
(これは
<I>ro </I>

オプションで明示した場合も同じ)。
<DT><I>async</I>

<DD>
このオプションは NFS サーバを NFS プロトコルに違反させ、
あるリクエストによってなされた変更が安定した保存場所
(例えばディスクドライブ) に渡される前に、
そのリクエストに応えるようにする。
<P>
このオプションを用いると通常は性能が向上するが、
クリーンでないサーバの再起動 (つまりクラッシュ)
によってデータが失われたり破壊されうるという代償を伴う。
<P>
nfs-utils の 1.0.0 まででは、このオプションがデフォルトであった。
このリリース以降は
<I>sync</I>

がデフォルトとなり、
<I>async</I>

は必要な場合は明示的に指定しなければならない。
システム管理者にこの変更を知らせるため、
<I>sync</I>

と
<I>async</I>

のいずれも指定されていない場合、`exportfs' は警告を発する。
<DT><I>no_wdelay</I>

<DD>
このオプションは同時に
<I>async</I>

が設定されていると効果を持たない。
NFS サーバは、書き込み要求を受けたとき、
関連した別の書き込み要求が実行中である (または近々到着する) と予想した場合、
その要求のディスクへの反映を少し遅らせる。
これにより一度の操作で複数の書き込み要求が
ディスクに反映されるので、性能が向上する。
NFS サーバが受け取るデータの書き込み要求が、
主として関連性のない小さなものの場合には、
この動作は実際には性能を低下させてしまうので、
<I>no_wdelay</I>

を指定して無効にできる。
デフォルトの動作を
<I>wdelay</I>

オプションで明示的に指定することもできる。
<DT><I>nohide</I>

<DD>
このオプションは IRIX NFS で提供される同名のオプションを元にしている。
サーバが 2 つのファイルシステムをエクスポートし、
そのうちの 1 つが他方にマウントされている場合、
クライアントが両者にアクセスを行うには、
両方のファイルシステムを明示的にマウントしなければならない。
親の方をマウントしただけでは、
もう一方のファイルシステムがマウントされているディレクトリは空に見える。
このようなファイルシステムは &quot;hidden&quot; といわれる。
<P>
hidden にしたくないファイルシステムに
<I>nohide</I>

オプションを設定すれば、
適切な権限のあるクライアントは変更を知らされることなく、
親から子のファイルシステムに移動できる。
<P>
しかし NFS クライアントのなかには、
このような状況 (例えば、見かけ上 1 つのファイルシステムで
2 つのファイルが同じ inode 番号を持つような状況)
ではうまく動作しないものもある。
<P>
<I>nohide</I>

オプションは現在のところ
<I>single host</I>

エクスポートでしか効果がない。
このオプションの動作は、
netgroup, subnet, wildcard
などによるエクスポートでは信頼性がない。
<P>
このオプションは状況によってはとても便利であるが、よく注意して、
かつクライアントシステムがその状況下で効果的に動作することを確認した後で
使うべきである。
<P>
このオプションは
<I>hide </I>

で明示的に無効にできる。
<DT><I>no_subtree_check</I>

<DD>
このオプションのサブツリーのチェックを無効にする。
これには簡単なセキュリティの意味もあるが、
環境によっては信頼性を向上させることもできる。
<P>
ファイルシステムのサブディレクトリがエクスポートされているが、
ファイルシステム全体がエクスポートされていない場合、
NFS リクエストがくると、サーバは対応するファイルシステムに
アクセスされたファイルがあるかをチェックするだけでなく (これは簡単)、
エクスポートされたツリーのなかにあるかもチェックしなければならない
(これは難しい)。
このチェックは
<I>subtree_check </I>

とよばれる。
<P>
このチェックを行うには、サーバはクライアントに渡す
「ファイルハンドル」に、ファイルの場所に関する情報を入れなければならない。
こうすると、クライアントがファイルをオープンしている間に、
アクセスしているファイルの名前が変更されると問題が起こる
(ただし多くの簡単なケースでは動作する)。
<P>
サブツリーのチェックは、
ファイルシステムが
<I>no_root_squash</I>

(下記参照) でエクスポートされていて、
ファイル自身にはより一般的なアクセス権がある場合に、
root しかアクセスできないディレクトリ内のファイルが
root によってのみアクセスされているかを確認するのにも使える。
<P>
一般的な指針として、ホームディレクトリは
サブツリーのチェックを無効にしてエクスポートすべきである
(通常各ユーザの親ディレクトリのレベルでエクスポートされ、
かつファイル名の変更が多いため)。
大抵は読み込みのみで、ほとんどファイル名の変更が行われない
ファイルシステム (たとえば /usr や /var) で、
それらのサブディレクトリがエクスポートされるような場合には、
サブツリーのチェックを有効にしてエクスポートした方がよいかもしれない。
<P>
サブツリーのチェックを行うデフォルトの動作は、
<I>subtree_check</I>

で明示的に指定することもできる。
<P>
<DT><I>insecure_locks</I>

<DD>
<DT><I>no_auth_nlm</I>

<DD>
このオプション (2 つのオプション名は同じ意味) を指定すると、
NFS はロック要求 (NLM プロトコルを使った要求)
の際に認証を必要としなくなる。
通常 NFS サーバは、ファイルの読み取りアクセス権限を持つユーザに対し、
信用証明 (credential) を保持するために、ロック要求を必要とする。
このフラグを指定すると、アクセスチェックが行われない。
<P>
初期の NFS クライアントの実装ではロック要求の際に信用証明を送らなかったが、
現在でもこのような昔の実装を元にした多くの NFS クライアントが存在する。
全ての人が読み込み可能なファイルのみをロックしたい場合は、
このフラグを使うこと。
<P>
NLM 要求の際に認証を求めるデフォルトの動作は、
同じ意味をもつ
<I>auth_nlm</I>

または
<I>secure_locks</I>

のどちらか (意味は全く同じ) で明示的に指定できる。
<P>






















<DT><I>mountpoint=</I>path

<DD>
<DT><I>mp</I>

<DD>
このオプションを使うと、マウントに成功した場合にのみ、
そのディレクトリをエクスポートできる。
パスが指定されない場合 (たとえば
<I>mountpoint</I> または <I>mp</I>

の場合)、エクスポートポイントはマウントポイントでなければならない。
そうでなければ、エクスポートポイントはエクスポートされない。
これにより、マウントポイント以下のディレクトリが、
事故によってエクスポートされてしまわないようにすることができる。
ここでいう事故とは、例えばディスクエラーによって
ファイルシステムがマウントに失敗するような場合である。
<P>
パスが指定される場合 (たとえば
<I>mountpoint=</I>/path または <I>mp=</I>/path

の場合)、マウントされるパスは、
エクスポートされるエクスポートポイントに対応する
マウントポイントでなければならない。
<P>
<DT><I>fsid=</I>num

<DD>
このオプションは、通信で使用されるファイルハンドルとファイル属性の
ファイルシステム識別部として、
ファイルシステムがマウントされているブロックデバイスの
メジャー番号とマイナー番号から導き出された数ではなく、
<I>num</I>

を使う。
任意の 32 ビットの数値が使えるが、
エクスポートされるファイルシステム間で一意 (unique) でなければならない。
<P>
これは NFS のフェイルオーバー (failover, 代替引き継ぎ) で役立つ。
フェイルオーバーのペアとなる両方のサーバーが、
共有されるファイルシステムに対して
同じ NFS ファイルハンドルを使うことが保証されるので、
フェイルオーバー後にファイルハンドルが失効するのを避けることができる。
<P>
Linux のファイルシステムの中には、
ブロックデバイスにマウントされていないものもある。
これらのファイルシステムを NFS でエクスポートするには、
<I>fsid</I>

オプションを使う必要がある (ただし、このオプションはまだ充分ではない)。
<P>
値 0 は NFSv4 で使う場合には特別な意味を持つ。
NFSv4 にはエクスポートされるファイルシステム全体のルートという概念がある。
fsid=0 でエクスポートされたエクスポートポイントは、
このルートとして使用される。
<P>
</DL>
<A NAME="lbAH">&nbsp;</A>
<H3>ユーザ ID のマッピング</H3>

<P>

サーバマシン上のファイルに対する
<I>nfsd</I>

によるアクセスコントロールは、
それぞれの NFS RPC request の際に与えられる uid と gid に基づいている。
ユーザは通常、
サーバ上にある自分のファイルには、それが普通のファイルシステム上に
あるのと同様にアクセス可能であることを期待している。
これにはクライアントとサーバ上で用いられる uid と gid がそれぞれ
同じである必要があるが、
これは常に真であるとは限らず、望ましいとも限らない。
<P>

クライアントマシンの root が NFS サーバのファイルにアクセスするとき、
サーバの root として扱われてしまうのは、ほとんどの場合は望ましくない。
このため uid 0 は普通は別の id (anonymous や
<I>nobody</I>

uid) にマッピングされる。
この動作は  `root squashing' と呼ばれるが、これがデフォルトである。
<I>no_root_squash </I>

を使えばオフにすることができる。
<P>

デフォルトでは、







<I>exportfs</I>

は squash アクセスに -2 (つまり 65534) という uid と gid を用いる。
これらの数値は 
<I>anonuid</I> と <I>anongid</I>

オプションによって変更できる。





最後に、
<I>all_squash </I>

オプションを指定すれば、
全ての user request を anonymous uid に割り当てることもできる。








































<P>

以下にマッピングオプションの完全なリストをあげる:
<DL COMPACT>
<DT><I>root_squash</I>

<DD>
uid/gid が 0 のリクエストを annonymous uid/gid にマッピングする。
このオプションは、 root 以外の uid には適用されない。他にも
注意すべき uid は存在する (例えば
<I>bin </I>

など) ので、注意する必要がある。
<DT><I>no_root_squash</I>

<DD>
root squashing を無効にする。
このオプションは主にディスクレスクライアントにとって便利である。









<DT><I>all_squash</I>

<DD>
全ての uid とgid を anonymous にマッピングする。
これは NFS エクスポートされた公開 FTP ディレクトリや、
news のスプールディレクトリ等に便利である。
これと逆のオプションは
<I>no_all_squash </I>

であり、こちらがデフォルトになっている。

























































<DT><I>anonuid</I> および <I>anongid</I>

<DD>
これらのオプションは anonymous アカウントの uid と gid を明示的にセット
する。これは、全てのリクエストが一人のユーザからになるような
PC/NFS clients にとって主に有効である。
例えば、
以下の「例」のセクションでの
<I>/home/joe</I>

なるエクスポートエントリを見てほしい。
この例では、(joe からのものであると思われる) 全てのリクエストが uid 150 に
マッピングされる。 
<DT><DD>
</DL>
<A NAME="lbAI">&nbsp;</A>
<H2>例</H2>

<P>

<PRE>

# sample /etc/exports file
/               master(rw) trusty(rw,no_root_squash)
/projects       proj*.local.domain(rw)
/usr            *.local.domain(ro) @trusted(rw)
/home/joe       pc001(rw,all_squash,anonuid=150,anongid=100)
/pub            (ro,insecure,all_squash)
</PRE>

<P>

1 行目は、 master と trusty に対してすべてのファイルシステムの
マウント許可を出している。
書き込みの許可に加え、さらに trusty に対しては、すべての uid squashing 
も無効にしている。
2 行目と 3 行目は、ホスト名へのワイルドカードの利用と、ネットグループ
(@trusted のエントリ) の例である。
4 行目は、上で述べた PC/NFS クライアント用エントリの例である。
5 行目は、公開 FTP ディレクトリを世界中の全てのホストにエクスポートしている。
すべてのリクエストは nobody アカウントで実行される。
またこのエントリ中の
<I>insecure </I>

オプションによって、 NFS 用 port を使わないように実装された NFS
クライアントからのアクセスも許可している。


















<A NAME="lbAJ">&nbsp;</A>
<H2>ファイル</H2>

/etc/exports















<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">説明</A><DD>
<DL>
<DT><A HREF="#lbAE">マシン名のフォーマット</A><DD>
<DT><A HREF="#lbAF">RPCSEC_GSS セキュリティ</A><DD>
<DT><A HREF="#lbAG">一般的なオプション</A><DD>
<DT><A HREF="#lbAH">ユーザ ID のマッピング</A><DD>
</DL>
<DT><A HREF="#lbAI">例</A><DD>
<DT><A HREF="#lbAJ">ファイル</A><DD>
</DL>
<HR>
This document was created by
<A HREF="../../man/man1/man2html.1.html">man2html</A>,
using the manual pages.<BR>
Time: 03:33:41 GMT, December 05, 2022
</BODY>
</HTML>
