
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of MODPROBE</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../jm.css">
</HEAD>
<BODY>

<H1>MODPROBE</H1>
Section: Linux Module Support (8)<BR>Updated: February 4, 2002<BR><A HREF="#index">Index</A>
<A HREF="../../../index.html">JM Home Page</A>
<A HREF="../../../manual/modutils/release/man8/modprobe.8">roff page</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>

modprobe - ローダブルモジュールの高レベル管理
<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>


<B>modprobe</B>

[-adnqv]&nbsp;[-C&nbsp;<I>config</I>]&nbsp;module&nbsp;[symbol=value&nbsp;...]
<BR>

<B>modprobe</B>

[-adnqv] [-C&nbsp;<I>config</I>] [-t&nbsp;<I>type</I>] pattern
<BR>

<B>modprobe</B>

-l [-C&nbsp;<I>config</I>] [-t&nbsp;<I>type</I>] pattern
<BR>

<B>modprobe</B>

-c [-C&nbsp;<I>config</I>]
<BR>

<B>modprobe</B>

-r [-dnv] [-C&nbsp;<I>config</I>] [module ...]
<BR>

<B>modprobe</B>

-Vh
<A NAME="lbAD">&nbsp;</A>
<H2>このマニュアルについて</H2>

このマニュアルは、Linux Kernel 2.4 の時代に使われていた modutils
パッケージの <B>modprobe</B> の説明で、古いものです。現在ではたいていの場合、
kmod パッケージの <B>modprobe</B> が使われています。(2022/12/02,
Linux JM Project)
<A NAME="lbAE">&nbsp;</A>
<H2>オプション</H2>

<DL COMPACT>
<DT><B>-a</B>, <B>--all</B>

<DD>
最初にロードに成功した後に停止するのではなく、
マッチしたモジュールを<B>すべて</B>ロードする。
<DT><B>-c</B>, <B>--showconfig</B>

<DD>
現在用いられている設定を表示する。
<DT><B>-C</B>,&nbsp;<B>--config</B>&nbsp;<I>config</I><DD>
設定ファイルを <I>/etc/modules.conf</I> ではなく <I>config</I> にする。
(<I>/etc/modules.conf</I>

はなくてもよい)。
環境変数 <B>MODULECONF</B> でも設定ファイルを /etc/modules.conf
(あるいは推奨しないが <I>/etc/conf.modules</I>) から変更できる。
<DT>環境変数<DD>
<B>UNAME_MACHINE</B>

をセットすると、modutils は uname() システムコールの machine フィールドの
代わりにこの変数の値を用いる。
これは主に 32 ビットユーザー空間で 64 ビットモジュールをコンパイルする
(またはその逆)場合に用いる。
現在の modutils はモジュールに対する完全なクロスビルドモードに対応しておらず、
ホストアーキテクチャの 32 ビット版と 64 ビット版を選択できるだけである。
<DT><B>-d</B>, <B>--debug</B>

<DD>
モジュールのスタックの内部表現に関する情報を表示する。
<DT><B>-h</B>, <B>--help</B>

<DD>
オプションの一覧を表示して直ちに終了する。
<DT><B>-k</B>, <B>--autoclean</B>

<DD>
ロード済みのモジュールに &quot;autoclean&quot; を設定する。
カーネルが
<B>modprobe</B>

に足りない機能をモジュールとして提供するよう依頼するときに用いられる。
<B>-k</B> オプションを指定すると、自動的に <B>-q</B> オプションも有効になる。
これらのオプションは自動的に <B>insmod</B> に送られる。
<DT><B>-l</B>, <B>--list</B>

<DD>
マッチするモジュールをリストする。
<DT><B>-n</B>, <B>--show</B>

<DD>
実際には動作を行わず、何が行われるかを表示する。
<DT><B>-q</B>, <B>--quiet</B>

<DD>
<B>insmod</B> がモジュールのインストールに失敗しても報告しない。
黙って他の可能性を試しながら通常のように継続する。
このオプションは自動的に <B>insmod</B> に送られる。
<DT><B>-r</B>, <B>--remove</B>

<DD>
コマンドラインでモジュールが指定されればモジュール (のスタック) を削除する。
されなければ autoclean を実行する。
<DT><B>-s</B>, <B>--syslog</B>

<DD>
標準エラー出力にではなく syslog を経由してレポートする。
このオプションは自動的に <B>insmod</B> に送られる。
<DT><B>-t</B>&nbsp;<I>moduletype</I>;&nbsp;<B>--type</B>&nbsp;<I>moduletype</I><DD>
指定したタイプのモジュールだけを扱う。
modprobe は、ディレクトリパスに &quot;/<I>moduletype</I>/&quot;
をこの形で含むモジュールだけしか対象にしない。
<I>moduletype</I> にはディレクトリを複数の階層で指定しても良い。例えば
&quot;<B>-t</B>&nbsp;<I>drivers/net</I>&quot; とすれば、 
<I>xxx/drivers/net/</I> およびそのサブディレクトリにあるモジュールだけを
対象にする。
<DT><B>-v</B>, <B>--verbose</B>

<DD>
すべてのコマンドを、実行される通りに表示する。
<DT><B>-V, --version</B>

<DD>
<B>modprobe</B> のバージョンを表示する。
<DT><B>注意:</B>

<DD>
モジュール名にはパス ('/') や末尾の '.o' を含めてはならない。
例えば、 'slip' は
<B>modprobe</B>

に対する正当なモジュール名だが、

これはコマンドラインと設定ファイルの両方に適用されるルールである。
</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>説明</H2>

<B>modprobe</B> と <B>depmod</B>は、Linux のモジュール化されたカーネルを、
あらゆるユーザー、管理者、ディストリビューションの作成者にとって
より管理しやすいものにするために作成された。
<P>

<B>modprobe</B> は Makefile に似た形式で依存関係を記述したファイルを用いる。
これは <B>depmod</B> によって作成されるもので、
あらかじめ定められたディレクトリツリーに置かれたモジュールのセットから、
関連するファイル (群) を自動的にロードするためのものである。
<P>

<B>modprobe</B>はモジュールのセット (単一のモジュールであることも、
依存関係にあるモジュールのスタックであることもある) のロードに用いられる。
また、特定のタグがつけられたすべてのモジュールをロードするのにも用いられる。
<P>

<B>modprobe</B>はモジュールスタックに必要とされるベースモジュールを、
依存関係を記述したファイル <I>modules.dep</I> の記述にしたがって
すべてロードする。これらのモジュールのどれかをロードできないと、
現在のセッションでロードされたモジュールスタックの全体が
自動的にアンロードされることになる。
<P>

<B>modprobe</B>がモジュールをロードするやりかたは 2 種類ある。
ひとつめ (プローブモード) は、
(<I>pattern</I> で定義された) リストからモジュールをロードしようとする。
モジュールがひとつロードできると、<B>modprobe</B>はただちに停止する。
これはイーサネットドライバのリストから
モジュールをひとつロードするような場合に利用できるだろう。
<P>

もうひとつの方では、<B>modprobe</B>はリストの<B>すべての</B>モジュールを
ロードする。以下の「<B>例</B>」の記述を参照のこと。
<P>

<B>-r</B>オプションをつけると、 modprobe は自動的にモジュールのスタックを
アンロードする(&quot;<B>rmmod -r</B>&quot;と同様)。
&quot;<B>modprobe -r</B>&quot;とだけすると、
使われていない autoload されたモジュールを削除すると同時に、
設定ファイル <I>/etc/modules.conf</I> の記述にしたがって
削除の前処理・後処理用のコマンドを実行する。
<P>

<B>-l</B> オプションと<B>-t</B>オプションを同時に指定すると、
利用可能なすべてのモジュールのうち、特定のタイプのものだけが表示される。
<P>

<B>-c</B>オプションを指定すると、
現在用いられている設定が表示される (デフォルト + 設定ファイル)。
<A NAME="lbAG">&nbsp;</A>
<H2>設定</H2>

<B>modprobe</B>(と<B>depmod</B>)の動作は、設定ファイル
<I>/etc/modules.conf</I>によって変更できる (このファイルはなくてもよい)。
<P>

このファイルに記述できる内容の詳細や、<B>depmod</B>と
<B>modprobe</B>が用いるデフォルトの設定に関しては
<B><A HREF="../man5/modules.conf.5.html">modules.conf</A></B>(5)を参照のこと。
<P>

モジュールがカーネルによって &quot;autoload&quot; された場合は、
削除の前処理・後処理のコマンドは<B>実行されない</B>ことに注意。
将来サポートされる予定の「永続型モジュール保存 (persistent module storage)」
に期待して欲しい。

<P>

削除の前後処理の機能を用いたい場合は、
kerneld の autoload を使わないようにして、
以下のような行を <B>crontab</B> に書きこむ必要がある
(これは kmod システムによっても用いられる)。
以下では autoclean を 2 分おきに行っている。
<P>
<PRE>
 */2 * * * * test -f /proc/modules &amp;&amp; /sbin/modprobe -r
</PRE>

<A NAME="lbAH">&nbsp;</A>
<H2>動作ルール</H2>

<B>modprobe</B>は、現在のカーネルリリース向けにコンパイルされたモジュールを
含むディレクトリをまず最初に見る。
そこにモジュールがなければ、<B>modprobe</B>はカーネルバージョンに共通の
ディレクトリ (2.0, 2.2 など) を見る。
そこにもモジュールがなければ、
デフォルトのリリース以外のモジュールを含むディレクトリを見る。
<P>

新しい Linux をインストールしたときは、モジュールをそのカーネルのリリース
(とバージョン) に対応したディレクトリに移動すべきである。
そしてこのディレクトリから「デフォルト」のディレクトリに
シンボリックリンクをはるようにする。
<P>

新しいカーネルをコンパイルして&quot;<B>make modules_install</B>&quot;
コマンドを実行すると、新しいディレクトリは作成するが、
「デフォルト」のリンクは変更しない。
<P>

カーネルの配布に含まれないモジュールを入手したら、
それは <I>/lib/modules</I> 以下のバージョンには依存しないディレクトリに
配置するとよい。
<P>

以上がデフォルトの動作であるが、これは
<I>/etc/modules.conf</I> の記述によって変更できる。
<A NAME="lbAI">&nbsp;</A>
<H2>例</H2>

<DL COMPACT>
<DT><B>modprobe -t net</B>

<DD>
&quot;net&quot; という名前のディレクトリにあるモジュールのどれかひとつをロードする。
どれかのモジュールのロードに成功するまで、各モジュールがひとつづつ試みられる。
<DT><B>modprobe -a -t boot</B>

<DD>
&quot;boot&quot;という名前のディレクトリにあるすべてのモジュールがロードされる。
<DT><B>modprobe slip</B>

<DD>
これを実行すると、
s1hc.o というモジュールがまだロードされていなければロードしようとする。
slip モジュールには s1hc モジュールの機能が必要だからである。
この依存関係は、<B>depmod</B>によって (これ以前に) 自動的に生成された
<I>modules.dep</I> というファイルに記述されている。
<DT><B>modprobe -r slip</B>

<DD>
slip モジュールをアンロードする。
s1hc モジュールも自動的にアンロードする
(ただし ppp のような他のモジュールによって利用されていない場合)。
</DL>
<A NAME="lbAJ">&nbsp;</A>
<H2>ファイル</H2>

<PRE>
<I>/etc/modules.conf</I>(<I>/etc/conf.modules</I>も使えるが推奨しない)
<I>/lib/modules/*/modules.dep</I>,
<I>/lib/modules/*</I>
</PRE>

<A NAME="lbAK">&nbsp;</A>
<H2>関連項目</H2>

<B><A HREF="../man8/depmod.8.html">depmod</A></B>(8), <B><A HREF="../man8/lsmod.8.html">lsmod</A></B>(8), <B><A HREF="../man8/kerneld.8.html">kerneld</A></B>(8), <B><A HREF="../man8/ksyms.8.html">ksyms</A></B>(8), <B><A HREF="../man8/rmmod.8.html">rmmod</A></B>(8)

<A NAME="lbAL">&nbsp;</A>
<H2>セーフモード</H2>

実効 UID が 実 UID と異なる場合、 <B>modprobe</B> は入力を非常に慎重に扱う。
最後のパラメータは(たとえ'-'で始まっていても)モジュール名として扱われる。
一つのモジュール名だけが指定でき、&quot;変数=値&quot;の形のオプション指定は禁止される。
モジュール名は常に文字列として扱われ、セーフモードではメタ展開は行われない。
しかし、設定ファイルから読み込んだデータはメタ展開を行う。
<P>

modprobe がカーネルから起動された場合、実効 UID は実 UID と異なるかもしれない。
これはカーネルが 2.4.0-test11 以上の時に真となる。
理想的な世界では <B>modprobe</B> は
カーネルが正しいパラメータだけを modprobe に渡すと信用することが出来た。
しかし高レベルカーネルコードは未検証のパラメータを直接ユーザーから modprobe に渡すので、
少なくとも一つのローカル root exploit が発生する。
それで、もはや modprobe はカーネルからの入力を信用しない。
<P>


<B>modprobe</B> は環境変数が以下の文字列しか含まない場合、
自動的にセーフモードとなる。
<PRE>
 HOME=/
 TERM=linux
 PATH=/sbin:/usr/sbin:/bin:/usr/bin
</PRE>

これは昔のカーネルのように実 UID と実効 UID が同じであっても、
カーネル 2.2 から 2.4.0-test11 までの カーネルから modprobe が起動されたことを検出する。
<A NAME="lbAM">&nbsp;</A>
<H2>ログ記録コマンド</H2>

<I>/var/log/ksymoops</I> ディレクトリが存在し、<B>modprobe</B> がモジュールを
読み込み・削除できるようなオプションを付けて起動されていた場合、
modprobe は実行したコマンドと返り値を
<I>/var/log/ksymoops/`date&nbsp;+%Y%m%d.log`</I> のファイル名で記録する。
この自動ログ記録を停止するオプションはない。
もしこのような記録をさせたくなければ、
<I>/var/log/ksymoops</I> ディレクトリを作らなければよい。
もしディレクトリを作るなら、root が所有してモードは 644 か 600 にし、
毎日ぐらいのペースで <B>insmod_ksymoops_clean</B> を実行するべきである。
<A NAME="lbAN">&nbsp;</A>
<H2>必要なユーティリティ</H2>

<B><A HREF="../man8/depmod.8.html">depmod</A></B>(8), <B><A HREF="../man8/insmod.8.html">insmod</A></B>(8)

<A NAME="lbAO">&nbsp;</A>
<H2>注意</H2>

<B>modprobe</B> に与えるパターンが (シェルによって解釈されずに)
意図通りに解釈されるようにするには、
パターンにエスケープが必要となることが多いだろう。
<A NAME="lbAP">&nbsp;</A>
<H2>バグ</H2>

<B>modprobe</B>&nbsp;[ <B>-V</B>&nbsp;|&nbsp;<B>--version</B> ] は直ちに終了するべきである。
しかしながら、現在はバージョン情報を表示した後、
何もオプションが指定されなかったかのように振舞う。
<A NAME="lbAQ">&nbsp;</A>
<H2>著者</H2>

Jacques Gelinas (<A HREF="mailto:jack@solucorp.qc.ca">jack@solucorp.qc.ca</A>)
<BR>

Bjorn Ekwall (<A HREF="mailto:bj0rn@blox.se">bj0rn@blox.se</A>)
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">このマニュアルについて</A><DD>
<DT><A HREF="#lbAE">オプション</A><DD>
<DT><A HREF="#lbAF">説明</A><DD>
<DT><A HREF="#lbAG">設定</A><DD>
<DT><A HREF="#lbAH">動作ルール</A><DD>
<DT><A HREF="#lbAI">例</A><DD>
<DT><A HREF="#lbAJ">ファイル</A><DD>
<DT><A HREF="#lbAK">関連項目</A><DD>
<DT><A HREF="#lbAL">セーフモード</A><DD>
<DT><A HREF="#lbAM">ログ記録コマンド</A><DD>
<DT><A HREF="#lbAN">必要なユーティリティ</A><DD>
<DT><A HREF="#lbAO">注意</A><DD>
<DT><A HREF="#lbAP">バグ</A><DD>
<DT><A HREF="#lbAQ">著者</A><DD>
</DL>
<HR>
This document was created by
<A HREF="../../man/man1/man2html.1.html">man2html</A>,
using the manual pages.<BR>
Time: 03:33:39 GMT, December 05, 2022
</BODY>
</HTML>
