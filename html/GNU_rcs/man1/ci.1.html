
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of CI</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../contrib.css">
</HEAD>
<BODY>
<DIV ALIGN="right">
本ページは <A HREF="http://www.jp.freebsd.org/man-jp/index.html">FreeBSD jpman project</A>
(man-jp@jp.FreeBSD.org) より寄贈いただきました。
</DIV>


<H1>CI</H1>
Section: User Commands  (1)<BR>Updated: 1999/08/27<BR><A HREF="#index">Index</A>
<A HREF="../../../index.html">JM Home Page</A>
<A HREF="../../../manual/GNU_rcs/contrib/man1/ci.1">roff page</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>名称</H2>

ci - RCS ファイルにリビジョンをチェックインする
<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B>ci</B>

[<I>options</I>]<I> file </I>...

<A NAME="lbAD">&nbsp;</A>
<H2>解説</H2>

<B>ci</B>

は <FONT SIZE="-1">RCS</FONT> ファイルに新たなリビジョンを格納します。
引数のうち、<FONT SIZE="-1">RCS</FONT> ファイルの拡張子形式に一致する
ファイル名を <FONT SIZE="-1">RCS</FONT> ファイルとみなします。
それ以外のファイル名は、新たなリビジョンを含んだワークファイルとみなします。
<B>ci</B>

はワークファイルの内容を対応した <FONT SIZE="-1">RCS</FONT> ファイルに格納します。
もしワークファイルのみが指定されたなら、
<B>ci</B>

はサブディレクトリ <FONT SIZE="-1">RCS</FONT>、次にワークファイルがあるディレクトリの順に
対応する <FONT SIZE="-1">RCS</FONT> ファイルを検索します。
詳細は後述の
<FONT SIZE="-1">ファイル名規則</FONT>
の項を参照してください。
<P>

<B>ci</B>

が動作するには、
<B>ci</B>

を起動したユーザが
<FONT SIZE="-1">RCS</FONT> ファイルのアクセスリスト
に登録されているか、アクセスリストが空であるか、
ユーザが <FONT SIZE="-1">RCS</FONT> ファイルの持ち主であるか、
あるいはスーパユーザである必要があります。
すでに存在する枝 (branch) に新しいリビジョンを追加するには、
枝の先端 (tip) リビジョンが、
追加しようとするユーザによってロックされていなければなりません。
ロックされていない場合、新たな枝のみ作成可能です。
非厳格モード (
<B><A HREF="../man1/rcs.1.html">rcs</A></B>(1)

参照) の場合、
ファイルの所有者に対してはこの制限はありません。
他人が行っているロックは、
<B>rcs</B>

コマンドによって解除できます。
<P>

<B>-f</B>

オプションが指定されていなければ、
<B>ci</B>

は追加しようとするリビジョンと直前のリビジョンとの比較を行います。
違いがなかった場合、新たなリビジョンを作成するかわりに、
ワークファイルを元のリビジョンのものに復元します。
復元するときには、ci はいったんワークファイルを削除し、
ロックを解除します。
<B>ci&nbsp;-l</B>

はロックし、
<B>ci&nbsp;-u</B>

はロックを解除します。
これらのオプションが指定されていれば、あたかも直前のリビジョンに対して
<B>co&nbsp;-l</B>

または
<B>co&nbsp;-u</B>

を実行したかのようにして直前のリビジョンの内容を取り出します。
復元が行われる場合、
<B>-n</B>

と
<B>-s</B>

オプションは復元されるリビジョンに対して作用します。
<P>

リビジョンを格納するときに、
<B>ci</B>

はログメッセージの入力を促すプロンプトを表示します。
ログメッセージは、そのリビジョンの変更点の要約です。
ファイル終端 (EOF) あるいは、
ピリオド
<B>.</B>

のみからなる行によって入力を完了させます。
複数のファイルが登録される場合、
<B>ci</B>

は前に入力したログメッセージを
再利用するかどうかを聞いてきます。
もし標準入力が端末でなければ、
<B>ci</B>

は確認を行わず、
登録されるすべてのファイルに対して同じログメッセージを使用します。
<B>-m</B>

オプションの項も参照してください。
<P>

もし <FONT SIZE="-1">RCS</FONT> ファイルが存在しなければ、
<B>ci</B>

は新規に <FONT SIZE="-1">RCS</FONT> ファイルを作成し、
ワークファイルの内容を初期リビジョン (デフォルトでは
<B>1.1</B>)

として格納します。
その場合、アクセスリストは空に初期化されます。
初期リビジョンを格納するときは、
ログメッセージのかわりに
ファイルの内容を記述したテキストを入力します (後述の
<B>-t</B>

オプションの項を参照してください)。
<P>

登録するリビジョン番号 (
<I>rev )</I>

は、
<B>-f</B>,

<B>-i</B>,

<B>-I</B>,

<B>-j</B>,

<B>-k</B>,

<B>-l</B>,

<B>-M</B>,

<B>-q</B>,

<B>-r</B>,

<B>-u</B>

のオプションのうちのいずれかで指定することができます。
<I>rev</I>

はシンボル、数値、あるいは両者の組み合わせたものです。
<I>rev</I>

で使用するシンボル名は定義済みでなければなりません;
チェックイン時にシンボル名を割り当てる方法については
<B>-n</B>

および
<B>-N</B>

を参照して下さい。
もし
<I>rev</I>

が
<B>$</B>

ならば、
<B>ci</B>

はワークファイル中のキーワードからリビジョン番号を決定します。
<P>

もし
<I>rev</I>

がピリオドから始まる場合、デフォルトの枝 (通常は幹 (trunk)) に格納されます。
もし
<I>rev</I>

が枝番号に続いてピリオドである場合、当該枝の最新のリビジョンが使用されます。
<P>

<I>rev</I>

がリビジョン番号の場合、
それは登録する枝のなかで最も大きな値である必要があります。
さもなければ、新しい枝を作成する必要があります。
<P>

<I>rev</I>

がリビジョン番号ではなく枝番号の場合、
その枝に対する新しいリビジョンが作成されます。
新しいリビジョン番号は、その枝の先端リビジョン番号に 1 を加えたものとなります。
もし
<I>rev</I>

が存在しない枝番号ならば、新たな枝が作成され、初期リビジョンとして
<I>rev</I><B>.1</B>

が作成されます。
<BR>


<P>

<I>rev</I>

が省略された場合、
<B>ci</B>

はユーザが行った最後のロックからリビジョン番号を決定します。
ユーザがある枝の先端リビジョンをロックしている場合は、
新たなリビジョンがその枝に追加されます。
新しいリビジョン番号は
先端リビジョン番号に 1 を加えたものになります。
ユーザが先端ではないリビジョンをロックしている場合は、
新たな枝が作成されます。
新たな枝番号は、ロック対象のリビジョンの
最も大きな枝番号に 1 を加えたものになります。
デフォルトでは、新たな枝やリビジョンの番号は
<B>1</B>

となります。
<P>

<I>rev</I>

が省略され、ユーザがロックを行わず、そのファイルの所有者であり、
かつロックが
<I>非厳格モード</I>

であるなら、
デフォルトの枝 (通常は幹 (trunk);
<B><A HREF="../man1/rcs.1.html">rcs</A></B>(1)

の
<B>-b</B>

オプションの項を参照) に新たなリビジョンが作成されます。
<P>

例外: 幹 (trunk) においてリビジョンを追加することはできますが、
途中に挿入することはできません。
<A NAME="lbAE">&nbsp;</A>
<H2>オプション</H2>

<DL COMPACT>
<DT><B>-r</B><I>rev</I>

<DD>
リビジョン
<I>rev</I>

をチェックインします。
<DT><B>-r</B>

<DD>
<B>-r</B>

オプションをリビジョン抜きで使用した場合、
<B>ci</B>

にとって特別な意味が有ります。他の <FONT SIZE="-1">RCS</FONT> コマンドでは
<B>-r</B>

オプションを単体で使用するとデフォルト枝の最新のリビジョンを指定します。
しかし、
<B>ci</B>

ではロック解除、ワークファイル削除を行い、
シェルのエイリアスやスクリプトによりデフォルトとされてしまった
<B>-l</B>

や
<B>-u</B>

オプションの効果を打ち消します。
<DT><B>-l</B>[<I>rev</I>]

<DD>
<B>-r</B>

と同様の動作を行ったあと、
<B>co&nbsp;-l</B>

と同様の動作も行います。
すなわち、登録されたリビジョンは即座にロックされ、チェックアウトされます。
これは、リビジョンをチェックインしてさらに編集を続けたい場合に便利です。
<DT><B>-u</B>[<I>rev</I>]

<DD>
<B>-l</B>

とほぼ同様の動作をしますが、登録されたリビジョンはロックされません。
これは、チェックインしたリビジョンの内容をすぐに参照したい場合に便利です。
<DL COMPACT><DT><DD>
<P>

<B>-l</B>

、リビジョン無し
<B>-r</B>,

<B>-u</B>

オプションは、最後に指定したもののみが効力を持ちます。
たとえば、
<B>ci&nbsp;-u&nbsp;-r</B>

は
<B>ci&nbsp;-r</B>

と等価です。
リビジョン無し
<B>-r</B>

が
<B>-u</B>

に優先するからです。
</DL>

<DT><B>-f</B>[<I>rev</I>]

<DD>
強制的に登録します。
直前のリビジョンとの違いがない場合にも、
新しいリビジョンとして登録します。
<DT><B>-k</B>[<I>rev</I>]

<DD>
リビジョン番号などをローカルに算出せずに、
ワークファイルからキーワードを探し、
リビジョン番号、作成日時、状態、作者 (
<B><A HREF="../man1/co.1.html">co</A></B>(1)

を参照) を検索し、登録されるリビジョンに割り当てます。
さらに、
<B>ci</B>

を起動したユーザ名と実際にチェックインされた日付を含む
デフォルトのログメッセージを作成します。
本オプションは、配布されたソフトウェアを登録するのに便利です。
複数のサイトに配布されたリビジョンは、
元のリビジョン番号、作成日付、状態、作者を保存するために、
<B>-k</B>

オプションを使って登録するべきです。
ワークファイルのキーワードから取り出した値とログメッセージは、
<B>-d</B>,

<B>-m</B>,

<B>-s</B>,

<B>-w</B>

や、他のリビジョン番号を生成するようなオプションにより
変更することができます。
<DT><B>-q</B>[<I>rev</I>]

<DD>
沈黙モードです。
診断メッセージを表示しません。
直前のリビジョンから変更がない場合、
<B>-f</B>

オプションを指定していなければ、登録を行いません。
<DT><B>-i</B>[<I>rev</I>]

<DD>
最初のチェックイン; <FONT SIZE="-1">RCS</FONT> ファイルが既に有る時にはエラー報告します。
特定のアプリケーションのレース状態を避けます。
<DT><B>-j</B>[<I>rev</I>]

<DD>
初期化を行わず、チェックインします;
<FONT SIZE="-1">RCS</FONT> ファイルが無いとエラー報告します。
<DT><B>-I</B>[<I>rev</I>]

<DD>
対話モードで動作します。
たとえ標準入力が端末でなくても、ユーザに対して問い合わせを行います。
<DT><B>-d</B>[<I>date</I>]

<DD>
チェックイン日付として指定された
<I>date</I>

を用います。
<I>date</I>

は
<B><A HREF="../man1/co.1.html">co</A></B>(1)

で記述された自由形式で指定することができます。
これは、チェックイン日時をごまかしたい場合や、
日付キーワードがワークファイルにないにもかかわらず
<B>-k</B>

オプションを使いたい場合に便利です。
<I>date</I>

が指定されなかった場合、ワークファイルの最終更新日付が用いられます。
<DT><B>-M</B>[<I>rev</I>]

<DD>
作成されるワークファイルの最終更新日付を、
取り出されたリビジョンの日付にします。
たとえば、
<B>ci&nbsp;-d&nbsp;-M&nbsp;-u</B><I>&nbsp;f</I>

は、
<I>f</I>

の内容がキーワード置換により変更された場合も最終更新日時を変更しません。
本オプションを指定すると
<B><A HREF="../../GNU_make/man1/make.1.html">make</A></B>(1)

に影響を与えるので、注意して使用する必要があります。
<DT><B>-m</B><I>msg</I>

<DD>
チェックインするすべてのリビジョンのログメッセージとして
<I>msg</I>

を用います。
慣習的に
<B>#</B>

で始まるログメッセージはコメントであり、GNU Emacs の
<B>vc</B>

パッケージのようなプログラムはこれを無視します。
また、
<B>{</B><I>clumpname</I><B>}</B>

(の後に空白が続く) ログメッセージは可能であればまとめられることを意味します。
それはたとえ別々のファイルに関連づけられていてもです;
<B>{</B><I>clumpname</I><B>}</B>

ラベルは、まとめる目的でのみ使用されます。
それ自身はログメッセージであるとは見なされません。
<DT><B>-n</B><I>name</I>

<DD>
チェックインしたリビジョンにシンボリック名
<I>name</I>

をつけます。
もし同じシンボリック名が別のリビジョンに割り当てられていた場合、
<B>ci</B>

はエラーメッセージを出力します。
<DT><B>-N</B><I>name</I>

<DD>
<B>-n</B>

と同様の動作を行います。
ただし、同じシンボリック名が他のリビジョンに割り当てられていた場合は、
再割り当てを行います (こちらを優先します)。
<DT><B>-s</B><I>state</I>

<DD>
チェックインされるリビジョンの状態を
<I>state</I>

とします。デフォルトは
<B>Exp</B>

(Experimental: 実験的) です。
<DT><B>-t</B><I>file</I>

<DD>
<FONT SIZE="-1">RCS</FONT> ファイル中の内容記述テキストをファイル
<I>file</I>

の内容で置き換えます。
すでに内容記述テキストがある場合はこれを削除します。ファイル名
<I>file</I>

は
<B>-</B>

で始まってはいけません。
<DT><B>-t-</B><I>string</I>

<DD>
<FONT SIZE="-1">RCS</FONT> ファイル中の内容記述テキストを文字列
<I>string</I>

で置き換えます。
すでに内容記述テキストがある場合は削除されます。
<DL COMPACT><DT><DD>
<P>

<B>-t</B>

オプションは、どちらの形式で使う場合も、
最初のチェックイン時にしか意味を持ちません。
それ以外の場合は単に無視されます。
<P>

最初のチェックイン時に
<B>-t</B>

オプションが指定されなかった場合、
<B>ci</B>

は標準
入力から内容記述テキストを読み込みます。
テキストは、ファイル終端 (EOF) あるいはピリオド (
<B>.</B>

) のみの行で終了します。
ユーザへの問い合わせが可能な場合には、
テキストの入力を促すプロンプトが表示されます (
<B>-I</B>

オプション参照)。
<P>

旧バージョンとの互換性のため、引数のない
<B>-t</B>

オプションは無視されます。
</DL>

<DT><B>-T</B>

<DD>
新しいリビジョンが存在し、
<FONT SIZE="-1">RCS</FONT> ファイルの修正時刻が新しいリビジョンの時刻よりも古ければ、
<FONT SIZE="-1">RCS</FONT> ファイルの修正時刻に対して新しいリビジョンの時刻を代入します;
そうでない場合は <FONT SIZE="-1">RCS</FONT> ファイルの修正時刻は保たれます。
リビジョンをロックした場合は、
<B>ci</B>

は通常 <FONT SIZE="-1">RCS</FONT> ファイルの修正時刻を現在の時刻に設定します。
なぜならロックが <FONT SIZE="-1">RCS</FONT> ファイルに格納され、
ロックの削除は <FONT SIZE="-1">RCS</FONT> ファイルの変更を要するからです。
<FONT SIZE="-1">RCS</FONT> ファイルがワークファイルよりも新しくなる方法として 2 通り有ります:
まず、
<B>ci&nbsp;-M</B>

は現在時刻以前の日付でワークファイルを作成します;
2 番目に、直前のバージョンを回復する時、
ワークファイルを変更しない場合にも <FONT SIZE="-1">RCS</FONT> ファイルは変更され得ます。
<FONT SIZE="-1">RCS</FONT> ファイルのワークファイルにおける
<B><A HREF="../../GNU_make/man1/make.1.html">make</A></B>(1)

依存により、上記 2 ケースは過剰の再コンパイルという結果になり得ます。
<B>-T</B>

オプションを使用することで、<FONT SIZE="-1">RCS</FONT> ファイルの日付をごまかし、
再コンパイルを禁止します。
このオプションは注意して使って下さい;
あるワークファイルのチェックインが、
同じ <FONT SIZE="-1">RCS</FONT> ファイルに関連づけられている別のワークファイルに影響を及ぼすべき
時でも、再コンパイルを抑制し得ます。
例えば、<FONT SIZE="-1">RCS</FONT> ファイルの時刻を 01:00、
(変更された) ワークファイルの時刻を 02:00、
別のワークファイルのコピーの時刻を 03:00、
現在の時刻を 04:00 とします。
ここで、
<B>ci&nbsp;-d&nbsp;-T</B>

とすると、<FONT SIZE="-1">RCS</FONT> ファイルの時刻は通常の 04:00 ではなく 02:00 になります;
この結果、
<B><A HREF="../../GNU_make/man1/make.1.html">make</A></B>(1)

は別のコピーが <FONT SIZE="-1">RCS</FONT> ファイルよりも新しいと (誤って) 認識します。
<DT><B>-w</B><I>login</I>

<DD>
指定された
<I>login</I>

をリビジョンの作者として登録します。
作者名をごまかしたい場合や、
作者キーワードがワークファイルにないにもかかわらず
<B>-k</B>

オプションを使いたい場合に便利です。
<B>-V</B>

<FONT SIZE="-1">RCS</FONT> のリビジョン番号を表示します。
<DT><B>-V</B><I>n</I>

<DD>
<FONT SIZE="-1">RCS</FONT> システムのバージョン
<I>n</I>

のエミュレーションを行います。詳細は
<B><A HREF="../man1/co.1.html">co</A></B>(1)

を参照してください。
<DT><B>-x</B><I>suffixes</I>

<DD>
<FONT SIZE="-1">RCS</FONT> ファイルの拡張子を指定します。
拡張子が空ではない場合、
拡張子まで含めたすべてのパス名を <FONT SIZE="-1">RCS</FONT> ファイル名であるとみなします。
拡張子が空の場合は、
<B>RCS/</B><I>path</I>

または
<I>path1</I><B>/RCS/</B><I>path2</I>

形式のものを <FONT SIZE="-1">RCS</FONT> ファイル名であるとみなします。
本オプションの場合、
<B>/</B>

で区切ることにより、複数の拡張子を指定できます。たとえば、
<B>-x,v/</B>

は、
<B>,v</B>

と空の拡張子の 2 つの拡張子を持つ <FONT SIZE="-1">RCS</FONT> ファイルを指定します。
複数の拡張子が指定された場合、指定された順に <FONT SIZE="-1">RCS</FONT> ファイルを検索します。
最初に見つかったサフィックスが <FONT SIZE="-1">RCS</FONT> ファイルに対して用いられます。
<FONT SIZE="-1">RCS</FONT> ファイルを生成できるが、 <FONT SIZE="-1">RCS</FONT> ファイルが見つからないときは、
これらのサフィックスを新しいファイル名に対して用います。
デフォルトの拡張子は、インストールされる環境により異なります。
UNIX のようなコンマをファイル名中に含めることの出来る計算機では、通常
<B>-x,v/</B>

が、それ以外の計算機では空の拡張子が用いられます。
<DT><B>-z</B><I>zone</I>

<DD>
キーワード置換での日付の出力書式の指定を行い、また、
<B>-d</B><I>date</I>

オプションでの
<I>date</I>

のデフォルトのタイムゾーンの指定を行います。
<I>zone</I>

は、省略する事も、UTC からの数値差で指定する事も、特別な文字列
<B>LT</B>

を使ってローカル時間で指定する事もできます。
デフォルトでは
<I>zone</I>

は空であり、
この場合は伝統的な <FONT SIZE="-1">RCS</FONT> フォーマット、
すなわちタイムゾーン無しの <FONT SIZE="-1">UTC</FONT> であり日付をスラッシュで区切ります;
そうでない場合は時刻はタイムゾーン付の <FONT SIZE="-1">ISO</FONT> 8601 フォーマットです。
例えば、ローカルタイムが 1990 年 1 月 11 日 太平洋標準時間
(<FONT SIZE="-1">UTC</FONT> の 8 時間西) 午後 8 時の場合、時間の出力は次のようになります:
<DL COMPACT><DT><DD>
<P>

<DL COMPACT><DT><DD>
<PRE>

<I>オプション</I><I>時刻の出力</I>
<B>-z</B>          <B>1990/01/12 04:00:00</B>          <I>(デフォルト)</I>
<B>-zLT</B>        <B>1990-01-11 20:00:00-08</B>
<B>-z+05:30</B>    <B>1990-01-12 09:30:00+05:30</B>

</PRE>

</DL>

<P>

<B>-z</B>

オプションは <FONT SIZE="-1">RCS</FONT> ファイルに格納されている日付 (常に <FONT SIZE="-1">UTC</FONT> です)
には影響しません。
</DL>
</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>ファイル名規則</H2>

<FONT SIZE="-1">RCS</FONT> ファイルとワークファイルの組み合わせは 3 通りの方法で指定することができます
(使用例の項目も参照してください)。
<P>

1) <FONT SIZE="-1">RCS</FONT> ファイルとワークファイルの両方を指定する。
<FONT SIZE="-1">RCS</FONT> ファイルのパス名は
<I>path1</I><B>/</B><I>workfileX</I>

形式、ワークファイルのパス名は
<I>path2</I><B>/</B><I>workfile</I>

形式をとります。この場合の
<I>path1</I><B>/</B>

と
<I>path2</I><B>/</B>

はパス (異なるパスや、空でも可) を示し、
<I>workfile</I>

はファイル名、
<I>X</I>

は <FONT SIZE="-1">RCS</FONT> ファイルの拡張子です。もし
<I>X</I>

が空なら、
<I>path1</I><B>/</B>

は
<B>RCS/</B>

で始まるか、
<B>/RCS/</B>

を含まねばなりません。
<P>

2) <FONT SIZE="-1">RCS</FONT> ファイルのみを指定する。
ワークファイルがカレントディレクトリに作成され、<FONT SIZE="-1">RCS</FONT> ファイル名から
<I>path1</I><B>/</B>

と拡張子
<I>X</I>

を取り除いたファイル名になります。
<P>

3) ワークファイルのみを指定する。
<B>ci</B>

はまず、各 <FONT SIZE="-1">RCS</FONT> 拡張子
<I>X</I>

に対して、
<I>path2</I><B>/RCS/</B><I>workfileX</I>

形式の名前で検索を行います。
さらに、(もしこれが見つからず、
<I>X</I>

が空でなければ、)
<I>path2</I><B>/</B><I>workfileX</I>

を検索します。
<P>

1) または 2) の方法で <FONT SIZE="-1">RCS</FONT> ファイルが指定されていない場合、
<I>ci</I>

はまずディレクトリ
<B>./RCS</B>

を検索し、次にカレントディレクトリを検索します。
<P>

異常により <FONT SIZE="-1">RCS</FONT> ファイルのオープンに失敗すると、
<I>ci</I>

はエラー報告します。
他に <FONT SIZE="-1">RCS</FONT> ファイルのパス名の候補があってもです。
たとえばディレクトリ
<I>d</I>

で <FONT SIZE="-1">RCS</FONT> コマンドを利用できないようにするには、
<I>d</I><B>/RCS</B>

なる名前の通常ファイルを作成しておきます。
すると、<FONT SIZE="-1">RCS</FONT> コマンドは
<I>d</I><B>/RCS</B>

をディレクトリとしてオープンしようとしますが、
ディレクトリではないのでオープンすることができず失敗します。
<A NAME="lbAG">&nbsp;</A>
<H2>使用例</H2>

<FONT SIZE="-1">RCS</FONT> 拡張子が
<B>,v</B>

、カレントディレクトリには <FONT SIZE="-1">RCS</FONT> ファイルを含む
<B>RCS</B>

というサブディレクトリがあり、
<B>io.c,v</B>

があると仮定します。
ここで、以下に示したコマンドを実行すると、
どれもカレントディレクトリにある
<B>io.c</B>

を
<B>RCS/io.c,v</B>

にチェックインし、
<B>io.c</B>

を削除します。
<P>

<DL COMPACT><DT><DD>
<PRE>
<B>ci  io.c;    ci  RCS/io.c,v;   ci  io.c,v;
ci  io.c  RCS/io.c,v;    ci  io.c  io.c,v;
ci  RCS/io.c,v  io.c;    ci  io.c,v  io.c;
</B></PRE>

</DL>

<P>

<FONT SIZE="-1">RCS</FONT> 拡張子が空、カレントディレクトリには <FONT SIZE="-1">RCS</FONT> ファイルを含む
<B>RCS</B>

というサブディレクトリがあり、
<B>io.c</B>

があると仮定します。ここで以下に示すコマンドは、どれも新しい
リビジョンのチェックインを行います。
<P>

<DL COMPACT><DT><DD>
<PRE>
<B>ci  io.c;    ci  RCS/io.c;
ci  io.c  RCS/io.c;
ci  RCS/io.c  io.c;
</B></PRE>

</DL>

<A NAME="lbAH">&nbsp;</A>
<H2>ファイルモード</H2>

<B>ci</B>

が作成した <FONT SIZE="-1">RCS</FONT> ファイルは、
ワークファイルの読み込みと実行の許可属性を受け継ぎます。
すでに <FONT SIZE="-1">RCS</FONT> ファイルが存在すれば、
<B>ci</B>

はその読み込みと実行の許可属性を保持します。
<B>ci</B>

は、つねに <FONT SIZE="-1">RCS</FONT> ファイルの書き込み許可属性を不許可にします。
<A NAME="lbAI">&nbsp;</A>
<H2>関連ファイル</H2>

いくつかの一時ファイルが、ワークファイルの存在するディレクトリまたは
一時ディレクトリ (環境変数の項の
<B></B><FONT SIZE="-1"><B>TMPDIR</B></FONT><B></B>

参照) に作成されます。
セマフォファイル等のファイルが
<FONT SIZE="-1">RCS</FONT> ファイルが存在するディレクトリに作成されます。
空ではない拡張子を用いている場合、
セマフォファイル名の先頭文字には、
拡張子の先頭文字と同じ文字が用いられます;
よって、拡張子として、ワークファイルの拡張子の先頭文字と同じ文字を
指定しないように注意してください。
空の拡張子を指定している場合、
セマフォファイル名の最後の文字がアンダスコア (
<B>_</B>

) となります。
<P>

<B>ci</B>

は、 <FONT SIZE="-1">RCS</FONT> ファイルやワークファイルを変更しません。通常
<B>ci</B>

はそれらのファイルをアンリンクし、新しいファイルを作成します;
ただし、<FONT SIZE="-1">RCS</FONT> ファイルへのシンボリックリンクの鎖を壊す代わりに、
目的のファイルをアンリンクします。
よって、
<B>ci</B>

は変更されるワークファイルへの
ハードリンク、シンボリックリンクを全て壊します;
さらに、<FONT SIZE="-1">RCS</FONT> ファイルへのハードリンクは無効となり、
シンボリックリンクは保存されます。
<P>

実効ユーザは、<FONT SIZE="-1">RCS</FONT> ファイルを含むディレクトリの
検索および書き込み権を持っていなければなりません。
通常実ユーザは、 <FONT SIZE="-1">RCS</FONT> ファイルとワークファイルの読み込み許可と、
それらを含むディレクトリの検索および書き込み権を持っていなければなりません。
しかし、古い計算機のなかには実ユーザと実効ユーザの間を
容易に行き来することができないものもあります。
これらの計算機では、実効ユーザのみが利用されます。
<B>ci</B>

や
<B>co</B>

のコピーに setuid が設定されていなければ、
実ユーザと実効ユーザは同一です。
次節で説明するように、
もし実効ユーザが全 <FONT SIZE="-1">RCS</FONT> ファイルとそれを含むディレクトリを所有し、
実効ユーザのみが <FONT SIZE="-1">RCS</FONT> ディレクトリに書き込めるように設定できるなら、
<FONT SIZE="-1">RCS</FONT> ファイルのセキュリティを強化することが可能です。
<P>

ユーザは <FONT SIZE="-1">RCS</FONT> ファイルを含むディレクトリの許可属性を変更することで、
<FONT SIZE="-1">RCS</FONT> ファイルに対するアクセスを制限できます;
そのディレクトリに書き込み権のあるユーザだけが、
<FONT SIZE="-1">RCS</FONT> ファイルを変更する <FONT SIZE="-1">RCS</FONT> コマンドを使用することができます。
たとえば、ユーザが複数のグループに属することが出来る計算機では、
<FONT SIZE="-1">RCS</FONT> ディレクトリをあるグループのみが書き込み権を持つように設定します。
これは、略式のプロジェクトでは十分ですが、
グループに所属するユーザが自由に <FONT SIZE="-1">RCS</FONT> ファイルを変更することができ、
<FONT SIZE="-1">RCS</FONT> ファイルすべてを削除することもできます。
そのため、正式なプロジェクトでは、
<FONT SIZE="-1">RCS</FONT> ファイルを自由に操作きる <FONT SIZE="-1">RCS</FONT> 管理者と、
新たなリビジョンをチェックインすること以外の操作はできない他のユーザとを、
区別することがあります。
<A NAME="lbAJ">&nbsp;</A>
<H2>SETUID の使用</H2>

<FONT SIZE="-1">RCS</FONT> 管理者以外のユーザがリビジョンを削除できないようにするには、
以下のように setuid 特権を使用することができます。



<DL COMPACT>
<DT>&bull;<DD>
その計算機で <FONT SIZE="-1">RCS</FONT> にて setuid が使用できるか確認します。
疑問があるときは、信頼できる専門家に意見を聞いてください。
最も良いのは、
<B>seteuid()</B>

システムコールが Posix 1003.1a Draft 5 に
記述されているように動作することです。
なぜなら、実ユーザが
<B>root</B>

であっても、<FONT SIZE="-1">RCS</FONT>は実ユーザと実効ユーザを簡単に切り替えることができるからです。<BR>
その次に良いのは、
<B>setuid()</B>

システムコールが saved setuid
(Posix 1003.1-1990の {<FONT SIZE="-1">_POSIX_SAVED_IDS</FONT>} の動作) を
サポートしている場合です;
この場合、実ユーザもしくは実効ユーザが
<B>root</B>

である時のみ失敗します。
<FONT SIZE="-1">RCS</FONT> は setuid に失敗すると、ただちに終了します。
<DT>&bull;<DD>
ユーザグループの <FONT SIZE="-1">RCS</FONT> 管理者として、ユーザ
<I>A</I>

を選びます。
<I>A</I>

だけが、<FONT SIZE="-1">RCS</FONT> ファイルに対して
<B>rcs</B>

コマンドを実行することができます。
<I>A</I>

は
<B>root</B>

や、特権を持ったユーザであってはいけません。
相互に異なるユーザグループには、異なる管理者を使用するべきです。
<DT>&bull;<DD>
ユーザが実行するファイルのディレクトリに、パス名
<I>B</I>

を選びます。
<DT>&bull;<DD>
以下のように、通常のインストールディレクトリ
<I>D</I>

から、
<B>ci</B>

と
<B>co</B>

を
<I>B</I>

にコピーし、
<I>A</I>

へ setuid します:
</DL>
<P>

<DL COMPACT><DT><DD>
<PRE>
<B>mkdir</B>  <I>B</I>
<B>cp</B>  <I>D</I><B>/c[io]</B>  <I>B</I>
<B>chmod  go-w,u+s</B>  <I>B</I><B>/c[io]</B>
</PRE>

</DL>

<DL COMPACT>
<DT>&bull;<DD>
以下のように、各ユーザのパスに
<I>B</I>

を加えます:
</DL>
<P>

<DL COMPACT><DT><DD>
<PRE>
<B>PATH=</B><I>B</I><B>:$PATH;  export  PATH</B>  # ordinary shell
<B>set  path=(</B><I>B</I>  <B>$path)</B>  # C shell
</PRE>

</DL>

<DL COMPACT>
<DT>&bull;<DD>
以下のように、
<I>A</I>

だけが書き込み許可を持つ <FONT SIZE="-1">RCS</FONT> ディレクトリ
<I>R</I>

を作成します:
</DL>
<P>

<DL COMPACT><DT><DD>
<PRE>
<B>mkdir</B>  <I>R</I>
<B>chmod  go-w</B>  <I>R</I>
</PRE>

</DL>

<DL COMPACT>
<DT>&bull;<DD>
特定のユーザだけに <FONT SIZE="-1">RCS</FONT> ファイルの読み込みを許可したい場合、
そのユーザをユーザグループ
<I>G</I>

に入れて、さらに
<I>A</I>

が以下のように、<FONT SIZE="-1">RCS</FONT> ディレクトリを保護します:
</DL>
<P>

<DL COMPACT><DT><DD>
<PRE>
<B>chgrp</B>  <I>G  R</I>
<B>chmod  g-w,o-rwx</B>  <I>R</I>
</PRE>

</DL>

<DL COMPACT>
<DT>&bull;<DD>
(存在すれば) 古い <FONT SIZE="-1">RCS</FONT> ファイルを
<I>R</I>

にコピーし、
<I>A</I>

が所有であることを保証します。
<DT>&bull;<DD>
<FONT SIZE="-1">RCS</FONT> ファイルのアクセスリストは、
リビジョンをチェックインおよびロックできるユーザを制限します。
デフォルトのアクセスリストは空で、
<FONT SIZE="-1">RCS</FONT> ファイルを読むことのできる全てのユーザに、登録の権限を与えます。
チェックインを制限したい場合は、
<I>A</I>

がそのファイルに対して
<B>rcs&nbsp;-a</B>

を実行します;
<B><A HREF="../man1/rcs.1.html">rcs</A></B>(1)

を参照してください。
特に
<B>rcs&nbsp;-e&nbsp;-a</B><I>A</I>

は、
<I>A</I>

だけにアクセスを制限します。
<DT>&bull;<DD>
初めてチェックインを行う前に、
<I>A</I>

は
<B>rcs&nbsp;-i</B>

によって新しい <FONT SIZE="-1">RCS</FONT> ファイルを初期化します。
チェックインを制限したい場合、
<B>-a</B>

オプションを付け加えます。
<DT>&bull;<DD>
setuid 特権は、
<B>ci</B>,

<B>co</B>,

<B>rcsclean</B>

のみに与えます;
<B>rcs</B>

や他のコマンドに、setuid 特権を与えてはなりません。
<DT>&bull;<DD>
<FONT SIZE="-1">RCS</FONT> コマンドに対して、他の setuid コマンドを実行しないでください。
setuid はあなたが考えるより扱いにくいものです。
</DL>
<A NAME="lbAK">&nbsp;</A>
<H2>環境変数</H2>

<DL COMPACT>
<DT><B></B><FONT SIZE="-1"><B>RCSINIT</B></FONT><B></B>

<DD>
本変数に空白で区切ったオプションを設定することで、
コマンドライン引数に先立って処理されます。
空白はバックスラッシュによってエスケープすることができます。
<B></B><FONT SIZE="-1"><B>RCSINIT</B></FONT><B></B>

はほとんどの <FONT SIZE="-1">RCS</FONT> コマンドで参照されます。特に
<B>-q</B>,

<B>-V</B>,

<B>-x</B>,

<B>-z</B>

オプションを指定しておくと便利です。
<DT><B></B><FONT SIZE="-1"><B>TMPDIR</B></FONT><B></B>

<DD>
一時ディレクトリ名を指定します。
設定されていない場合は、環境変数
<B></B><FONT SIZE="-1"><B>TMP</B></FONT><B></B>

と
<B></B><FONT SIZE="-1"><B>TEMP</B></FONT><B></B>

とを調べ、始めに見つかった値を用います;
どれも設定されていない場合は、
計算機依存のデフォルトのディレクトリ (たいていは
<B>/tmp</B>

) を使用します。
</DL>
<A NAME="lbAL">&nbsp;</A>
<H2>診断</H2>

各リビジョンに対して、
<I>ci</I>

は <FONT SIZE="-1">RCS</FONT> ファイル名、ワークファイル名、追加するリビジョン番号、直前の
リビジョン番号を表示します。全ての処理が成功した場合のみ、
終了ステータスが 0 になります。
<A NAME="lbAM">&nbsp;</A>
<H2>作者</H2>

Author: Walter F. Tichy.
<BR>

Manual Page Revision: 1.6; Release Date: 1999/08/27.
<BR>

Copyright &#169; 1982, 1988, 1989 Walter F. Tichy.
<BR>

Copyright &#169; 1990, 1991, 1992, 1993, 1994, 1995 by Paul Eggert.
<A NAME="lbAN">&nbsp;</A>
<H2>関連項目</H2>

<A HREF="../man1/co.1.html">co</A>(1),
<A HREF="../man1/ident.1.html">ident</A>(1), <A HREF="../../GNU_make/man1/make.1.html">make</A>(1), <A HREF="../man1/rcs.1.html">rcs</A>(1), <A HREF="../man1/rcsclean.1.html">rcsclean</A>(1), <A HREF="../man1/rcsdiff.1.html">rcsdiff</A>(1),
<A HREF="../man1/rcsintro.1.html">rcsintro</A>(1), <A HREF="../man1/rcsmerge.1.html">rcsmerge</A>(1), <A HREF="../man1/rlog.1.html">rlog</A>(1), <A HREF="../../LDP_man-pages/man2/setuid.2.html">setuid</A>(2), <A HREF="../man5/rcsfile.5.html">rcsfile</A>(5)
<BR>

Walter F. Tichy,
<FONT SIZE="-1">RCS</FONT>--A System for Version Control,
<I>Software--Practice &amp; Experience</I>

<B>15</B>,

7 (July 1985), 637-654.
<BR>

<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名称</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">解説</A><DD>
<DT><A HREF="#lbAE">オプション</A><DD>
<DT><A HREF="#lbAF">ファイル名規則</A><DD>
<DT><A HREF="#lbAG">使用例</A><DD>
<DT><A HREF="#lbAH">ファイルモード</A><DD>
<DT><A HREF="#lbAI">関連ファイル</A><DD>
<DT><A HREF="#lbAJ">SETUID の使用</A><DD>
<DT><A HREF="#lbAK">環境変数</A><DD>
<DT><A HREF="#lbAL">診断</A><DD>
<DT><A HREF="#lbAM">作者</A><DD>
<DT><A HREF="#lbAN">関連項目</A><DD>
</DL>
<HR>
This document was created by
<A HREF="../../man/man1/man2html.1.html">man2html</A>,
using the manual pages.<BR>
Time: 03:33:25 GMT, December 05, 2022
</BODY>
</HTML>
