
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of RSSH</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../jm.css">
</HEAD>
<BODY>

<H1>RSSH</H1>
Section: Derek D. Martin (1)<BR>Updated: 7 Jul 2003<BR><A HREF="#index">Index</A>
<A HREF="../../../index.html">JM Home Page</A>
<A HREF="../../../manual/rssh/release/man1/rssh.1">roff page</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>

rssh - scp と sftp の両方だけ、またはその一方のみを許可する
制限付セキュアシェル
<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B>rssh </B>

<I>-c scp|sftp-server </I>

[<I> options... </I>]<I> </I>[<I> ... </I>]

<A NAME="lbAD">&nbsp;</A>
<H2>説明</H2>

<B>rssh</B>

はホストへの
<I>ssh</I>(1)

を使ったアクセスの制限を提供する制限付きシェルで、シェルが
<B>rssh</B>

に設定されたユーザには、
<I>scp</I>(1)<I>,</I>

<I>sftp</I>(1)<I>,</I>

<I>cvs</I>(1)<I>,</I>

<I>rdist</I>(1)<I>,</I>

<I>rsync</I>(1)

のうちの一つ以上のコマンド
<B>のみ</B>

使用を許可する。
主に、OpenSSH (<A HREF="http://www.openssh.com">http://www.openssh.com</A> を参照)
と共に動作するように意図されてはいるが、
他の実装とも共に動作するだろう。
<P>

機密をもつシステムの管理者は、このシェルをインストールすべきである。
アクセスが制限されるべきすべてのユーザに対し、
そのパスワードエントリを編集し、シェルが
<B>rssh</B>

になるようにする。
例えば以下のようにする。
<P>

<DL COMPACT><DT><DD>
luser:x:666:666::/home/luser:/usr/bin/rssh
</DL>

<P>

もし
<I>-v</I>

オプション付きで起動されたら、
<B>rssh</B>

はバージョン番号を表示して終了する。
<B>rssh</B>

へのその他の引数はリモートの
<I>ssh</I>(1)

クライアントによって指定されたものが渡される。
一般のユーザはこのことをほとんど意識する必要はない。
制御を
<I>scp</I>(1)

または
<I>sftp</I>(1)

に渡すために、
rssh に渡される引数は、リモート側のシェルが受け取ったものを(そのまま)
使わなければならない。
もし
<B>rssh</B>

が適合しない引数を受け取った場合には、エラーメッセージを出して終了する。
ユーザが実行しようとしたプログラムが許可されなかった場合は
エラーメッセージを出力して終了する。
また、(コマンド置換のような)シェルコマンドを実行しようとした場合も
エラーメッセージを出力して終了する。
<P>

<B>rssh</B>

には設定ファイル <A HREF="../man5/rssh.conf.5.html">rssh.conf</A>(5) があり、
<B>rssh</B>

の動きのいくつかを設定可能である。
詳細は man ページを参照のこと。
<A NAME="lbAE">&nbsp;</A>
<H2>セキュリティ上の注意</H2>

<A NAME="lbAF">&nbsp;</A>
<H3>コマンドライン解析器</H3>

<B>rssh</B>

バージョン 2.2.3 の時点では、任意のコマンドの実行を引き起こす
(その結果、<B>rssh</B> のセキュリティをかいくぐる)
ようなコマンドラインオプションを避けるために、コマンドライン全体を
解析しなくてはならない。
ソースコードを健全にしておくため、やや熱心すぎるぐらいにコマンドラインオプションをマッチングする。
実際にはこれは問題にはならないが、理論上は可能だからである。
<P>

本当はそうではないにもかかわらず、
「安全でないコマンドラインオプションを拒否した」という理由で
<B>rssh</B>

の実行を拒否されるという問題に突き当たったら、コマンドラインを次のように
変えてみて欲しい。
すべての<I>短い</I>オプションを1文字のオプションフラグで指定する
(例えば、-ep の代わりに -e -p)、
引数とそれぞれのオプションをスペースで区切る
(例えば、-p123 の代わりに -p 123)。
ほとんど全ての場合で、これで問題は解決する。
お分かりのとおり完全な検索はしていないが、
一般的に有り得るような問題は見つかっていない。
<P>

別の解決策は、rcp, rdist, rsync に対する完全なコマンドライン解析器を
実装しておくことがだが、それはこのプロジェクトの目的でない。
実用上は、既にある解析器で十分である」
しかし、もしそうでない場合を見つけたのなら、詳細を
rssh メーリングリストに投稿して欲しい。
rssh メーリングリストへの投稿に関する詳細は
rssh ホームページから得ることができる。
<A NAME="lbAG">&nbsp;</A>
<H3>rssh をかいくぐることに対する安全策</H3>

<B>rssh</B>

は他のいくつかのプログラムと相互に作用するように設計されている。
たとえ rssh に完全にバグがなくても、他のプログラムの変更が
<B>rssh</B>

が提供している保護機能を無視する結果となり得る。
<B>システム管理者、すなわちあなたにとって重要なことは、
rssh と共に使うようにしたサービスを現在のままにしておき、
それらのコマンドがユーザーに任意のコマンドの実行を許可するような
仕組みを提供して</B><I>いない</I><B>ことを確かにしておくことでである。</B>
また、すべてのリリースの目標はバグがないことである一方、
完璧なものなど無い……
<B>rssh</B>

には発見されていないバグがあるかもしれず、それはユーザーが
rssh を無視することを許してしまうかもしれない。
<P>

そのような脆弱性から、システムを守ることができる。
3つの基本的な方法がある。
<P>

<DL COMPACT><DT><DD>
<DL COMPACT>
<DT>1.<DD>
ユーザーを chroot jail に押し込める
<DT>2.<DD>
ユーザーのホームのあるファイルシステムを
noexec オプション付きでマウントする
<DT>3.<DD>
一般的なファイルパーミッションを適切に用いる
</DL>
</DL>


<P>
<B>rssh</B>

は、ユーザーを chroot jail に入れる能力をシステム管理者に与える。
詳細は
<B><A HREF="../man5/rssh.conf.5.html">rssh.conf</A></B>(5)

の man ページと、ソースコードと共に配布されている
<I>CHROOT</I>

ファイルを参照のこと。
ユーザーが任意のコマンドを実行できないことを確かなものにしたいなら、
chroot jail を使用し、提供しようとしているサービスに必要なプログラム以外を
そこに置かないように気をつけること。
そうすれば、標準的なコマンドの実行を防ぐことができる。
<P>

そして、システムの実行ファイルがあるファイルシステムと、
ユーザーのファイルを分けておき、
(もしオペレーティングシステムにその機能があれば)
ユーザーのファイルのある
ファイルシステムを
<I>noexec</I>

オプション付きでマウントする。
こうすれば、目的のマシンに(例えば scp を使って)アップロードされた
プログラムが実行されるのを防ぐことができる。

<P>

最後に、chroot jail の中でユーザーがアクセスできてはならないものに
ついては、標準的な Unix/POSIX ファイルパーミッションを使用すること。
<A NAME="lbAH">&nbsp;</A>
<H3>OpenSSH のバージョンと rssh の無視</H3>

OpenSSH 3.5 より前では、一般的には
<I>sshd</I>(8)

はユーザのホームディレクトリにあるファイルを解析しようとし、
またユーザの
<I>$HOME/.ssh</I>

ディレクトリからスタートアップスクリプトを実行しようとする。
<B>rssh</B>

は決してユーザーの環境(変数)を使用しようとはしない。
関連するコマンド(訳注: sftp-serverなど)は、
コンパイル時に指定されたコマンドへのフルパスを指定して
<A HREF="../../LDP_man-pages/man3/execv.3.html">execv</A>(3) を呼び出すことで実行される。
これはユーザの PATH 変数には依存しないし、他の環境変数にも依存しない。
<P>

しかしながら、起こりうるいくつかの問題が存在する。
これは完全に OpenSSH プロジェクトの sshd の動作の仕方に原因があり、
決して
<B>rssh</B>

の欠陥ではない。たとえば、存在するであろう一つの問題としては、
OpenSSH の少なくともいくつかのリリースの
<I>sshd</I>(8)

の man ページによれば、
<I>$HOME/.ssh/rc</I>

ファイルに書かれているコマンドはユーザのデフォルトシェルの代わりに
<I>/bin/sh</I>

によって実行される。
著者がテストに使えるシステムではこの問題は発生しない。
すなわち、コマンドはユーザに設定されたシェル
(<B>rssh</B>)

によって実行され、それは実行を許可しない。
しかし、もしこれがあなたのシステムで有効になってしまっていれば、
悪意のあるユーザは
<I>/bin/sh</I>

に実行されるであろう
<I>$HOME/.ssh/rc</I>

ファイルをアップロードして、
<B>rssh</B>

を無視することができるだろう。
<P>
実際のところ、もしこの脆弱性問題が存在する(OpenSSH の)リリースが
あるとすれば、それは古く、旧式のバージョンである。
最近のバージョンのOpenSSHを動かしている限りは、
私が言える範囲では問題ないはずだ。
<P>

もし使っている sshd がこの攻撃に対して脆弱で
<I>ある</I>

ならば、かなり制限がかかるものの、この問題に対する回避方法がある。
<B>ユーザのホームディレクトリは絶対にそのユーザが書き込めては*いけない*。</B>

もし書き込めてしまえば、ユーザは sftp を使って(.ssh)ディレクトリの
名前を変えるか消すかして、あたらしい同名のディレクトリを作り、好きな
環境ファイル(訳注: 上記 $HOME/.ssh/rc ファイルのこと)をそこに書き込める。
ファイルのアップロードを開放するためには、ユーザが書き込めるディレクトリが
作成されていなければならず、ホームディレクトリのそれ以外の場所には
書き込めないことをユーザに承知させなければならない。
<P>

二つ目の問題は、ユーザが環境に変数を設定できることを可能にする
<I>$HOME/.ssh/environment</I>

ファイルを、sshd がユーザの認証後に読み込むことである。
環境変数
<I>LD_LIBRARY_PATH</I>

または
<I>LD_PRELOAD</I>

を上手に操作して、任意の共有ライブラリを rssh バイナリにリンク
させることによって
<B>rssh</B>

を完全に欺くことを許してしまう。
この問題を防ぐために、
<B>rssh</B>

は(バージョン 0.9.3 の時点では)デフォルトでは静的にコンパイルされる。
前述の制限付きの回避方法は、この種の攻撃も防ぐことができる。
OpenSSH 3.5 の時点では、
<I>sshd</I>

は
<I>PermitUserEnvironment</I>

オプションをサポートしており、これはデフォルトで &quot;no&quot; に設定されている。
このオプションは、
<B>rssh</B>

のような制限つきシェルが静的リンクの必要なしに適切に機能することを
可能にする。
<B>rssh</B>

バージョン 1.0.1 の時点で、configure スクリプトは OpenSSH 3.5 が
存在するかを検出し、静的コンパイルを無効にする。
<A NAME="lbAI">&nbsp;</A>
<H2>バグ</H2>

ない =8^)
<A NAME="lbAJ">&nbsp;</A>
<H2>関連項目</H2>

<I><A HREF="../man5/rssh.conf.5.html">rssh.conf</A></I>(5),

<I>sshd</I>(8),

<I>ssh</I>(1),

<I>scp</I>(1),

<I>sftp</I>(1)

<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">説明</A><DD>
<DT><A HREF="#lbAE">セキュリティ上の注意</A><DD>
<DL>
<DT><A HREF="#lbAF">コマンドライン解析器</A><DD>
<DT><A HREF="#lbAG">rssh をかいくぐることに対する安全策</A><DD>
<DT><A HREF="#lbAH">OpenSSH のバージョンと rssh の無視</A><DD>
</DL>
<DT><A HREF="#lbAI">バグ</A><DD>
<DT><A HREF="#lbAJ">関連項目</A><DD>
</DL>
<HR>
This document was created by
<A HREF="../../man/man1/man2html.1.html">man2html</A>,
using the manual pages.<BR>
Time: 03:33:45 GMT, December 05, 2022
</BODY>
</HTML>
