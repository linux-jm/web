
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of MAGIC</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../jm.css">
</HEAD>
<BODY>

<H1>MAGIC</H1>
Section: Devices and Network Interfaces (4)<BR>Updated: Public Domain<BR><A HREF="#index">Index</A>
<A HREF="../../../index.html">JM Home Page</A>
<A HREF="../../../manual/file/release/man4/magic.4">roff page</A><HR>










<A NAME="lbAB">&nbsp;</A>
<H2>名前</H2>

magic - file コマンド用のマジックナンバーファイル
<A NAME="lbAC">&nbsp;</A>
<H2>説明</H2>

このマニュアルページでは、
<B><A HREF="../man1/file.1.html">file</A></B>(1)

コマンド (バージョン 4.12) が使用する magic ファイルの書式を説明する。
ファイルの種類を調べる方法は色々あるが、
<B>file</B>

コマンドはファイルが特定の
<I>「マジックナンバー (magic number)」</I>
で始まるかどうかによってファイルの種類を識別する。
ファイル
<I>/usr/share/file/magic</I>

で指定することは、調べるべきマジックナンバー、
特定のマジックナンバーが見つかった時に表示するメッセージ、
ファイルから取り出せるその他の情報である。
<P>

magic ファイルの各行では実行するテストを指定する。
テストでは、ファイル先頭から見て特定のオフセット位置にあるデータと、
1 バイトまたは 2 バイト、4 バイトの数値や文字列との比較が行われる。
テストが成功すると指定したメッセージが出力される。
行には以下の項目が含まれる:
<DL COMPACT>
<DT>offset<DD>
調べるデータのファイル内での位置を指定するオフセット値で、単位はバイトである。
<DT>type<DD>
調べるデータの型。指定できる値は以下の通りである:
<DL COMPACT><DT><DD>
<DL COMPACT>
<DT>byte<DD>
1 バイト値。
<DT>short<DD>
(ほとんどのシステムでは) 2 バイト値。マシンのネイティブのバイト順である。
<DT>long<DD>
(ほとんどのシステムでは) 4 バイト値。マシンのネイティブのバイト順である。
<DT>string<DD>
文字列を表すバイト列。
string 型の指定では、オプションとして /[Bbc]* を後ろに続けることができる。
``B'' フラグは、対象ファイル中の複数個の空白を 1 個の空白に切り詰めて扱う。
この場合、対象ファイルは少なくとも 1 個の空白を含んでいる必要がある。
magic ファイルに
<I>n</I>

個の連続した空白がある場合、
対象ファイルには、これにマッチする
<I>n</I>

個の連続した空白が必要となる。
``b''フラグは、対象ファイル中の空白を
存在してもしなくてもよい空白として扱う。
さらに、``c'' フラグは、大文字・小文字を区別しないマッチを行うことを指定する:
magic ファイル中の小文字は、
対象ファイル中の大文字・小文字の両方にマッチする。
しかし、magic ファイル中の大文字は、
対象ファイル中の大文字にのみマッチする。
<DT>date<DD>
UNIX 時刻と解釈される 4 バイト値。
<DT>ldate<DD>
UNIX 形式の時刻と解釈される 4 バイト値。
ただし UTC ではなくローカルタイムとして解釈される。
<DT>beshort<DD>
(ほとんどのシステムでは) 2 バイト値。バイト順はビッグエンディアンである。
<DT>belong<DD>
(ほとんどのシステムでは) 4 バイト値。バイト順はビッグエンディアンである。
<DT>bedate<DD>
(ほとんどのシステムでは) 4 バイト値。バイト順はビッグエンディアンである。
UNIX 時刻と解釈される。
<DT>leshort<DD>
(ほとんどのシステムでは) 2 バイト値。バイト順はリトルエンディアンである。
<DT>lelong<DD>
(ほとんどのシステムでは) 4 バイト値。バイト順はリトルエンディアンである。
<DT>ledate<DD>
(ほとんどのシステムでは) 4 バイト値。バイト順はリトルエンディアンである。
UNIX 時刻と解釈される。
<DT>leldate<DD>
(ほとんどのシステムでは) 4 バイト値。バイト順はリトルエンディアンである。
UNIX 形式の時刻と解釈される。
ただし UTC ではなくローカルタイムとして解釈される。
</DL>
</DL>

</DL>
<P>

数値型の値の後には
<B>&amp;</B>

と数値を書くことができる。この場合、比較を行う前に
<B>&amp;</B>

の後に置いた数値との AND 演算が行われる。型の前に
<B>u</B>

を置くことで、順序付きの比較を符号無しで行うことが指定できる。
<DL COMPACT>
<DT>test<DD>
ファイル内の値と比較する値。
これは C 言語の文字列として指定し、エスケープ文字も普通に使える
(例: \n は改行文字)。
<DT><DD>
数値
の前には、実行する動作を指定する文字を置くことができる。
<B>=</B>

を指定した場合は、ファイル内の値は指定した値と等しくなければならない。
<B>&lt;</B>

を指定した場合は、ファイル内の値は指定した値より小さくなければならない。
<B>&gt;</B>

を指定した場合は、ファイル内の値は指定した値より大きくなければならない。
<B>&amp;</B>

を指定した場合は、指定した値で立っている全てのビットがファイル内の値でも
立っていなければならない。
<B>^</B>

を指定した場合は、指定した値で立っているどのビットも、
ファイル内の値で立っていてはならない。
<B>x</B>

はどんな値にもマッチする。文字が省略されている場合は、
<B>=</B>

が指定されているとみなされる。
<DT><DD>
数値は C 言語の書式で指定する。例えば、
<B>13</B>

は 10 進数、
<B>013</B>

は 8 進数、
<B>0x13</B>

は 16 進数である。
<DT><DD>
文字列の場合、ファイル中に含まれるバイト文字列は、指定された
バイト文字列にマッチしなければならない。
演算子
<B>=</B>,

<B>&lt;</B>,

<B>&gt;</B>

は文字列にも適用できる (ただし
<B>&amp;</B>

は適用できない)。
マッチングを行う長さは、magic ファイルの文字列引数の長さである。
つまり、
<B>&gt;\0</B>

を指定することにより、ある行をどんな文字列にもマッチさせ、そして多分
その文字列を表示させることができるだろう。
<DT>message<DD>
比較が成功したときに出力されるメッセージ。
文字列に
<B><A HREF="../../LDP_man-pages/man3/printf.3.html">printf</A></B>(3)

の書式指定が含まれている場合、このメッセージを書式指定文字列として使って
ファイル内の値 (指定された全てのマスク処理は実行される) が出力される。
</DL>
<P>

一部のファイルフォーマットでは、ファイルの種類とともに追加情報が表示される。
文字
<B>&gt;</B>

で始まる行は、追加で行うテストと表示メッセージを示す。
1 行に含まれる
<B>&gt;</B>

の数はテストのレベルを表す。
先頭に
<B>&gt;</B>

がない行はレベル 0 になる。
レベル
<I>n</I><B>+1</B>

の各行は、magic ファイル中で自分より前にあるレベル
<I>n</I>

の行のうち、最も近い位置のものの制御に従う。
レベル
<I>n</I>

の行のテストが成功すると、それに続く全てのレベル
<I>n</I><B>+1</B>

の行で指定されているテストが実行され、
そのテストが成功するとメッセージが出力される。
次に
<I>n</I>

があった場所でこの動作は終了する。
直前の
<B>&gt;</B>

の直後の文字が
<B>(</B>

ならば、括弧の後の文字列は間接オフセット値と解釈される。
つまり、括弧の後の数字はファイル内でのオフセットとして使われる。
このオフセット位置にある値が読み込まれ、
読み込まれた値がファイル中でのオフセットとして使われる。
間接オフセット値の書式は以下である:
<B>((</B><I>x</I><B>[.[bslBSL]][+-][</B><I>y</I><B>]).</B>

<I>x</I>

の値はファイル内でのオフセット値として使われる。
そのオフセット位置にある byte 型、short 型、long 型の値が読み込まれるが、
どの型になるかは型指定子
<B>[bslBSL] </B>

によって決まる。
大文字で示される型はビッグエンディアンの値と解釈され、
小文字で示される型はリトルエンディアンの値と解釈される。
この数まで
<I>y</I>

の値に加えられ、その結果がファイル中のオフセット値として使われる。
何も指定されていない場合のデフォルトの型は long である。
<P>

前のフィールドの長さによってオフセット値が変わるため、
正確なオフセット値がわからない場合もある。
この場合は、直前の上位レベルの
フィールドの終わりからの相対位置でオフセットを指定できる
(当然ながらこの方法はサブレベルのテスト、つまり
<B>&gt;</B>

で始まるテストでしか使えない)。
このような相対オフセット値は、オフセット値の前に
<B>&amp;</B>

を置くことで指定する。
<A NAME="lbAD">&nbsp;</A>
<H2>バグ</H2>

<I>long</I>,

<I>belong</I>,

<I>lelong</I>,

<I>short</I>,

<I>beshort</I>,

<I>leshort</I>,

<I>date</I>,

<I>bedate</I>,

<I>ledate</I>

の書式はシステム依存である。識別させるファイルは、
この長さが違うシステムから持ってくることが多いため、
バイト列として指定すべきだろう (2B, 4B 等)。
<P>

(現時点では) 間接オフセット値でエンディアンを指定して
データを扱うことはできない。
<A NAME="lbAE">&nbsp;</A>
<H2>関連項目</H2>

<B><A HREF="../man1/file.1.html">file</A></B>(1)

- このファイルを読むコマンド。














<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名前</A><DD>
<DT><A HREF="#lbAC">説明</A><DD>
<DT><A HREF="#lbAD">バグ</A><DD>
<DT><A HREF="#lbAE">関連項目</A><DD>
</DL>
<HR>
This document was created by
<A HREF="../../man/man1/man2html.1.html">man2html</A>,
using the manual pages.<BR>
Time: 03:33:37 GMT, December 05, 2022
</BODY>
</HTML>
