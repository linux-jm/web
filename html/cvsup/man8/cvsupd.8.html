
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of CVSUPD</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../jm.css">
</HEAD>
<BODY>

<H1>CVSUPD</H1>
Section: Maintenance Commands (8)<BR><A HREF="#index">Index</A>
<A HREF="../../../index.html">JM Home Page</A>
<A HREF="../../../manual/cvsup/release/man8/cvsupd.8">roff page</A><HR>
<BR>BSD mandoc<BR>
<A NAME="lbAB">&nbsp;</A>
<H2>名称</H2>

<B>cvsupd</B>

 - ネットワーク上で CVS レポジトリを配布するためのサーバ

<A NAME="lbAC">&nbsp;</A>
<H2>書式</H2>

<B></B>


[-<B>ev</B>

]

[-<B>A </B><I>addr</I>



]

[-<B>b </B><I>base</I>



]

[-<B>c </B><I>collPath</I>



]

[-<B>C </B><I>maxClients</I>



]

[-<B>l </B><I>log</I>



]

[-<B>p </B><I>port</I>



]

[-<B>P </B><I>range</I>



]

[-<B>s </B><I>scanDir</I>



]

[-<B>Z </B><I>comprLevel</I>



]

<A NAME="lbAD">&nbsp;</A>
<H2>解説</H2>

<B></B>


はネットワーク配布のためのパッケージである
<B>CVSup</B>

のサーバプログラムです。
サーバと組み合わせて動作するクライアントプログラム
に関しては
<A HREF="../man1/cvsup.1.html">cvsup</A>(1)


を参照してください。
<P>

通常使用時には
<B></B>


に
`-<B>C</B>

'

Ar maxClients
オプションを指定して実行しなければなりません。
<B></B>


はバッググラウンドデーモンとして実行され、
リモートクライアントからの接続要求に対応します。それぞれの接続について
<B></B>


は子プロセスを fork し、クライアントが要求したファイルを送ります。
<P>

以下のオプションがサポートされています:
<DL COMPACT>
<P>

<DT><B>-A </B><I>addr</I>




<DD>
サーバが接続を受け付ける(accept)するローカルのアドレス(IP アドレス
またはホスト名)を指定します。このオプションは複数個の IP アドレスを持つ
ホストで役立つでしょう。
<DT><B>-b </B><I>base</I>




<DD>
<I>base</I>

を設定ファイルの起点ディレクトリとして使います。
デフォルト値は
/usr/local/etc/cvsup

です。
<DT><B>-c </B><I>collPath</I>




<DD>
提供されるコレクションに関する情報を得るために、指定されたディレクトリを
検索します。
<I>collPath</I>

は 1 つのディレクトリ、もしくはコロンで区切った複数のディレクトリを
含みます。
絶対パスで指定されていない場合は、起点ディレクトリからの相対パスと解釈
されます。
デフォルトの検索パスは
`sup'

です。
<DT><B>-C </B><I>maxClients</I>




<DD>
同時に接続できるクライアントの数を
<I>maxClients</I>

に制限します。
指定した最大数を超えた場合、クライアントはサービスを丁寧に
断わられます。
<P>

このオプションが指定されていない場合、
<B></B>


はフォアグラウンドで動作して 1 クライアントに対してのみサービスを行い、
それが終わると終了します。
<DT><B>-e</B>


<DD>
デーモンモードで動作している場合に、標準出力と標準エラー出力への
メッセージのリダイレクトを抑制し、syslog を用いてログを記録します。
このオプションを設定しない場合、標準出力と標準エラー出力は
/dev/null

にリダイレクトされます。
このオプションは、サーバのクラッシュのような滅多にないパニックの際の
メッセージを押さえるのに役立ちます。
こういったメッセージはデバッグに非常に有用ですが、それらを syslog に送
るための確実な方法がないためです。
このオプションのお勧めの使い方は次のようなものです:

<BLOCKQUOTE><TT>cvsupd -e ... &gt;&gt;/var/tmp/cvsupd.out 2&gt;&amp;1</TT></BLOCKQUOTE>
ただし、このコマンドラインでは
sh(1)


の表記を使っています。
<DT><B>-l </B><I>log</I>




<DD>
ログメッセージを
<I>log</I>

に書き出します。
<I>log</I>

が
<B>@ </B><I>facility</I>





(例 
`@local0'

)
のような形式で指定された場合、ロギングは指定された facility を使い
syslog 経由で行われます。
そうでない場合、
<I>log</I>

はログファイルの名前として扱われます。
そのファイルがすでに存在している場合には、新しいメッセージはファイルの最
後に追加されます。
<P>

サービスを受ける各クライアントについて、少なくとも 2 つのメッセージが
記録されます。最初のメッセージはユーザ名とホスト名でクライアントを
識別します。最後のメッセージは更新の成功・失敗と、合計のネットワーク I/O 
の量をキロバイト単位(1K = 1024)で報告します。エラーやその他の知らせる
べき状態を知らせるために、この 2 つ以外のメッセージが送られることがあ
ります。

<DT><B>-p </B><I>port</I>




<DD>
サーバが接続を待ち受ける(listen する) TCP ポートを指定します。
デフォルト値は 5999 です。
パッシブモードでない場合には、サーバからクライアントに向かって張る 2
番目の接続(データ接続と呼ばれます)のために、サーバはこれより 1 つ小さ
い番号のポートも使います。
<DT><B>-P </B><I>range</I>




<DD>
パッシブモードの時にデータ接続に使うサーバ側の TCP ポートの範囲を指定
します。
<I>範囲</I>

は単一の整数もしくは
`lo-hi'

の範囲のどちらかの形で指定できます。
<DT><B>-s </B><I>scanDir</I>




<DD>
ミラーモードを有効にし、scan ファイルがあるディレクトリを指定します。
<I>scanDir</I>

が絶対パスで指定されていなければ、これは起点ディレクトリからの相対パス
と解釈されます。後述の
Sx CVSup を使ったミラーサイトの運用

をご覧ください。
<DT><B>-v</B>


<DD>
バージョン番号を表示して終了します。クライアントには何も提供しません。
<DT><B>-Z </B><I>comprLevel</I>




<DD>
圧縮レベルを
<I>comprLevel</I>

に設定します。
圧縮レベルは 0 から 9 の間で指定します。
レベル 0 では圧縮は行われず、9 で圧縮率が最大となります。
デフォルトの圧縮レベルは 1 です。
これよりも高い圧縮レベルを使っても、CPU パワーが大幅に消費される割には
ファイルサイズはほとんど改善されません。
</DL>
<P>

<A NAME="lbAE">&nbsp;</A>
<H2>ファイルコレクションレポジトリを準備する</H2>

<B></B>


がクライアントに提供するファイルコレクションは、様々な設定ファイルで記述
します。
設定ファイルは

<I>base / colldir</I>




ディレクトリ下に置きます。ここで
<I>base</I>

は
-<B>b </B><I>base</I>



コマンドラインオプションで指定されたもの、もしくはデフォルト値の
/usr/local/etc/cvsup

です。
<I>collDir</I>

は
-<B>c</B>

オプションで指定されたディレクトリのいずれか、もしくはデフォルト値の
`sup'

です。
<P>

各コレクションの設定ファイルは、

<I>base / collDir</I>




下に作ったコレクション名と同名のサブディレクトリに個別に置かれます。
例えば
`src-base'

コレクションの設定ファイルは

<I>base / collDir /src-base

</I>




に置かれます。
コレクションのサブディレクトリ中には、
releases

ファイルとリストファイルが置かれます。
releases

ファイルはリリースごとに一行の記述を含みます。
各行の最初の語はリリース名です。例えば
`cvs'

となります。
その後には、順不同で以下のようなフレーズが続きます:
<DL COMPACT>
<P>

<DT><B>list= </B><I>file</I>






<DD>
リストファイルの名前を、コレクションのサブディレクトリに対する相対パス
で指定します。リストファイルについては後ほど説明します。
<DT><B>prefix= </B><I>directory</I>






<DD>
コレクションを構成するファイルのある場所を指定します。
もし
<I>directory</I>

が絶対パスでなければ、起点ディレクトリ
<I>base</I>

からの相対パスと見なされます。
<B>prefix</B>

が指定されていない場合のデフォルト値は
<I>base</I>

です。
<DT><B>keywordprefix= </B><I>directory</I>






<DD>
``仮想プレフィックス''

を指定します。これは RCS のキーワードである
`$Header$'

と
`$Source$'

を絶対パスに展開するためにのみ用いられます。
普通は、
<I>direcotry</I>

はマスターの CVS レポジトリを持っているマシンにおける、その
CVS レポジトリの絶対パスです。
<B>keywordprefix</B>

を用いると、
<B>CVSup</B>

は必ず、
実際のレポジトリの位置によらず全てのマシン上で RCS 
キーワードを同一の形に展開します。
<DT><B>super= </B><I>collection</I>






<DD>
現在のコレクションの直接のスーパーコレクションを指定します。
配布物が大きな場合には、コレクションに階層を持たせてまとめることがよく
あります。最も上の階層は、配布されている全てのファイルを含む
コレクションです。次の階層はいくつかのサブコレクションからなり、それぞ
れは全体のファイルの部分集合となります。
各サブコレクションは自分の下にサブコレクションを持てますし、それ以降も
同様です。
<B>super</B>

キーワードは、こういった階層的な配置において、そのコレクションの
親コレクションを指定します。
<P>

このキーワードは省略してもかまいません。省略された場合には、
<B></B>


は現在のコレクションと利用可能な他のコレクションの間に
何の関連もないとみなします。
<P>

<B>super</B>

キーワードから得た情報は、サーバがミラーサイトとして動作している時に、
適切な scan ファイルを見つけるために使われます。
Sx CVSup を使ったミラーサイトの運用

をご覧ください。
<DT><B>nocheckrcs</B>


<DD>
更新される RCS ファイル群について、MD5 チェックサムの比較を行いません。
RCS ファイルにおけるチェックサムの不一致は意味を持ちません。なぜなら、
ある論理的な意味を持った RCS ファイルには、テキストとしての表現はたく
さんあるからです。
<DT><B>norcs</B>


<DD>
RCS ファイルを特別扱いしません。RCS ファイルを他のファイルと同様に扱い
ます。
<DT><B>norsync</B>


<DD>
<I>rsync</I>

アルゴリズムを使わないようにします。
<B>注意:</B>

このキーワードを
releases

ファイルで使うのは古いやり方です。これを使わないでリストファイル内で
<B>norsync</B>

または
<B>rnorsync</B>

を使ってください(後述)。
</DL>
<P>

<P>

認識できないキーワードは受け付けられますが、無視されます。
これは
sup(1)


パッケージとの後方互換性のためです。
<B></B>


が提供するリリースが 1 つだけであっても、
releases

ファイルは必要であることを覚えておいてください。
<P>

リストファイルは、クライアントのコレクションのバージョンを更新する方法
を詳しく指定します。
各行には 1 つだけコマンドが書かれます。空行と
`#'

から始まる行は無視されます。
指定される全てのファイル名は
releases

内で指定されている
<B>prefix</B>

ディレクトリからの相対パスとして扱われます。
<P>

リストファイルのコマンドの多くは、ファイル名のパターンを引数として
受け付けます。
このパターンは
sh(1)


が受け付けるパターンに似ており、
`*'

,
`?'

,
`[...]'

を組み合わせたワイルドカードが使えます。
<B>omitany</B>

パターンだけは例外ですが、その他の場合には、ファイル名に含まれる
スラッシュ文字は、パターン中のスラッシュ文字とだけマッチします。
例えば
`*'

は
`.prifole'

というファイル名にマッチします。
<DL COMPACT>
<P>

<DT><B>upgrade </B><I>pattern ...</I>




<DD>
与えられたパターンのいずれかにマッチした、すべてのファイルとディレクトリ
が更新ド対象のリストに含められます。
ディレクトリ名がマッチした場合、その中にある全てのファイルと
サブディレクトリが再帰的に含まれます。
<DT><B>always </B><I>pattern ...</I>




<DD>
このコマンドは、全ての
<B>omitany</B>

コマンドを上書きすることを除いて、
<B>upgrade</B>

コマンドと同一です。
<DT><B>omitany </B><I>pattern ...</I>




<DD>
与えられたパターンのいずれかにマッチした、すべてのファイルとディレクトリ
は更新対象のリストから除外されます。
ディレクトリ名がマッチした場合、その中にある全てのファイルと
サブディレクトリが除外されます。
<P>

<B>omitany</B>

に対するパターンの解釈は他のパターンと異なります。
一般のパターンでは、パス名に含まれるスラッシュ文字はパターン中の
スラッシュ文字にのみマッチしますが、
<B>omitany</B>

に与えるパターンでは、スラッシュ文字は他の文字と同じように扱われます。
したがって、
`*.c'

は
`.c'

で終わるすべてのパス名にマッチします。例えば
`foo/bar/lam.c'

も含まれます。
<DT><B>symlink </B><I>pattern ...</I>




<DD>
与えられたパターンのいずれかにマッチしたシンボリックリンクは、その
シンボリックリンクが指すファイルとしてではなく、シンボリックリンクとし
てアップグレードされます。
この指定がない場合、シンボリックリンクのリンク先が参照され、リンクが指
すファイルがクライアントに送られます。
<DT><B>rsymlink </B><I>pattern ...</I>




<DD>
このコマンドは
<B>symlink</B>

に似ていますが、もしディレクトリがマッチした場合、そのディレクトリ
ツリー以下のすべてのシンボリックリンクもマッチしたものとして扱われます。
<DT><B>norsync </B><I>pattern ...</I>




<DD>
与えられたパターンのいずれかにマッチしたファイルの更新において、rsync 
アルゴリズムが使われません。この指定はログファイルで役立ちます。
というのも、
<B></B>


の
``append''

最適化の方が rsync アルゴリズムよりも効率的だからです。
<DT><B>rnorsync </B><I>pattern ...</I>




<DD>
このコマンドは
<B>norsync</B>

に似ていますが、もしディレクトリがマッチした場合、そのディレクトリ
ツリー以下の全てのファイルがマッチしたものとして扱われます。
<DT><B>execute </B><I>command (pattern ...</I>

)






<DD>
<I>pattern</I>

の 1 つにマッチするファイルの更新が成功したときに、指定された
<I>command</I>

がクライアントによって実行されます。
<I>command</I>

は、最初の
`('

までの全ての語からなります。
`%s'

という文字列はすべて、クライアントホストで更新されたファイルのパス名に
置き換えられます。
存在する
`%%'

はすべて
`%'

に置き換えられます。
コマンドは文字列を
/bin/sh

に渡すことで実行されます。
<P>

空白文字で区切って複数のパターンを指定することができます。
それらのファイルは
<B>prefix</B>

ディレクトリからの相対パスとして解釈されます。
それぞれのパターンは、ファイルが
<I>server</I>

上に存在する場合でも適切なファイルにマッチするように記述しなければなり
ません。
例えば RCS ファイル名の
`,v'

サフィックスは、たとえチェックアウトモードの結果としてクライアント上にそ
のサフィックスが存在しない場合でもマッチしなければなりません。
ファイル名に含まれるスラッシュ文字は、パターン中のスラッシュと正確に一
致しなければなりません。
CVS の
`Attic'

ディレクトリはマッチングの処理に暗黙的に含まれるで、パターン中で直接指
定してはいけません。
マッチするファイルは、それが Attic かどうかに関わらず発見されます。
<P>

<B>execute</B>

文がディレクトリにマッチした場合、コマンドが実行されるのは、
ディレクトリが新規に作成されたとき、またはディレクトリの属性が変更され
たときです。
コマンドはディレクトリから上ったとき、つまりそのディレクトリ内の
ファイルとサブディレクトリの処理が終わった後に実行されます。
<P>

複数の
<B>execute</B>

文が 1 つのファイルにマッチした場合、全ての関係するコマンドが順に実行
されます。
<P>

セキュリティ上の理由で、クライアントは全ての
<B>execute</B>

文を無視するかもしれません。
</DL>
<P>

<P>

認識できないコマンドは受け付けられますが、無視されます。これは
sup(1)


との後方互換性のための動作です。
<A NAME="lbAF">&nbsp;</A>
<H2>CVSup によるミラーサイトの運営</H2>

ミラーサイトとは、
<B>CVSup </B>

を用いてマスターのサイトからファイルの取得と更新を行い、
<B>CVSup</B>

経由で他のサイトにファイルを再配布するサーバのことです。ミラーサイトは、
大きなプロジェクトで負荷を複数のサーバに分散するためによく使われます。
配布されるファイルは元々はマスターサイトに置かれます。各ミラーサイトは
マスターサイトを基にして、自分が持っているコピーを定期的に更新します。
次に、クライアントはミラーサイトのどれかから更新分のファイルを取得しま
す。
<P>

<B></B>


には、ミラーサイトの効率を劇的に向上させるための特殊な動作モードがあり
ます。このモードはコマンドラインで
-<B>s </B><I>scanDir</I>



オプションを指定すると有効になります。
-<B>s</B>

オプションを指定しないと、
<B></B>


は要求された各コレクションのファイルに対してファイルツリー全体を調
べて、全てのファイルについて
<A HREF="../../LDP_man-pages/man2/stat.2.html">stat</A>(2)


システムコールを実行します。この動作は接続した全てのクライアントに対し
て行われます。どのファイルがいつ変更されるか分からないからです。このよ
うな調べ方をするとファイルを持っているディスクに対してシークの負荷が大
きくかかり、同時にサービスを受けられるクライアントの数が制限されること
になります。
<P>

ミラーサイトの場合には、コレクション内のファイルが更新されるのは新しい
バージョンを
<B>CVSup</B>

経由で受け取る時だけであることが分かっています。
-<B>s</B>

オプションを使うと、
<B></B>


はこの性質を生かして、ファイルツリーの調査を全く行わずにすみます。
そのため、サーバのディスク負荷は大幅に削減されます。ファイルツリーを調
べる代わりに、
<B></B>


はコレクション内のファイルに関する必要な情報を
<I>scan</I>

ファイルを読むことによって取得します。scan ファイルは、
<B>cvsup</B>

クラアイントがミラーサイト上のファイルをマスターサイトにあるオリジナル
のデータを使って更新する際に、クライアントが作成します。
CVSUP(1)


では、これらのファイルは
<I>list</I>

と書かれています。どちらの呼び方でも同じファイルを指しています。
<B></B>


はクライアントにサービスする際は毎回、最後のマスターサイトからの更新の
ときに生成された scan ファイルを見つけます。したがって、サーバは
コレクション内にあるファイルに関する最新の情報を常に持っており、
ファイルツリーを調べる必要はありません。
<P>

-<B>s</B>

オプションの後には、scan ファイルがあるディレクトリ名を指定します。こ
れは普通、起点ディレクトリのサブディレクトリであり、
<B>cvsup</B>

クライアントがリストファイルを管理している場所と一致していなければなり
ません。デフォルトでは、
<B>cvsup</B>

は起点ディレクトリのサブディレクトリである
sup

にこれらのファイルを置きます。これに合わせるには、
<B></B>


は
`-s'

sup
で実行しなければなりません。
-<B>c</B>

オプションによって
<B>cvsup</B>

のリストファイルの位置がデフォルト値から変更されている場合、
<B>の scan ディレクトリも同じように変更しなければなりません。</B>



-<B>s</B>

オプションにはデフォルト値はありません。コマンドラインで明示的に指定し
ていなければ、scan ファイルは全く使われません。
<P>

全てのコレクションに対して scan ファイルが存在する必要はありません。
<B></B>


はまずクライアントが要求したコレクションについて scan ファイルを探しま
す。その scan ファイルが存在しなければ、
<B></B>


は順にスーパーコレクションの scan ファイルを探していき、最初に見つかっ
た scan ファイルを使います。
(詳しくは
Sx ファイルコレクションレポジトリを準備する

で説明されている
<B>super</B>

キーワードの説明を参照してください。)
適切な scan ファイルがなければ、
<B></B>


は最終的にファイルツリーを全て調べます。
<A NAME="lbAG">&nbsp;</A>
<H2>アクセス制御</H2>

デフォルトの動作ではサーバへのアクセスは制限されていませんが、接続する
クライアントの IP アドレスに基づくかなり柔軟な機構があります。この機構は
アクセス制御ファイル
<I>base </I><B>/cvsupd.access

</B>



に規則を書くことによって有効になります。アクセス制御ファイルは
テキストファイルであり、1 行に 1 つの規則が書かれます。コメントは
`#'

で始まり、その行の最後まで続きます。空白文字は無視されますが、隣り合う
トークンを区切る場合は除きます。空行は無視されます。
<P>

それぞれの規則は以下の要素からなります:
<UL><P>

<LI>

規則が
<I>許可(permit)</I>

規則、
<I>認証(authenticate)</I>

規則、
<I>拒否(deny)</I>

規則のいずれであるかを示すフラグ。このフラグは 1 つの文字で表されます:
`+'

は許可規則、
`*'

は認証規則、
`-'

は拒否規則を表します。
<LI>

クライアントの IP アドレスと比較され、そのクライアントに規則を適用する
かどうかが決めるための IP アドレス。これは数値の IP アドレスでも
ホスト名でも記述できます。数値のアドレスは、ドットで区切った 1 個から 
4 個のオクテットで表します。指定したオクテットが 4 個より少ない場合は、
後ろのオクテットが 0 であるとして扱われます。
<P>

ホスト名は読み込まれる時に数値アドレスに変換されます。
ホストが複数個のアドレスを持っている場合、それぞれのアドレスに対する
規則が個別に追加されます。これは望み通りの動作をするかもしれませんし、
そうでないかもしれません。
<P>

ホスト名は注意して使うべきです。解決に時間がかかる名前があると、
サーバの動作が著しく遅くなるからです。
<LI>

アドレスを比較する前に規則とクライアントの IP アドレスとの AND を取る
ための
<I>matching</I>

マスク。このマスクは、
マスクの上位ビットにある 1 の個数を
`/'

の後に書いて指定します。例えば、
`/24'

は 0xffffff00 というマスクを示します。
<I>matching</I>

マスクは省略してもかまいません。省略した場合のデフォルト値は
`/32'

です。
<LI>

規則にマッチしたクライアントを数える方法(後述)を決める
<I>counting</I>

マスク。
指定方法は
<I>matching</I>

マスクと同じです。
<I>counting</I>

マスクは省略してもかまいません。省略した場合はデフォルト値として、
<I>matching</I>

マスクと同じ値を持ちます。
<LI>

同時にマッチできるクライアントの最大数を指定する
<I>limit</I>

値。これは 10 進の整数で指定し、前の要素と区別するために空白を前に
置きます。
<I>limit</I>

は省略してもかまいません。省略した場合のデフォルト値は、
<I>拒否</I>

規則については 0 であり、
<I>許可</I>

規則については無制限です。
</UL><P>

<P>

クライアントがサーバに接続した際、クライアントの IP アドレスは
規則に対して順番にチェックされていきます。
それぞれの規則は以下のように処理されます:
<OL><P>

<LI>

規則の IP アドレスとクライアントの IP アドレスを比較します。
比較の前にはそれぞれのアドレスと
<I>matching</I>

マスクとの AND を取っておきます。
アドレスがマッチしなければ、この規則は無視されます。
<LI>

現在接続している他の全てのクライアントの IP アドレスと
接続しようとしているクライアントの IP アドレスを比較します。
比較の前には各アドレスと
<I>counting</I>

マスクとの AND を取っておきます。マッチしているクライアントの数
(接続しようとしているクライアントは数えません)が
<I>limit</I>

より小さければ規則は
<I>成功</I>

となります。
そうでなければ規則は
<I>失敗</I>

します。
<LI>

規則が
<I>許可</I>

規則であり、かつ成功であれば、クライアントの接続が許可され、残りの規則
は無視されます。
<LI>

規則が
<I>認証</I>

規則であり、かつ成功であれば、サーバはクライアントが何者であるかを確認
しようとします。確認には challenge-response プロトコルを用います(後述の
Sx 認証

の節を見てください)。
アクセスが許可されるか拒否されるかは認証の結果によって決まります。
残りの規則は無視されます。
<LI>

規則が
<I>拒否</I>

規則であり、かつ失敗であれば、クライアントはアクセスを拒否され、残りの
規則は無視されます。
<LI>

これ以外の場合には、次の規則について処理が継続されます。
</OL><P>

<P>

リストの最後には、どんな IP アドレスにもマッチする
<I>認証</I>

規則が暗黙的に置かれています。したがって、アクセスが許可も拒否もされず
に処理が終わった場合は、アクセスは認証機構によって制御されます。
<P>

規則の一般的な使用方法の例を以下に示します。
<P>


<BLOCKQUOTE><TT>-spam.cyberpromo.com</TT></BLOCKQUOTE>
特定のホストからのアクセスを全て拒否します。
<P>


<BLOCKQUOTE><TT>+mirror.FreeBSD.org</TT></BLOCKQUOTE>
特定のホストからのアクセスを無制限に許可します。
<P>


<BLOCKQUOTE><TT>-user.FreeBSD.org 1</TT></BLOCKQUOTE>
特定のホストからの同時接続を 1 つだけに制限します。
<P>


<BLOCKQUOTE><TT>-198.211.214/24</TT></BLOCKQUOTE>
特定のクラス C アドレスのホストからのアクセスを拒否します。
<P>


<BLOCKQUOTE><TT>-198.211.214/24 3</TT></BLOCKQUOTE>
特定のクラス C アドレスのホストからの同時アクセスを、
合計 3 つまで許可します。
<P>


<BLOCKQUOTE><TT>-198.211.214/24/32 3</TT></BLOCKQUOTE>
特定のクラス C アドレスに含まれるホストからの同時アクセスを、
ホストごとに合計 3 つまで許可します。
<P>

上記 2 つの例の違いに注意してください。
前者の例はネットワークごとの制限を行い、後者の例はホスト単位の制限を行っ
ています。両者の相違点は
<I>counting</I>

マスクです。最初の例はマスクが 24 ビットなので、指定したアドレスブロッ
クに含まれる全てのホストについて共通のカウンタが作られます。後者の例は
マスクが 32 ビットなので、ホストごとに別々のカウンタが作られます。
<P>


<BLOCKQUOTE><TT>-0.0.0/0/24 1</TT></BLOCKQUOTE>
各アドレスブロック(アドレス 256 個)からの同時接続をそれぞれ 1 つだけ
許可します。
<P>


<BLOCKQUOTE><TT>*0.0.0.0/0</TT></BLOCKQUOTE>
全てのクライアントについて、認証を行ってアクセスを許可するかどうかを決
めます。
<P>

アクセス制御ファイルを更新する際にサーバを止める必要はありません。
しかし、編集の際にはコピーを取って別の場所で編集し、それからアトミック
に新しいファイルに置き換えるべきです。ファイルを更新した後にサーバに
シグナルを送る必要はありません。サーバはファイルが触られたことを
検出し、再読み込みを自動的に行います。
さらに、サーバは 3 時間ごとにファイルを再読み込みします。
これは DNS の変更で解決されるホスト名が変わるかもしれないので、これに
対応するためです。
<P>

個々の規則における文法違反はログに記録され、違反している規則は無視され
ます。ホスト名解決の失敗もログに記録されます。
<A NAME="lbAH">&nbsp;</A>
<H2>認証</H2>

<B>CVSup</B>

はサーバへのアクセスの制御に使える認証機構を備えています。この認証機構
はパケットの盗聴攻撃や再生攻撃の影響を受けない challenge-response 
プロトコルを使っています。ネットワーク上ではどちらの方向にもパスワード
は流れません。クライアントとサーバはどちらとも、相手が何者であるかを
独立して確認できます。
<P>

クライアントの認証は
<I>base </I><B>/cvsupd.access

</B>



ファイル内の
<I>認証</I>

規則が成功するか、
``規則が適用されないままファイル末尾まで来た''

場合に呼び出されます。
cvsupd.access

が存在しない場合はクライアントの認証は行われません。
<P>

<I>base </I><B>/cvsupd.passwd

</B>



ファイルには認証時に使う情報が入っています。このファイルには、
サーバへのアクセスが許可されたクライアントについてのレコードが書かれて
います。ファイル中では 1 行に 1 レコードが書かれます。
`#'

で始まる行と、空白文字しか含まない行は無視されます。
ファイル中の別の場所では空白文字は必ず意味を持ちます。フィールドは
`:'

文字で区切ります。
<P>

ファイルの最初のレコードは特別です。最初のレコードはサーバ自身を表しま
す。サーバのレコードは以下の形式になります:
<P>


<BLOCKQUOTE><TT></TT><I>serverName </I><B>: </B><I>privateKey</I>









</BLOCKQUOTE>
<P>

<I>ServerName</I>

はサーバのカノニカル名です(例:
`CVSup.FreeBSD.ORG'

)。
この名前がクライアントに送られ、クライアントはこの名前を使って適切なク
ライアント名と、認証のために共有している秘密の文字列を選びます。
この名前では大文字と小文字は区別されません。
<P>

<I>PrivateKey</I>

は
`:'

を除く任意の文字からなる文字列です。
サーバがランダムな challenge 文字列を生成してクライアントに送った時、
サーバは推測が困難な challenge 文字列を
<I>privateKey</I>

を使って作ります。challenge 文字列はランダムであり、まず予測できないの
で、
<I>privateKey</I>

は実はあまり重要ではありません。そうしたければ空のままでもかまいません
が、文字列の前の
`:'

は必ず必要です。
<P>

ファイル中の残り全てのレコードは、個々のクライアントに対応します。
クライアント用のレコードは以下の形となります:

<BLOCKQUOTE>
<PRE>
Ar clientName No : Ar sharedSecret No :
<I>class </I><B>: </B><I>comment</I>



</PRE>
</BLOCKQUOTE>

<P>

空のフィールドがある場合でも、全てのフィールドが存在しなければなりません。
<I>ClientName</I>

はレコードが適用されるクライアントの名前です。慣習では、全ての
クライアント名には e-mail アドレスが使われます(例: 
`<A HREF="mailto:BillyJoe@FreeBSD.ORG">BillyJoe@FreeBSD.ORG</A>'

)。
クライアント名では大文字と小文字は区別されません。
<P>

<I>SharedSecret</I>

は、クライアントとサーバだけが知っている秘密の文字列です。
この文字列はクライアントが選んだパスワードから
<B>cvpasswd</B>

ユーティリティを使って生成されます。
クライアントは
<I>sharedSecret</I>

を知っていることを示すことにより、自分の身分をサーバに対して証明します
(その逆も同じです)。
<I>sharedSecret</I>

フィールドを
`*'

にすることにより、クライアントのアクセスを禁止できます。
<P>

共有している秘密の文字列がネットワーク上を流れることはありませんし、
秘密の文字列からクライアントのパスワードを調べることもできません。しか
し、共有している秘密の文字列があれば、改造した
<B>cvsup</B>

を使ってクライアントのふりをすることができるかもしれません。したがって、
cvsupd.passwd

必ずファイルはサーバしか読めないように注意してください。
<P>

<I>Class</I>

は将来使うために予約しています。空にしてください。
<P>

<I>Comment</I>

はサーバの管理者が便利なように、クライアントに関する備考が書かれていま
す。例えば、クライアントの本名や、別の連絡手段などです。
<P>

cvsupd.passwd

ファイルを更新する際にサーバを止める必要はありません。
しかし、編集の際にはコピーを取って別の場所で編集し、それからアトミック
に新しいファイルに置き換えるべきです。ファイルを更新した後にサーバに
シグナルを送る必要はありません。
<P>

cvsupd.passwd

ファイル中では、個々のレコードの文法違反はログに記録され、違反している
レコードは無視されます。

<A NAME="lbAI">&nbsp;</A>
<H2>アクセス制御と認証通信の方法</H2>

アクセス制御と認証機構の関係を以下にまとめます。重要な原則は、アクセス
制御が先に行われる点です。アクセス制御の結果によって認証が行われるかど
うかが決まります。
<OL><P>

<LI>

cvsupd.access

ファイルがなければ、全てのクライアントのアクセスが許可されます。たとえ
cvsupd.passwd

があっても認証は行われません。
<LI>

cvsupd.access

ファイルが存在するけれど、空である場合、全てのクライアントに対して認証
が行われます。
cvsupd.passwd

が存在しなければ、誰もサーバにアクセスできません。
<LI>

cvsupd.access

が存在してファイル中に規則が書かれているけれど、
cvsupd.passwd

ファイルが存在しない場合は、
<I>認証</I>

規則が成功するとアクセスが拒否されます。この場合でも、
<I>許可</I>

規則が成功したクライアントはアクセスできます。
cvsupd.access

ファイルの最後まで来た場合には、アクセスは拒否されます。
<LI>

cvsupd.access

と
cvsupd.passwd

がどちらも存在する場合の動作は以下の通りです:
<UL><P>

<LI>

<I>許可</I>

規則が成功すると認証無しでアクセスが許可されます。
<LI>

<I>認証</I>

規則が成功すると認証が実行されます。アクセスの可否は認証の結果によって
決まります。
cvsupd.access

ファイルの最後に来るケースは、これに含まれます。
<LI>

<I>拒否</I>

規則が失敗するとアクセスは拒否されます。
</UL><P>

</OL><P>

<A NAME="lbAJ">&nbsp;</A>
<H2>RCS キーワードの展開</H2>

チェックアウトモードでは、
<B>CVSup</B>

は
<A HREF="../../GNU_rcs/man1/co.1.html">co</A>(1)


で説明されているように RCS キーワードを展開します。
<B>CVSup</B>

は標準的キーワードは全て展開し、さらに非標準のキーワードである
`$CVSHeader$'

も展開します。
この展開は
`$Header$'

と同様に行われますが、RCS ファイルのパス名が絶対パスではなく
<B>prefix</B>

ディレクトリからの相対パスで表記される点が異なります。
ここで
<B>prefix</B>

は CVS レポジトリのルートディレクトリです。
<P>

標準 RCS キーワードの別名を定義し、それぞれのキーワードの解釈を選択的に
有効・無効にすることも可能です。
この設定は、
<I>prefix </I><B>/CVSROOT/options

</B>



ファイルに書かれているキーワードによって、
レポジトリ全体を単位として制御されます。
1 行には 1 つのキーワードが書かれます。
`#'

から行末まではコメントと見なされます。
また空白行は無視されます。
歴史的な経緯のために文法は変てこです。
<P>

キーワードの別名を定義するには、次の形式の行を使います :


<BLOCKQUOTE><TT>tag= </TT><I>alias </I>[<B>= </B><I>keyword</I>



]



</BLOCKQUOTE>

例えば:

<BLOCKQUOTE><TT>tag=FreeBSD=CVSHeader</TT></BLOCKQUOTE>
は新しい RCS キーワード
`$FreeBSD$'

を定義し、これは
`$CVSHeader$'

と同様に展開されます。
二番目の
`='

と
<I>keyword</I>

がない場合、キーワードのデフォルト値は
`Id です。

'

<P>

選んだ特定のキーワード以外を全て無効にするには、次の形式の行を使います:


<BLOCKQUOTE><TT>tagexpand=i </TT><I>keyword </I>[, <I>...</I>

]



</BLOCKQUOTE>

例えば

<BLOCKQUOTE><TT>tagexpand=iFreeBSD,Id </TT>と書くと

</BLOCKQUOTE>
`$FreeBSD$'

と
`$Id$'

以外の全てのキーワードの展開を行わなくなります。
最初の
`i'

は
``include''

の意味です。
<P>

選択した特定のキーワード以外を全て有効にするためには、次の形式の行を使
います:


<BLOCKQUOTE><TT>tagexpand=e </TT><I>keyword </I>[, <I>...</I>

]



</BLOCKQUOTE>

例えば

<BLOCKQUOTE><TT>tagexpand=eFreeBSD,Id </TT>と書くと、

</BLOCKQUOTE>
`$FreeBSD$'

と
`$Id$'

以外の全てのキーワードの展開を行うようになります。
先頭の
`e'

は
``exclude''

の意味です。
<A NAME="lbAK">&nbsp;</A>
<H2>シャットダウン</H2>

サーバの起動よりも後に作られた
<I>base </I><B>/cvsupd.HALT

</B>



というファイルが存在すると、サーバは全ての新規接続要求を受け入れなくな
ります。
すでに接続されているクライアントは最後まで実行されますが、新しい接続は一
切受け付けなくなります。
この仕組みは不便で非力なため、おそらく将来のリリースでは変更されるでしょ
う。
<A NAME="lbAL">&nbsp;</A>
<H2>セキュリティ</H2>

<B></B>


は、コマンドラインで指定するログファイルを除いて、新しいファイルの作成
やファイルへの書き込みは行いません。
<B></B>


が動作していることによってシステムにダメージを与える可能性はほとんどあり
ません。
それよりも可能性の高いセキュリティ上の危険として、
<B></B>


が騙されて公開すべきでないファイルを送り出してしまうことがあります。
<B></B>


ではこのようなことがないように細心の注意を払っています。
それでもやはり、最大の防御は
<B></B>


を
`nobody'

のような全く権限のないユーザで実行し、誰でも読めるファイルしか提供でき
ないようにすることです。
<P>

<B>CVSup</B>

は、ネットワーク上を流れるデータの暗号化には対応していません。
機密性が必要であれば、
<B>ssh</B>

を使って接続をトンネリングしてください。
<A NAME="lbAM">&nbsp;</A>
<H2>ファイル</H2>

<DL COMPACT>
<P>

<DT><B>/usr/local/etc/cvsup

</B>
<DD>
デフォルトの
<I>起点</I>

ディレクトリ。
<DT><B>sup

</B>
<DD>
デフォルトの
<I>collDir</I>

サブディレクトリ。

<DT><B>
</B><I>base / collDir / collection</I>







/releases

<DD>


リリースファイル。

<DT><B>
</B><I>base / collDir / collection</I>







<B>/ </B><I>list</I>



<DD>


リストファイル。
<DT><B></B><I>base </I><B>/cvsupd.HALT

</B>




<DD>
シャットダウンファイル。
<DT><B></B><I>base </I><B>/cvsupd.access

</B>




<DD>
アクセス制御ファイル。
<DT><B></B><I>base </I><B>/cvsupd.passwd

</B>




<DD>
認証パスワードファイル。

<DT><B></B><I>prefix /CVSROOT/options

</I>


<DD>

<DD>RCS キーワード設定ファイル。
</DL>
<P>

<A NAME="lbAN">&nbsp;</A>
<H2>関連項目</H2>

<A HREF="../../GNU_rcs/man1/co.1.html">co</A>(1),


<A HREF="../man1/cvpasswd.1.html">cvpasswd</A>(1),


cvs(1),


<A HREF="../man1/cvsup.1.html">cvsup</A>(1)


<P>


<PRE>
<A HREF="http://www.polstra.com/projects/freeware/CVSup/">http://www.polstra.com/projects/freeware/CVSup/</A>
</PRE>

<A NAME="lbAO">&nbsp;</A>
<H2>作者</H2>

An John Polstra Aq <A HREF="mailto:jdp@polstra.com">jdp@polstra.com</A>

<A NAME="lbAP">&nbsp;</A>
<H2>バグ</H2>

ファイル名の末尾が
`,v'

になっていない RCS ファイルは認識されません。
<P>

`Attic'

という名前のディレクトリは全て CVS Attic と見なされ、特別な扱いを受けます。
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">名称</A><DD>
<DT><A HREF="#lbAC">書式</A><DD>
<DT><A HREF="#lbAD">解説</A><DD>
<DT><A HREF="#lbAE">ファイルコレクションレポジトリを準備する</A><DD>
<DT><A HREF="#lbAF">CVSup によるミラーサイトの運営</A><DD>
<DT><A HREF="#lbAG">アクセス制御</A><DD>
<DT><A HREF="#lbAH">認証</A><DD>
<DT><A HREF="#lbAI">アクセス制御と認証通信の方法</A><DD>
<DT><A HREF="#lbAJ">RCS キーワードの展開</A><DD>
<DT><A HREF="#lbAK">シャットダウン</A><DD>
<DT><A HREF="#lbAL">セキュリティ</A><DD>
<DT><A HREF="#lbAM">ファイル</A><DD>
<DT><A HREF="#lbAN">関連項目</A><DD>
<DT><A HREF="#lbAO">作者</A><DD>
<DT><A HREF="#lbAP">バグ</A><DD>
</DL>
<HR>
This document was created by
<A HREF="../../man/man1/man2html.1.html">man2html</A>,
using the manual pages.<BR>
Time: 03:33:37 GMT, December 05, 2022
</BODY>
</HTML>
