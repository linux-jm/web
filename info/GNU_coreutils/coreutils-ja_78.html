<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- このマニュアルは、GNU core utilities version 8.26 の詳細な解説である。
core utilities には、テキストやファイルを操作するための標準的なプログラムが入っている。

Copyright C 1994-2016 Free Software Foundation, Inc.

Japanese translation copyright C 2014-2017 Linux JM project

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.3 or any later
version published by the Free Software Foundation; with no Invariant
Sections, with no Front-Cover Texts, and with no Back-Cover Texts.  A copy
of the license is included in the section entitled "GNU Free Documentation
License".


【訳者から御注意】 この文書を info コマンドで閲覧なさっている場合は、
行末に余計な文字が入って、読みにくいことがあるかもしれない。
そうしたときは、Ctrl キーと l (エル) キーを同時に押して、画面を再描画していただきたい。
たぶん、表示が正常になるはずである。

お手元の coreutils のバージョンが 8.26 以外の場合、
この文書の説明と動作が違うことがあるかもしれない 
(たとえば、この文書に書いてあるオプションが使えない、あるいは、
使えるはずのオプションの説明がないなど)。
そうした場合は、お使いの coreutils と同じバージョンの info マニュアルや 
man ページに当ってみていただきたい。そちらの方が正しいはずである。
 -->
<!-- Created on June 7, 2022 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>GNU Coreutils: 11.1 cp: ファイルやディレクトリをコピーする</title>

<meta name="description" content="GNU Coreutils: 11.1 cp: ファイルやディレクトリをコピーする">
<meta name="keywords" content="GNU Coreutils: 11.1 cp: ファイルやディレクトリをコピーする">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="cp-invocation"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="coreutils-ja_77.html#Basic-operations" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_79.html#dd-invocation" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="coreutils-ja_77.html#Basic-operations" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_77.html#Basic-operations" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_84.html#Special-file-types" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="coreutils-ja.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_220.html#Concept-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<hr size="1">
<a name="cp_003a-huairuyadeirekutoriwokopisuru"></a>
<h2 class="section">11.1 <code>cp</code>: ファイルやディレクトリをコピーする</h2>

<a name="index-cp"></a>
<a name="index-copying-files-and-directories"></a>
<a name="index-files_002c-copying"></a>
<a name="index-directories_002c-copying"></a>

<p><code>cp</code> はファイルをコピーする (もしそうしたければ、ディレクトリのコピーもできる)。
コピーによって作られたファイルは、コピー元から全く独立したものになる。
一つのファイルを別のファイルにコピーすることもできるし、
好きなだけたくさんのファイルをコピー先のディレクトリに一遍にコピーすることもできる。
</p>
<p>書式:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">cp [<var>option</var>]&hellip; [-T] <var>source</var> <var>dest</var>
cp [<var>option</var>]&hellip; <var>source</var>&hellip; <var>directory</var>
cp [<var>option</var>]&hellip; -t <var>directory</var> <var>source</var>&hellip;
</pre></td></tr></table>

<ul>
<li>
ファイル名を二つ指定すると、<code>cp</code> は最初のファイルを 2 番目のファイルにコピーする。

</li><li>
&lsquo;<samp>--target-directory</samp>&rsquo; (&lsquo;<samp>-t</samp>&rsquo;) オプションを指定した場合や、
あるいはそれを指定しないでも、最後のファイルがディレクトリであり、しかも
&lsquo;<samp>--no-target-directory</samp>&rsquo; (&lsquo;<samp>-T</samp>&rsquo;) オプションを指定していない場合は、
<code>cp</code> は、各コピー元 (<var>source</var>) ファイルを、指定されたディレクトリにコピー元
(<var>source</var>) と同じ名前でコピーする。
</li></ul>

<p>ほとんどの場合、ファイルは読み込まれたとおりに書き出される。
例外については、後述の &lsquo;<samp>--sparse</samp>&rsquo; オプションをご覧になっていただきたい。
</p>
<p>デフォルトでは、<code>cp</code> はディレクトリをコピーしない。
ただし、&lsquo;<samp>-R</samp>&rsquo;, &lsquo;<samp>-a</samp>&rsquo;, &lsquo;<samp>-r</samp>&rsquo; オプションを指定すると、
<code>cp</code> は再帰的なコピーを行う。
すなわち、コピー元のディレクトリを段階的に下って、対応するコピー先のディレクトリにファイルをコピーすることになる。
</p>
<p>コピー元がシンボリックリンクの場合、<code>cp</code> がリンクをたどるのは
(訳注: すなわち、リンクそのものではなく、参照先の実ファイルをコピーするのは)、
通常では、再帰的なコピーをしていないときか、あるいは、&lsquo;<samp>--link</samp>&rsquo;
(&lsquo;<samp>-l</samp>&rsquo;) オプションが使用されているときだけである。
このデフォルトの動作は、次に挙げるオプションによって変更することができる。
&lsquo;<samp>--archive</samp>&rsquo; (&lsquo;<samp>-a</samp>&rsquo;), &lsquo;<samp>-d</samp>&rsquo;, &lsquo;<samp>--dereference</samp>&rsquo;
(&lsquo;<samp>-L</samp>&rsquo;),
&lsquo;<samp>--no-dereference</samp>&rsquo; (&lsquo;<samp>-P</samp>&rsquo;), &lsquo;<samp>-H</samp>&rsquo;。
こうしたオプションを二つ以上指定すると、<code>cp</code> は警告を出さず、最後のオプションで他のものを上書きする。
</p>
<p>(訳注: 最近の <code>cp</code> では &lsquo;<samp>--link</samp>&rsquo; オプションの動作が変更されている。
コピー元がシンボリックリンクの場合、coreutils-8.21 までは、
デフォルトでは、シンボリックリンクのハードリンクを作っていたが、8.22
以後の <code>cp</code> では参照先ファイルのハードリンクを作るようになっている。)
</p>
<p>コピー先がシンボリックリンクの場合、<code>cp</code> がリンクをたどるのは
(訳注: すなわち、コピー元ファイルで、リンクそのものではなく、参照先のファイルを上書きするのは)、
そのリンクが、存在する通常ファイルを指しているときだけである。
それに対して、コピー先のシンボリックリンクがリンク切れしている場合は、<code>cp</code>
は、デフォルトではコピーを拒否し、エラーメッセージを出して、実行に失敗する。
そうした操作は、本質的に危険だからである。
この動作は、伝統的な習慣や POSIX の仕様に反している。
たとえリスクがあろうとも、リンク切れしたシンボリックリンクの参照先を
<code>cp</code> が作成するようにしたいなら、環境変数 <code>POSIXLY_CORRECT</code>
を設定すればよい。なお &lsquo;<samp>--backup</samp>&rsquo; や &lsquo;<samp>--link</samp>&rsquo;
といったオプションが、コピーする前にコピー先ファイルの名前変更や削除を行う場合、
<code>cp</code> は、リンクが指しているファイルではなく、シンボリックリンクの名前変更や削除を行う。
</p>
<p>デフォルトでは、<code>cp</code> がスペシャルファイルの内容をコピーするのは、
再帰的なコピーをしていないときだけである。このデフォルトの動作は、
&lsquo;<samp>--copy-contents</samp>&rsquo; によって変更できる。
</p>
<a name="index-self_002dbackups"></a>
<a name="index-backups_002c-making-only"></a>
<p><code>cp</code> は通常、ファイルを自分自身にコピーすることを拒否するが、次の例外がある。
<var>source</var> と <var>dest</var> が同一で、しかも、通常ファイルを指しているとき、
&lsquo;<samp>--force --backup</samp>&rsquo; オプションが指定されると、<code>cp</code>
はバックアップファイルを作成することになる。バックアップファイルを標準のものにするか
(訳注: ファイルの末尾にチルダ &lsquo;<samp>~</samp>&rsquo; が 1 個付く)、番号付きのものにするかは、
いつもどおりの方法で指定できる (see section <a href="coreutils-ja_4.html#Backup-options">バックアップ・オプション</a>)。
存在するファイルに変更を加える前に、そのバックアップをちょっと作っておきたい場合、この動作は便利である。
</p>
<p>このプログラムでは以下のオプションが使用できる。参照: <a href="coreutils-ja_2.html#Common-options">共通オプション</a>.
</p>
<dl compact="compact">
<dt> &lsquo;<samp>-a</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--archive</samp>&rsquo;</dt>
<dd><a name="index-_002da-6"></a>
<a name="index-_002d_002darchive"></a>
<p>コピー元ファイルの構造と属性をコピー先でもできるだけ維持する
(ただし、ディレクトリの内部構造を維持しようとはしない。そのため、コピー先で
&lsquo;<samp>ls -U</samp>&rsquo; を実行すると、コピー元とは違った順序でファイルがリストされるかもしれない)。
SELinux コンテキストや拡張属性 (xattr) も維持しようとするが、
そうした操作に失敗しても無視し、その旨エラーメッセージを表示することはない。
エラーメッセージが少ないだけで、&lsquo;<samp>-dR --preserve=all</samp>&rsquo; と同じある。
</p>
</dd>
<dt> &lsquo;<samp>--attributes-only</samp>&rsquo;</dt>
<dd><a name="index-_002d_002dattributes_002donly"></a>
<p>コピー元ファイルの指定された属性のみを、コピー先にコピーする。
コピー先ファイルがすでに存在している場合、その内容を変更することはない。
属性のうち、何をコピーするかを決める方法については、&lsquo;<samp>--preserve</samp>&rsquo;
オプションの項を見ていただきたい。
</p>
</dd>
<dt> &lsquo;<samp>-b</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--backup[=<var>method</var>]</samp>&rsquo;</dt>
<dd><a name="index-_002db-14"></a>
<a name="index-_002d_002dbackup-1"></a>
<a name="index-VERSION_005fCONTROL-1"></a>
<a name="index-backups_002c-making-1"></a>
<p>See section <a href="coreutils-ja_4.html#Backup-options">バックアップ・オプション</a>.
そのままでは、上書きされるか、消去されてしまう各ファイルのバックアップを作成する。
特殊な用法としては、次のものがある。force と backup
の両方のオプションが指定されているとき、コピー元 (<var>source</var>)
とコピー先 (<var>dest</var>) が同じ名前で、しかも実在する通常ファイルを指していると、
<code>cp</code> はコピー元 (<var>source</var>) のバックアップを作成する。
次のちょっとした Bourne シェルのスクリプトは、オプションのこの組み合わせの応用だが、便利である。
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">#!/bin/sh
# Usage: backup FILE...
# リストされた各 FILE について GNU スタイルのバックアップを
# 作成する
fail=0
for i; do
  cp --backup --force --preserve=all -- &quot;$i&quot; &quot;$i&quot; || fail=1
done
exit $fail
</pre></td></tr></table>

</dd>
<dt> &lsquo;<samp>--copy-contents</samp>&rsquo;</dt>
<dd><a name="index-directories_002c-copying-recursively"></a>
<a name="index-copying-directories-recursively"></a>
<a name="index-recursively-copying-directories"></a>
<a name="index-non_002ddirectories_002c-copying-as-special-files"></a>
<p>再帰的なコピーを行っている際に、スペシャルファイル (たとえば、FIFO やデバイスファイル)
の内容を、操作対象が通常ファイルであるかのようにコピーする。
要するに、コピー元の各ファイルからデータを読み込んで、それをコピー先に書き出そうとするわけである。
このオプションを使うのは、ほとんどの場合誤りである。なぜなら、
FIFO や、通常 &lsquo;<tt>/dev</tt>&rsquo; ディレクトリにあるようなスペシャルファイルを対象にした場合、
望ましくない結果を生ずることが珍しくないからだ。
<code>cp -R --copy-contents</code> は、FIFO や &lsquo;<tt>/dev/console</tt>&rsquo;
のようなスペシャルファイルからデータを読み込もうとすると、
たいていの場合、いつまでも無反応になるだろうし、&lsquo;<tt>/dev/zero</tt>&rsquo;
をコピーしようとすれば、コピー先のディスクを溢れさせてしまうだろう。
このオプションは、再帰的なコピーをするとき以外、効果を持たない。
また、シンボリックリンクのコピーには影響しない。
</p>
</dd>
<dt> &lsquo;<samp>-d</samp>&rsquo;</dt>
<dd><a name="index-_002dd-10"></a>
<a name="index-symbolic-links_002c-copying"></a>
<a name="index-hard-links_002c-preserving"></a>
<p>シンボリックリンクをコピーする際、リンクが指しているファイルをコピーするのではなく、
シンボリックリンクをシンボリックリンクとしてコピーする。
また、コピー元において複数のファイルがハードリンクの関係にある場合、
コピー先でもその関係を維持する。
&lsquo;<samp>--no-dereference --preserve=links</samp>&rsquo; と同じである。
</p>
</dd>
<dt> &lsquo;<samp>-f</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--force</samp>&rsquo;</dt>
<dd><a name="index-_002df-10"></a>
<a name="index-_002d_002dforce"></a>
<p>このオプションを付けずにコピーを行う場合、
コピー先ファイルがすでに存在し、しかも書き込みモードでオープンできないと、コピーに失敗する。
それに対して、&lsquo;<samp>--force</samp>&rsquo; を付けた場合は、コピー先ファイルがオープンできないと、
<code>cp</code> は、まずそれを削除してから、再度オープンを試みる。
この動作は、&lsquo;<samp>--force</samp>&rsquo; と一緒に &lsquo;<samp>--link</samp>&rsquo; や &lsquo;<samp>--symbolic-link</samp>&rsquo;
を使用した場合に行われる動作とは、違うことに注意していただきたい。
後者の場合は、すでに存在するコピー先ファイルは一度もオープンされず、
むしろ無条件で削除されるのである。&lsquo;<samp>--remove-destination</samp>&rsquo; の説明も参照すること。
</p>
<p>このオプションは、&lsquo;<samp>--interactive</samp>&rsquo; や &lsquo;<samp>-i</samp>&rsquo;
オプションとは無関係である。どちらも他方の効果を無効にすることはない。
</p>
<p>&lsquo;<samp>--no-clobber</samp>&rsquo; や &lsquo;<samp>-n</samp>&rsquo; オプションを使用している場合、このオプションは無視される。
</p>
</dd>
<dt> &lsquo;<samp>-H</samp>&rsquo;</dt>
<dd><a name="index-_002dH-2"></a>
<p>コマンドラインの引数がシンボリックリンクを指定している場合には、
シンボリックリンクそのものではなく、それが指しているファイルをコピーする。
とは言え、再帰的にディレクトリ・ツリーをたどっているときにシンボリックに出会った場合は、
そのまま (つまり、シンボリックリンクとして) コピーする。
</p>
</dd>
<dt> &lsquo;<samp>-i</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--interactive</samp>&rsquo;</dt>
<dd><a name="index-_002di-11"></a>
<a name="index-_002d_002dinteractive"></a>
<p>ディレクトリ以外のファイルをコピーする際に、コピー先ファイルがすでに存在していると、
プロンプトを出して、ファイルを上書きしてよいかどうか、ユーザに問い合わせる。
&lsquo;<samp>-i</samp>&rsquo; オプションは、&lsquo;<samp>-n</samp>&rsquo; オプションが前にあるとき、それを無効にする。
</p>
</dd>
<dt> &lsquo;<samp>-l</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--link</samp>&rsquo;</dt>
<dd><a name="index-_002dl-7"></a>
<a name="index-_002d_002dlink"></a>
<p>コピー元がディレクトリ以外の場合、コピーする代わりに、ハードリンクを作成する。
</p>
</dd>
<dt> &lsquo;<samp>-L</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--dereference</samp>&rsquo;</dt>
<dd><a name="index-_002dL-3"></a>
<a name="index-_002d_002ddereference-1"></a>
<p>コピー元がシンボリックリンクの場合は、その参照先をコピーする。
また、このオプションを使った場合、<code>cp</code> はシンボリックリンクを作ることができない。
たとえば、コピー元のディレクトリ・ツリー中に (通常ファイルに対する)
シンボリックリンクがあると、コピー先のディレクトリ・ツリーには、通常ファイルとしてコピーされることになる。
</p>
</dd>
<dt> &lsquo;<samp>-n</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--no-clobber</samp>&rsquo;</dt>
<dd><a name="index-_002dn-11"></a>
<a name="index-_002d_002dno_002dclobber"></a>
<p>存在するファイルを上書きしない。&lsquo;<samp>-n</samp>&rsquo; オプションは、&lsquo;<samp>-i</samp>&rsquo;
オプションが前にあるとき、それを無効にする。このオプションと &lsquo;<samp>-b</samp>&rsquo;
(&lsquo;<samp>--backup</samp>&rsquo;) オプションは、どちらか一方しか指定できない。
</p>
</dd>
<dt> &lsquo;<samp>-P</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--no-dereference</samp>&rsquo;</dt>
<dd><a name="index-_002dP-1"></a>
<a name="index-_002d_002dno_002ddereference"></a>
<a name="index-symbolic-links_002c-copying-1"></a>
<p>コピー元がシンボリックリンクの場合、それが指しているファイルをコピーするのではなく、
シンボリックリンクとしてコピーする。このオプションが作用を及ぼすのは、
コピー元のシンボリックリンクに対してだけであり、
コピー先に指定されたシンボリックリンクについては、可能なかぎり常に参照先がたどられる。
</p>
</dd>
<dt> &lsquo;<samp>-p</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--preserve[=<var>attribute_list</var>]</samp>&rsquo;</dt>
<dd><a name="index-_002dp-3"></a>
<a name="index-_002d_002dpreserve"></a>
<a name="index-file-information_002c-preserving_002c-extended-attributes_002c-xattr"></a>
<p>コピー元ファイルの属性のうち、指定されたものをコピー先でも維持する。
<var>attribute_list</var> を指定する場合は、一つ以上の以下の文字列をコンマで区切ったリストでなければならない。
</p>
<dl compact="compact">
<dt> &lsquo;<samp>mode</samp>&rsquo;</dt>
<dd><p>ファイルのモードビット (訳注: 一般にアクセス権とか、許可属性と言われるもの)
やアクセス・コントロール・リストを維持する。
</p></dd>
<dt> &lsquo;<samp>ownership</samp>&rsquo;</dt>
<dd><p>所有者とグループを維持する。ほとんどの最近のシステムでは、
ファイルの所有者を変更できるのは、しかるべき権限を持ったユーザだけである。
また、一般ユーザがファイルのグループを維持できるのは、
維持しようとするグループに、たまたまそのユーザが属しているときのみである。
</p></dd>
<dt> &lsquo;<samp>timestamps</samp>&rsquo;</dt>
<dd><p>最終アクセス日時 (last access time) と最終更新日時 (last modification time)
を、可能ならば、維持する。古いシステムでは、対象となるファイルがシンボリックリンクの場合、
そうした属性を維持することができない。
それに対して、最近のシステムでは、たいていのものが <code>utimensat</code>
関数を用意しているので、シンボリックリンクの場合でも、日時関係の属性維持が可能である。
</p></dd>
<dt> &lsquo;<samp>links</samp>&rsquo;</dt>
<dd><p>コピー元のファイル同士が (ハードリンクであれ、シンボリックリンクであれ)
リンクの関係にあるとき、コピー先の対応するファイル同士でも、その関係を維持する。
ただし、&lsquo;<samp>-L</samp>&rsquo; や &lsquo;<samp>-H</samp>&rsquo; と一緒に使った場合、
このオプションがシンボリックリンクをハードリンクに変更することがあるのに、
注意していただきたい。一例を挙げる。
</p><table><tr><td>&nbsp;</td><td><pre class="example">$ mkdir c; : &gt; a; ln -s a b; cp -aH a b c; ls -i1 c
74161745 a
74161745 b
</pre></td></tr></table>
<p>コピー元に注目していただきたい。&lsquo;<tt>b</tt>&rsquo; は、通常ファイル &lsquo;<tt>a</tt>&rsquo; を指すシンボリックリンクである。
ところが、コピー先ディレクトリ &lsquo;<tt>c/</tt>&rsquo; の二つのファイルは、ハードリンクになっている。
&lsquo;<samp>-a</samp>&rsquo; は &lsquo;<samp>--no-dereference</samp>&rsquo; を意味するのだから、
シンボリックリンクがコピーされそうに思えるが、この場合は、後に続く
&lsquo;<samp>-H</samp>&rsquo; が、コマンドライン引数の参照をたどるように <code>cp</code>
に命じているので、<code>cp</code> には、同じ inode 番号を持った
2 個のファイルがコマンドラインで指定されているように見えるのである。
さらに、&lsquo;<samp>-a</samp>&rsquo; は &lsquo;<samp>--preserve=links</samp>&rsquo; オプションを意味してもいるので、
この働きによって、ハードリンクと認識された両ファイルの関係が、コピー先でも維持されることになるのである。
</p>
<p>次のものは、<code>cp</code> の &lsquo;<samp>-L</samp>&rsquo; を使った場合の類似例である。
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ mkdir b c; (cd b; : &gt; a; ln -s a b); cp -aL b c; ls -i1 c/b
74163295 a
74163295 b
</pre></td></tr></table>

</dd>
<dt> &lsquo;<samp>context</samp>&rsquo;</dt>
<dd><p>ファイルの SELinux セキュリティ・コンテキストを維持する。
それができないときは、詳細なエラーメッセージを出し、失敗のステータスで終了する。
</p></dd>
<dt> &lsquo;<samp>xattr</samp>&rsquo;</dt>
<dd><p>ファイルの拡張属性を維持する。それができないときは、詳細なエラーメッセージを出し、失敗のステータスで終了する。
<code>cp</code> が xattr のサポートなしでビルドされている場合は、このオプションは無視される。
SELinux コンテキスト、ACL、ケーパビリティなどを xattr を使って実装している場合には、
そうした属性もこのオプションによって、明示的な指定がない場合でも維持される。
すなわち、&lsquo;<samp>--preserve=mode</samp>&rsquo; や &lsquo;<samp>--preserve=context</samp>&rsquo;
を指定しないでも維持されるわけだ。
</p></dd>
<dt> &lsquo;<samp>all</samp>&rsquo;</dt>
<dd><p>ファイルの属性をすべて維持する。上記のすべてを指定するのと同じことだが、
SELinux セキュリティ・コンテキストや拡張属性の維持に失敗しても、
<code>cp</code> の終了ステータスが変わらないという点が異なっている。
&lsquo;<samp>-a</samp>&rsquo; とは違って、&lsquo;<samp>Operation not supported</samp>&rsquo;
以外のすべての警告メッセージを出力する。
</p></dd>
</dl>

<p><var>attribute_list</var> なしで &lsquo;<samp>--preserve</samp>&rsquo; を使用するのは、
&lsquo;<samp>--preserve=mode,ownership,timestamps</samp>&rsquo; と同じことである。
</p>
<p>このオプションを使わない場合、コピー先ファイルがすでに存在している場合は、
その許可属性は変更されない。一方、新しくファイルが作成される場合は、
対応するコピー元ファイルのモードを元にして、
そこから set-user-ID ビット、set-group-ID ビット、スティッキー・ビットを落としたものが、
各ファイルに付けられ、そしてさらに、オペレーティング・システムが
umask なり、デフォルトの ACL なりを適用する。
結果はより厳しいファイルモードになるかもしれない。 See section <a href="coreutils-ja_186.html#File-permissions">ファイルの許可属性</a>.
</p>
</dd>
<dt> &lsquo;<samp>--no-preserve=<var>attribute_list</var></samp>&rsquo;</dt>
<dd><a name="index-file-information_002c-preserving"></a>
<p>指定された属性を維持しない。<var>attribute_list</var> の書式は、&lsquo;<samp>--preserve</samp>&rsquo;
の場合と同じである。
</p>
</dd>
<dt> &lsquo;<samp>--parents</samp>&rsquo;</dt>
<dd><a name="index-_002d_002dparents"></a>
<a name="index-parent-directories-and-cp"></a>
<p>コピー先の各ファイル名を生成する際、出力先に指定されたディレクトリの末尾にスラッシュを付け、
その後ろにコピー元として指定されたファイル名を付け足すことによってそれを行う。
<code>cp</code> に渡す最後の引数は、実在するディレクトリの名前でなければならない。
一例を挙げる。
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">cp --parents a/b/c existing_dir
</pre></td></tr></table>

<p>ファイル &lsquo;<tt>a/b/c</tt>&rsquo; を上記のコマンドでコピーすると、ファイル
&lsquo;<tt>existing_dir/a/b/c</tt>&rsquo; が出来る。
途中のディレクトリが存在していなければ、それも作成される。
</p>
</dd>
<dt> &lsquo;<samp>-R</samp>&rsquo;</dt>
<dt> &lsquo;<samp>-r</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--recursive</samp>&rsquo;</dt>
<dd><a name="index-_002dR-3"></a>
<a name="index-_002dr-7"></a>
<a name="index-_002d_002drecursive-1"></a>
<a name="index-directories_002c-copying-recursively-1"></a>
<a name="index-copying-directories-recursively-1"></a>
<a name="index-recursively-copying-directories-1"></a>
<a name="index-non_002ddirectories_002c-copying-as-special-files-1"></a>
<p>ディレクトリを再帰的にコピーする。デフォルトでは、&lsquo;<samp>--link</samp>&rsquo; (&lsquo;<samp>-l</samp>&rsquo;)
オプションが同時に使われていないかぎり、コピー元にあるシンボリックリンクの参照をたどることをしない。
&lsquo;<samp>--archive</samp>&rsquo; (&lsquo;<samp>-a</samp>&rsquo;), &lsquo;<samp>-d</samp>&rsquo;, &lsquo;<samp>--dereference</samp>&rsquo;
(&lsquo;<samp>-L</samp>&rsquo;), &lsquo;<samp>--no-dereference</samp>&rsquo; (&lsquo;<samp>-P</samp>&rsquo;), &lsquo;<samp>-H</samp>&rsquo;
などのオプションを参照。スペシャルファイルについては、
コピーする際に、コピー元ファイルと同じファイル型のコピー先ファイルを作成する。
&lsquo;<samp>--copy-contents</samp>&rsquo; を参照。シンボリックリンクやスペシャルファイルのコピーに
&lsquo;<samp>-r</samp>&rsquo; オプションを使用するのは、どのシステムでも通用することではない。
GNU 以外のシステムの中には、歴史的な理由から &lsquo;<samp>-r</samp>&rsquo; が、&lsquo;<samp>-L</samp>&rsquo; と
&lsquo;<samp>--copy-contents</samp>&rsquo; を同時に指定するのと等価になっているものもあるからだ。
また、シンボリックリンクをコピーするのに &lsquo;<samp>-R</samp>&rsquo; を使用するのも、&lsquo;<samp>-P</samp>&rsquo;
も併せて指定しないかぎり、どのシステムでも通用することではない。
デフォルトでシンボリックリンクの参照先をたどる実装が、POSIX で認められているからである。
</p>
</dd>
<dt> &lsquo;<samp>--reflink[=<var>when</var>]</samp>&rsquo;</dt>
<dd><a name="index-_002d_002dreflink_005b_003dwhen_005d"></a>
<a name="index-COW"></a>
<a name="index-clone"></a>
<a name="index-copy-on-write"></a>
<p>ファイルシステムがサポートしていれば、軽便コピー、すなわち、
書き込み時コピー(copy-on-write (COW) copy) を行う。
留意すべきは、これが成功した場合、コピー元とコピー先のファイルは、
どちらかに対して変更が加えられるまで、ディスクの同じデータブロックを共有しているということである。
従って、ディスク I/O エラーが起きて、片方のファイルのデータブロックが損傷を受ければ、
もう一方のファイルも同じ被害に会う。
</p>
<p><var>when</var> の値には、次のうちの一つが使える。
</p>
<dl compact="compact">
<dt> &lsquo;<samp>always</samp>&rsquo;</dt>
<dd><p>デフォルトの動作である。copy-on-write がサポートされていない場合は、
各ファイルについて失敗した旨を報告し、失敗を示すステータスで終了する。
</p>
</dd>
<dt> &lsquo;<samp>auto</samp>&rsquo;</dt>
<dd><p>copy-on-write 操作がサポートされていない場合は、copy-on-write
をあきらめて、標準のコピー動作を行う。
</p></dd>
</dl>

<p>このオプションは、&lsquo;<samp>--link</samp>&rsquo;, &lsquo;<samp>--symbolic-link</samp>&rsquo;
&lsquo;<samp>--attributes-only</samp>&rsquo;
オプションによって無効になるので、データをコピーする際の <code>cp</code>
のデフォルト動作の設定に使用することができる。
たとえば、次のエイリアスを使うと、<code>cp</code> は、ファイルシステムがサポートする範囲で、
ディスクスペースの使用を最少に留めるようになる。
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">alias cp='cp --reflink=auto --sparse=always'
</pre></td></tr></table>

</dd>
<dt> &lsquo;<samp>--remove-destination</samp>&rsquo;</dt>
<dd><a name="index-_002d_002dremove_002ddestination"></a>
<p>コピー先ファイルがすでに存在する場合、その各々についてオープンを試みる前に、削除する
(上述の &lsquo;<samp>-f</samp>&rsquo; と比較すること)。
</p>
</dd>
<dt> &lsquo;<samp>--sparse=<var>when</var></samp>&rsquo;</dt>
<dd><a name="index-_002d_002dsparse_003dwhen"></a>
<a name="index-sparse-files_002c-copying"></a>
<a name="index-holes_002c-copying-files-with"></a>
<a name="index-read-system-call_002c-and-holes"></a>
<p>穴空きファイル (<em>sparse file</em>) とは、穴 (<em>holes</em>) を含むファイルである。
穴というのは、物理的なディスクブロック上には存在しないゼロバイトの連続で、
&lsquo;<samp>read</samp>&rsquo; システムコールがそれを読む込むとき、ゼロの連続として扱うものである。
バイナリ・ファイルには、連続するゼロバイトがたくさん含まれていることが多いので、
この仕組みは、ディスクスペースを大いに節約してくれるし、動作速度の向上をもたらしてもくれる。
デフォルトで <code>cp</code> は、かなり大雑把な発見的手法を使って、
コピー元ファイルにある穴を検出し、対応するコピー先ファイルも穴空きファイルにする。
なお、穴空きファイルにできるのは、通常ファイルだけである。
</p>
<p><var>when</var> の値には、次のうちの一つが使える。
</p>
<dl compact="compact">
<dt> &lsquo;<samp>auto</samp>&rsquo;</dt>
<dd><p>デフォルトの動作である。すなわち、コピー元が穴空きファイルなら、
コピー先も穴空きファイルにしようとする。
ただし、コピー先ファイルがすでに存在していても、通常ファイル以外を指している場合には、
それを穴空きにしようとはしない。
</p>
</dd>
<dt> &lsquo;<samp>always</samp>&rsquo;</dt>
<dd><p>たとえ、コピー元ファイルが穴空きファイルに見えなくても、十分に長いゼロバイトの連続があれば、
その各々に対応する穴をコピー先ファイルに設けようとする。この動作が役に立つのは、
コピー元ファイルが、穴空きファイルをサポートしていないファイルシステムにあるのに対し
(たとえば、SGI IRIX 5.3 以前の &lsquo;<samp>efs</samp>&rsquo; ファイルシステム)、
コピー先ファイルは穴空きファイルをしっかりサポートするタイプのファイルシステムにある場合である。
穴を作ることができるのは、通常ファイルだけなので、コピー先が通常ファイル以外なら、
<code>cp</code> がそのファイルを穴空きにしようと試みることもない。
</p>
</dd>
<dt> &lsquo;<samp>never</samp>&rsquo;</dt>
<dd><p>コピー先ファイルを穴空きにしない。
これは、<code>mkswap</code> コマンドで使用するファイルを作成するときに役に立つ。
そうしたファイルには、穴があってはならないからである。
</p></dd>
</dl>

</dd>
<dt> &lsquo;<samp>--strip-trailing-slashes</samp>&rsquo;</dt>
<dd><a name="index-_002d_002dstrip_002dtrailing_002dslashes"></a>
<a name="index-stripping-trailing-slashes"></a>
<p><var>source</var> 引数の後ろにスラッシュが付いていたら、それを削除する。
See section <a href="coreutils-ja_11.html#Trailing-slashes">末尾のスラッシュ</a>.
</p>
</dd>
<dt> &lsquo;<samp>-s</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--symbolic-link</samp>&rsquo;</dt>
<dd><a name="index-_002ds-15"></a>
<a name="index-_002d_002dsymbolic_002dlink"></a>
<a name="index-symbolic-links_002c-copying-with"></a>
<p>コピー元がディレクトリ以外の場合、コピーする代わりに、シンボリックリンクを作成する。
出力先ファイルをカレント・ディレクトリに作成する場合を除いて、
コピー元ファイルの名前は、すべて (&lsquo;<samp>/</samp>&rsquo; で始まる) 絶対パス表記でなければならない。
シンボリックリンクをサポートしていないシステムでは、このオプションはエラーメッセージを出すだけである。
</p>
</dd>
<dt> &lsquo;<samp>-S <var>suffix</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--suffix=<var>suffix</var></samp>&rsquo;</dt>
<dd><a name="index-_002dS-6"></a>
<a name="index-_002d_002dsuffix-1"></a>
<p>&lsquo;<samp>-b</samp>&rsquo; によって作られる各バックアップファイルの後ろに
<var>suffix</var> を付ける。 See section <a href="coreutils-ja_4.html#Backup-options">バックアップ・オプション</a>.
</p>
</dd>
<dt> &lsquo;<samp>-t <var>directory</var></samp>&rsquo;</dt>
<dt> &lsquo;<samp>--target-directory=<var>directory</var></samp>&rsquo;</dt>
<dd><a name="index-_002dt-10"></a>
<a name="index-_002d_002dtarget_002ddirectory-1"></a>
<a name="index-target-directory-3"></a>
<a name="index-destination-directory-2"></a>
<p><var>directory</var> を出力先ディレクトリに指定する。 See section <a href="coreutils-ja_10.html#Target-directory">出力先ディレクトリ</a>.
</p>
</dd>
<dt> &lsquo;<samp>-T</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--no-target-directory</samp>&rsquo;</dt>
<dd><a name="index-_002dT-5"></a>
<a name="index-_002d_002dno_002dtarget_002ddirectory-1"></a>
<a name="index-target-directory-4"></a>
<a name="index-destination-directory-3"></a>
<p>最後のオペランドがディレクトリやディレクトリへのシンボリックリンク
でも、それを特別扱いしない。 See section <a href="coreutils-ja_10.html#Target-directory">出力先ディレクトリ</a>.
</p>
</dd>
<dt> &lsquo;<samp>-u</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--update</samp>&rsquo;</dt>
<dd><a name="index-_002du-6"></a>
<a name="index-_002d_002dupdate"></a>
<a name="index-newer-files_002c-copying-only"></a>
<p>ディレクトリ以外のものをコピーする際、それがコピー先にも存在し、
しかもその更新日時 (modification time) がコピー元と同じか、より新しい場合、
コピーを行わない。コピー元からコピー先へタイムスタンプを引き継がせている場合には、
コピー元のタイムスタンプの精度を、コピー先のファイルシステム、
及びタイプスタンプの更新に使われるシステムコールの精度に落とした上で、比較を行う。
これは、同じコピー元とコピー先のファイルに対して &lsquo;<samp>cp -pu</samp>&rsquo;
コマンドを何回か実行する場合に、余計なコピー作業が起きるのを避けるためである。
&lsquo;<samp>--preserve=links</samp>&rsquo; が一緒に指定されている場合は
(たとえば、&lsquo;<samp>cp -au</samp>&rsquo; だとそうなる)、そちらが優先されることになる。
その結果、コピー元でファイルが処理される順番によっては、
コピー元のハードリンクを反映させるために、コピー先のより新しいファイルが置き換えられることもある。
</p>
</dd>
<dt> &lsquo;<samp>-v</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--verbose</samp>&rsquo;</dt>
<dd><a name="index-_002dv-7"></a>
<a name="index-_002d_002dverbose-3"></a>
<p>コピーを行う前に、コピーするファイル名を表示する。
</p>
</dd>
<dt> &lsquo;<samp>-x</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--one-file-system</samp>&rsquo;</dt>
<dd><a name="index-_002dx-2"></a>
<a name="index-_002d_002done_002dfile_002dsystem"></a>
<a name="index-file-systems_002c-omitting-copying-to-different"></a>
<p>あるファイルシステムでコピーを始めた場合、別のファイルシステムにあるサブディレクトリをスキップする。
ただし、マウントポイントのディレクトリはコピーされる。
</p>
</dd>
<dt> &lsquo;<samp>-Z</samp>&rsquo;</dt>
<dt> &lsquo;<samp>--context[=<var>context</var>]</samp>&rsquo;</dt>
<dd><a name="index-_002dZ-1"></a>
<a name="index-_002d_002dcontext-1"></a>
<a name="index-SELinux_002c-setting_002frestoring-security-context"></a>
<a name="index-security-context-1"></a>
<p><var>context</var> が指定されていない場合は、出力するファイルの SELinux
セキュリティ・コンテキストを、出力先におけるシステムのデフォルトのタイプに合わせて調整する。
これは、<code>restorecon</code> コマンドの動作に似ている。
このオプションの長い形式を使って、コンテキストを明示的に指定した場合、
そのコンテキストが設定されるのは、新しく作成されるファイルに対してのみである。
コンテキストを指定した場合に、SELinux と SMACK のどちらも無効になっていると、
警告メッセージを出す。 このオプションと
&lsquo;<samp>--preserve=context</samp>&rsquo; オプションは、どちらか一方しか指定できない。
また、このオプションは &lsquo;<samp>--preserve=all</samp>&rsquo; や &lsquo;<samp>-a</samp>&rsquo; オプションに優先する。
</p>
</dd>
</dl>

<p>終了ステータス 0 は成功を示し、0 以外の値は失敗を示す。
</p>

<hr size="1">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="coreutils-ja_77.html#Basic-operations" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_79.html#dd-invocation" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="coreutils-ja_77.html#Basic-operations" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_77.html#Basic-operations" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_84.html#Special-file-types" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="coreutils-ja.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_220.html#Concept-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="coreutils-ja_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated on <i>June 7, 2022</i> using <a href="http://www.nongnu.org/texi2html/"><i>texi2html 1.82</i></a>.
 </font>
 <br>

</p>
</body>
</html>
